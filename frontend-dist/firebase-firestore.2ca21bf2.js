var e=globalThis;function t(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var n=e.parcelRequire94c2;(0,n.register)("4rxkr",function(r,i){t(r.exports,"setLogLevel",()=>re),t(r.exports,"_logWarn",()=>rr),t(r.exports,"_debugAssert",()=>ra),t(r.exports,"FirestoreError",()=>rl),t(r.exports,"_EmptyAuthCredentialsProvider",()=>rc),t(r.exports,"_EmptyAppCheckTokenProvider",()=>rw),t(r.exports,"_AutoId",()=>rv),t(r.exports,"Timestamp",()=>r_),t(r.exports,"_FieldPath",()=>rC),t(r.exports,"_DocumentKey",()=>rD),t(r.exports,"_isBase64Available",()=>ik),t(r.exports,"_ByteString",()=>iR),t(r.exports,"_DatabaseId",()=>iU),t(r.exports,"_validateIsNotUsedTogether",()=>hK),t(r.exports,"_cast",()=>hW),t(r.exports,"connectFirestoreEmulator",()=>hZ),t(r.exports,"Query",()=>h0),t(r.exports,"DocumentReference",()=>h1),t(r.exports,"CollectionReference",()=>h2),t(r.exports,"collection",()=>h5),t(r.exports,"collectionGroup",()=>h6),t(r.exports,"doc",()=>h3),t(r.exports,"refEqual",()=>h4),t(r.exports,"queryEqual",()=>h8),t(r.exports,"LoadBundleTask",()=>ce),t(r.exports,"CACHE_SIZE_UNLIMITED",()=>ct),t(r.exports,"Firestore",()=>cn),t(r.exports,"initializeFirestore",()=>cr),t(r.exports,"getFirestore",()=>ci),t(r.exports,"ensureFirestoreConfigured",()=>cs),t(r.exports,"enableIndexedDbPersistence",()=>co),t(r.exports,"enableMultiTabIndexedDbPersistence",()=>cl),t(r.exports,"clearIndexedDbPersistence",()=>ch),t(r.exports,"waitForPendingWrites",()=>cc),t(r.exports,"enableNetwork",()=>cf),t(r.exports,"disableNetwork",()=>cd),t(r.exports,"terminate",()=>cg),t(r.exports,"loadBundle",()=>cm),t(r.exports,"namedQuery",()=>cp),t(r.exports,"AggregateField",()=>cw),t(r.exports,"AggregateQuerySnapshot",()=>cv),t(r.exports,"Bytes",()=>cb),t(r.exports,"FieldPath",()=>cx),t(r.exports,"documentId",()=>c_),t(r.exports,"FieldValue",()=>cI),t(r.exports,"GeoPoint",()=>cE),t(r.exports,"QueryConstraint",()=>c2),t(r.exports,"query",()=>c5),t(r.exports,"QueryCompositeFilterConstraint",()=>c4),t(r.exports,"QueryFieldFilterConstraint",()=>c6),t(r.exports,"where",()=>c3),t(r.exports,"or",()=>c8),t(r.exports,"and",()=>c9),t(r.exports,"QueryOrderByConstraint",()=>c7),t(r.exports,"orderBy",()=>fe),t(r.exports,"QueryLimitConstraint",()=>ft),t(r.exports,"limit",()=>fn),t(r.exports,"limitToLast",()=>fr),t(r.exports,"QueryStartAtConstraint",()=>fi),t(r.exports,"startAt",()=>fs),t(r.exports,"startAfter",()=>fa),t(r.exports,"QueryEndAtConstraint",()=>fo),t(r.exports,"endBefore",()=>fl),t(r.exports,"endAt",()=>fu),t(r.exports,"AbstractUserDataWriter",()=>fm),t(r.exports,"sum",()=>fw),t(r.exports,"average",()=>fv),t(r.exports,"count",()=>fb),t(r.exports,"aggregateFieldEqual",()=>fx),t(r.exports,"aggregateQuerySnapshotEqual",()=>f_),t(r.exports,"SnapshotMetadata",()=>fI),t(r.exports,"DocumentSnapshot",()=>fE),t(r.exports,"QueryDocumentSnapshot",()=>fT),t(r.exports,"QuerySnapshot",()=>fS),t(r.exports,"snapshotEqual",()=>fC),t(r.exports,"getDoc",()=>fD),t(r.exports,"getDocFromCache",()=>fN),t(r.exports,"getDocFromServer",()=>fk),t(r.exports,"getDocs",()=>fR),t(r.exports,"getDocsFromCache",()=>fM),t(r.exports,"getDocsFromServer",()=>fL),t(r.exports,"setDoc",()=>fO),t(r.exports,"executeWrite",()=>fU),t(r.exports,"updateDoc",()=>fP),t(r.exports,"deleteDoc",()=>fF),t(r.exports,"addDoc",()=>fV),t(r.exports,"onSnapshot",()=>fq),t(r.exports,"onSnapshotsInSync",()=>fB),t(r.exports,"getCountFromServer",()=>fG),t(r.exports,"getAggregateFromServer",()=>fj),t(r.exports,"persistentSingleTabManager",()=>f1),t(r.exports,"memoryEagerGarbageCollector",()=>fW),t(r.exports,"memoryLruGarbageCollector",()=>fY),t(r.exports,"memoryLocalCache",()=>fX),t(r.exports,"persistentLocalCache",()=>fJ),t(r.exports,"persistentMultipleTabManager",()=>f2),t(r.exports,"WriteBatch",()=>f6),t(r.exports,"Transaction",()=>f4),t(r.exports,"runTransaction",()=>f8),t(r.exports,"deleteField",()=>f9),t(r.exports,"serverTimestamp",()=>f7),t(r.exports,"arrayUnion",()=>de),t(r.exports,"arrayRemove",()=>dt),t(r.exports,"increment",()=>dn),t(r.exports,"writeBatch",()=>dr),t(r.exports,"setIndexConfiguration",()=>di),t(r.exports,"PersistentCacheIndexManager",()=>da),t(r.exports,"getPersistentCacheIndexManager",()=>dl),t(r.exports,"enablePersistentCacheIndexAutoCreation",()=>du),t(r.exports,"disablePersistentCacheIndexAutoCreation",()=>dh),t(r.exports,"deleteAllPersistentCacheIndexes",()=>dc),t(r.exports,"_TestingHooks",()=>dg);var s,a,o,l=n("8WRsO"),u=n("fnbc9");let h=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,f=63&l;o||(f=64,s||(c=64)),r.push(n[u],n[h],n[c],n[f])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(h(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new f;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class f extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let d=function(e){return(function(e){let t=h(e);return c.encodeByteArray(t,!0)})(e).replace(/\./g,"")},g=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)},p=()=>{try{return g()||(()=>{if(void 0===u||void 0===u.env)return;let e=void 0;return e?JSON.parse(e):void 0})()||m()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},y=e=>{var t,n;let r=null===(n=null===(t=p())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e];if(!r)return;let i=r.lastIndexOf(":");if(i<=0||i+1===r.length)throw Error(`Invalid host ${r} with no separate hostname and port!`);let s=parseInt(r.substring(i+1),10);return"["===r[0]?[r.substring(1,i-1),s]:[r.substring(0,i),s]};function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function v(){return!function(){var t;let n=null===(t=p())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class b extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,x.prototype.create)}}class x{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?i.replace(_,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new b(r,a,n)}}let _=/\{\$([^}]+)}/g;function I(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(E(n)&&E(s)){if(!I(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function E(e){return null!==e&&"object"==typeof e}function T(e){return e&&e._delegate?e._delegate:e}class S{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(k=R||(R={}))[k.DEBUG=0]="DEBUG",k[k.VERBOSE=1]="VERBOSE",k[k.INFO=2]="INFO",k[k.WARN=3]="WARN",k[k.ERROR=4]="ERROR",k[k.SILENT=5]="SILENT";let C={debug:R.DEBUG,verbose:R.VERBOSE,info:R.INFO,warn:R.WARN,error:R.ERROR,silent:R.SILENT},D=R.INFO,A={[R.DEBUG]:"log",[R.VERBOSE]:"log",[R.INFO]:"info",[R.WARN]:"warn",[R.ERROR]:"error"},N=(e,t,...n)=>{if(t<e.logLevel)return;let r=(new Date).toISOString(),i=A[t];if(!i)throw Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};var k,R,M,L=L||{},O=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{})||self;function P(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function F(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function V(e,t,n){return e.call.apply(e.bind,arguments)}function q(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function B(e,t,n){return(B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:q).apply(null,arguments)}function U(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function z(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function G(){this.s=this.s,this.o=this.o}G.prototype.s=!1,G.prototype.sa=function(){this.s||(this.s=!0,this.N())},G.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let j=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function K(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function $(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(P(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Q.prototype.h=function(){this.defaultPrevented=!0};var H=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};O.addEventListener("test",e,t),O.removeEventListener("test",e,t)}catch(e){}return e}();function W(e){return/^[\s\xa0]*$/.test(e)}function Y(){var e=O.navigator;return e&&(e=e.userAgent)?e:""}function X(e){return -1!=Y().indexOf(e)}function J(e){return J[" "](e),e}J[" "]=function(){};var Z,ee,et=X("Opera"),en=X("Trident")||X("MSIE"),er=X("Edge"),ei=er||en,es=X("Gecko")&&!(-1!=Y().toLowerCase().indexOf("webkit")&&!X("Edge"))&&!(X("Trident")||X("MSIE"))&&!X("Edge"),ea=-1!=Y().toLowerCase().indexOf("webkit")&&!X("Edge");function eo(){var e=O.document;return e?e.documentMode:void 0}e:{var el="",eu=(ee=Y(),es?/rv:([^\);]+)(\)|;)/.exec(ee):er?/Edge\/([\d\.]+)/.exec(ee):en?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ee):ea?/WebKit\/(\S+)/.exec(ee):et?/(?:Version)[ \/]?(\S+)/.exec(ee):void 0);if(eu&&(el=eu?eu[1]:""),en){var eh=eo();if(null!=eh&&eh>parseFloat(el)){Z=String(eh);break e}}Z=el}var ec=O.document&&en&&(eo()||parseInt(Z,10))||void 0;function ef(e,t){if(Q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(es){e:{try{J(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ed[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ef.$.h.call(this)}}z(ef,Q);var ed={2:"touch",3:"pen",4:"mouse"};ef.prototype.h=function(){ef.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var eg="closure_listenable_"+(1e6*Math.random()|0),em=0;function ep(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++em,this.fa=this.ia=!1}function ey(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function ew(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function ev(e){let t={};for(let n in e)t[n]=e[n];return t}let eb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ex(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<eb.length;t++)n=eb[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function e_(e){this.src=e,this.g={},this.h=0}function eI(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=j(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ey(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function eE(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}e_.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=eE(e,t,r,i);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new ep(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var eT="closure_lm_"+(1e6*Math.random()|0),eS={};function eC(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=F(i)?!!i.capture:!!i,o=ek(e);if(o||(e[eT]=o=new e_(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return eN.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)H||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(eA(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function eD(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[eg])eI(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(eA(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ek(t))?(eI(n,e),0==n.h&&(n.src=null,t[eT]=null)):ey(e)}}}function eA(e){return e in eS?eS[e]:eS[e]="on"+e}function eN(e,t){if(e.fa)e=!0;else{t=new ef(t,this);var n=e.listener,r=e.la||e.src;e.ia&&eD(e),e=n.call(r,t)}return e}function ek(e){return(e=e[eT])instanceof e_?e:null}var eR="__closure_events_fn_"+(1e9*Math.random()>>>0);function eM(e){return"function"==typeof e?e:(e[eR]||(e[eR]=function(t){return e.handleEvent(t)}),e[eR])}function eL(){G.call(this),this.i=new e_(this),this.S=this,this.J=null}function eO(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new Q(t,e);else if(t instanceof Q)t.target=t.target||e;else{var i=t;ex(t=new Q(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eP(a,r,!0,t)&&i}if(i=eP(a=t.g=e,r,!0,t)&&i,i=eP(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eP(a=t.g=n[s],r,!1,t)&&i}function eP(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&eI(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}z(eL,G),eL.prototype[eg]=!0,eL.prototype.removeEventListener=function(e,t,n,r){(function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=F(i)?!!i.capture:!!i,r=eM(r),t&&t[eg]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=eE(a=t.g[n],r,i,s))&&(ey(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ek(t))&&(n=t.g[n.toString()],t=-1,n&&(t=eE(n,r,i,s)),(r=-1<t?n[t]:null)&&eD(r))})(this,e,t,n,r)},eL.prototype.N=function(){if(eL.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ey(n[r]);delete t.g[e],t.h--}}this.J=null},eL.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eL.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var eF=O.JSON.stringify,eV=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new eq,e=>e.reset());class eq{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let eB,eU=!1,ez=new class{constructor(){this.h=this.g=null}add(e,t){let n=eV.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},eG=()=>{let e=O.Promise.resolve(void 0);eB=()=>{e.then(ej)}};var ej=()=>{let e;for(var t;e=null,ez.g&&(e=ez.g,ez.g=ez.g.next,ez.g||(ez.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){O.setTimeout(()=>{throw e},0)}(e)}eV.j(t),100>eV.h&&(eV.h++,t.next=eV.g,eV.g=t)}eU=!1};function eK(e,t){eL.call(this),this.h=e||1,this.g=t||O,this.j=B(this.qb,this),this.l=Date.now()}function e$(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function eQ(e,t,n){if("function"==typeof e)n&&(e=B(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=B(e.handleEvent,e)}return 0x7fffffff<Number(t)?-1:O.setTimeout(e,t||0)}z(eK,eL),(M=eK.prototype).ga=!1,M.T=null,M.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),eO(this,"tick"),this.ga&&(e$(this),this.start()))}},M.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},M.N=function(){eK.$.N.call(this),e$(this),delete this.g};class eH extends G{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eQ(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eW(e){G.call(this),this.h=e,this.g={}}z(eW,G);var eY=[];function eX(e,t,n,r){Array.isArray(n)||(n&&(eY[0]=n.toString()),n=eY);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eM(r),t&&t[eg]?t.P(n,r,F(i)?!!i.capture:!!i,s):eC(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eM(r),t&&t[eg]?t.O(n,r,F(i)?!!i.capture:!!i,s):eC(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eJ(e){ew(e.g,function(e,t){this.g.hasOwnProperty(t)&&eD(e)},e),e.g={}}function eZ(){this.g=!0}function e0(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eF(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eW.prototype.N=function(){eW.$.N.call(this),eJ(this)},eW.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eZ.prototype.Ea=function(){this.g=!1},eZ.prototype.info=function(){};var e1={},e2=null;function e5(){return e2=e2||new eL}function e6(e){Q.call(this,e1.Ta,e)}function e3(e){let t=e5();eO(t,new e6(t))}function e4(e,t){Q.call(this,e1.STAT_EVENT,e),this.stat=t}function e8(e){let t=e5();eO(t,new e4(t,e))}function e9(e,t){Q.call(this,e1.Ua,e),this.size=t}function e7(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){e()},t)}e1.Ta="serverreachability",z(e6,Q),e1.STAT_EVENT="statevent",z(e4,Q),e1.Ua="timingevent",z(e9,Q);var te={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},tt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function tn(){}function tr(e){return e.h||(e.h=e.i())}function ti(){}tn.prototype.h=null;var ts,ta={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function to(){Q.call(this,"d")}function tl(){Q.call(this,"c")}function tu(){}function th(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eW(this),this.P=tf,e=ei?125:void 0,this.V=new eK(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new tc}function tc(){this.i=null,this.g="",this.h=!1}z(to,Q),z(tl,Q),z(tu,tn),tu.prototype.g=function(){return new XMLHttpRequest},tu.prototype.i=function(){return{}},ts=new tu;var tf=45e3,td={},tg={};function tm(e,t,n){e.L=1,e.A=tM(tD(t)),e.u=n,e.S=!0,tp(e,null)}function tp(e,t){e.G=Date.now(),tv(e),e.B=tD(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),t$(n.i,"t",r),e.o=0,n=e.l.J,e.h=new tc,e.g=nM(e.l,n?t:null,!e.u),0<e.O&&(e.M=new eH(B(e.Pa,e,e.g),e.O)),eX(e.U,e.g,"readystatechange",e.nb),t=e.I?ev(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),e3(),function(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");a=2<=c.length&&"type"==c[1]?a+(h+"=")+u+"&":a+(h+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.j,e.v,e.B,e.m,e.W,e.u)}function ty(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function tw(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if((r=function(e,t){var n=e.o,r=t.indexOf("\n",n);return -1==r?tg:isNaN(n=Number(t.substring(n,r)))?td:(r+=1)+n>t.length?tg:(t=t.slice(r,r+n),e.o=r+n,t)}(e,n))==tg){4==t&&(e.s=4,e8(14),i=!1),e0(e.j,e.m,null,"[Incomplete Response]");break}if(r==td){e.s=4,e8(15),e0(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}e0(e.j,e.m,r,null),tE(e,r)}ty(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,e8(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),nT(t),t.M=!0,e8(11))):(e0(e.j,e.m,n,"[Invalid Chunked Response]"),tI(e),t_(e))}function tv(e){e.Y=Date.now()+e.P,tb(e,e.P)}function tb(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=e7(B(e.lb,e),t)}function tx(e){e.C&&(O.clearTimeout(e.C),e.C=null)}function t_(e){0==e.l.H||e.J||nD(e.l,e)}function tI(e){tx(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,e$(e.V),eJ(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function tE(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||tJ(n.i,e))){if(!e.K&&tJ(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;nC(n),ny(n)}nE(n),e8(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=e7(B(n.ib,n),6e3));if(1>=tX(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nN(n,11)}else if((e.K||n.g==e)&&nC(n),!W(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.V=o[0],o=o[1],2==n.H){if("c"==o[0]){n.K=o[1],n.pa=o[2];let t=o[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=o[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tZ(s,s.h),s.h=null))}if(r.F){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tR(r.I,r.F,e))}}if(n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),(r=n).wa=nR(r,r.J?r.pa:null,r.Y),e.K){t0(r.i,e);var a=r.L;a&&e.setTimeout(a),e.C&&(tx(e),tv(e)),r.g=e}else nI(r);0<n.j.length&&nv(n)}else"stop"!=o[0]&&"close"!=o[0]||nN(n,7)}else 3==n.H&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nN(n,7):np(n):"noop"!=o[0]&&n.h&&n.h.Aa(o),n.A=0)}}e3()}catch(e){}}function tT(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(P(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(P(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(P(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(M=th.prototype).setTimeout=function(e){this.P=e},M.nb=function(e){e=e.target;let t=this.M;t&&3==nh(e)?t.l():this.Pa(e)},M.Pa=function(e){try{if(e==this.g)e:{let h=nh(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||ei||this.g&&(this.h.h||this.g.ja()||nc(this.g)))){this.J||4!=h||7==t||e3(),tx(this);var n=this.g.da();this.ca=n;t:if(ty(this)){var r=nc(this.g);e="";var i=r.length,s=4==nh(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tI(this),t_(this);var a="";break t}this.h.i=new O.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(o)){var u=o;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,e8(12),tI(this),t_(this);break e}e0(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tE(this,n)}this.S?(tw(this,h,a),ei&&this.i&&3==h&&(eX(this.U,this.V,"tick",this.mb),this.V.start())):(e0(this.j,this.m,a,null),tE(this,a)),4==h&&tI(this),this.i&&!this.J&&(4==h?nD(this.l,this):(this.i=!1,tv(this)))}else(function(e){let t={};e=(e.g&&2<=nh(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(W(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(let n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,e8(12)):(this.s=0,e8(13)),tI(this),t_(this)}}}catch(e){}},M.mb=function(){if(this.g){var e=nh(this.g),t=this.g.ja();this.o<t.length&&(tx(this),tw(this,e,t),this.i&&4!=e&&tv(this))}},M.cancel=function(){this.J=!0,tI(this)},M.lb=function(){this.C=null;let e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.B),2!=this.L&&(e3(),e8(17)),tI(this),this.s=2,t_(this)):tb(this,this.Y-e)};var tS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tC(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tC){this.h=e.h,tA(this,e.j),this.s=e.s,this.g=e.g,tN(this,e.m),this.l=e.l;var t=e.i,n=new tz;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tk(this,n),this.o=e.o}else e&&(t=String(e).match(tS))?(this.h=!1,tA(this,t[1]||"",!0),this.s=tL(t[2]||""),this.g=tL(t[3]||"",!0),tN(this,t[4]),this.l=tL(t[5]||"",!0),tk(this,t[6]||"",!0),this.o=tL(t[7]||"")):(this.h=!1,this.i=new tz(null,this.h))}function tD(e){return new tC(e)}function tA(e,t,n){e.j=n?tL(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tN(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tk(e,t,n){var r,i;t instanceof tz?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tG(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tj(this,t),t$(this,n,e))},r)),r.j=i):(n||(t=tO(t,tB)),e.i=new tz(t,e.h))}function tR(e,t,n){e.i.set(t,n)}function tM(e){return tR(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tL(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tO(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tP),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tP(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tC.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tO(t,tF,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tO(t,tF,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tO(n,"/"==n.charAt(0)?tq:tV,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tO(n,tU)),e.join("")};var tF=/[#\/\?@]/g,tV=/[#\?:]/g,tq=/[#\?]/g,tB=/[#\?@]/g,tU=/#/g;function tz(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tG(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tj(e,t){tG(e),t=tQ(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tK(e,t){return tG(e),t=tQ(e,t),e.g.has(t)}function t$(e,t,n){tj(e,t),0<n.length&&(e.i=null,e.g.set(tQ(e,t),K(n)),e.h+=n.length)}function tQ(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tH(e){this.l=e||tW,e=O.PerformanceNavigationTiming?0<(e=O.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(O.g&&O.g.Ka&&O.g.Ka()&&O.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(M=tz.prototype).add=function(e,t){tG(this),this.i=null,e=tQ(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},M.forEach=function(e,t){tG(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},M.ta=function(){tG(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},M.Z=function(e){tG(this);let t=[];if("string"==typeof e)tK(this,e)&&(t=t.concat(this.g.get(tQ(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},M.set=function(e,t){return tG(this),this.i=null,tK(this,e=tQ(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},M.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},M.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var tW=10;function tY(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tX(e){return e.h?1:e.g?e.g.size:0}function tJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tZ(e,t){e.g?e.g.add(t):e.h=t}function t0(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function t1(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return K(e.i)}function t2(){this.g=new class{stringify(e){return O.JSON.stringify(e,void 0)}parse(e){return O.JSON.parse(e,void 0)}}}function t5(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function t6(e){this.l=e.ec||null,this.j=e.ob||!1}function t3(e,t){eL.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=t4,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tH.prototype.cancel=function(){if(this.i=t1(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}},z(t6,tn),t6.prototype.g=function(){return new t3(this.l,this.j)},t6.prototype.i=(s={},function(){return s}),z(t3,eL);var t4=0;function t8(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function t9(e){e.readyState=4,e.l=null,e.j=null,e.A=null,t7(e)}function t7(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(M=t3.prototype).open=function(e,t){if(this.readyState!=t4)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,t7(this)},M.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||O).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},M.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,t9(this)),this.readyState=t4},M.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t7(this)),this.g&&(this.readyState=3,t7(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==O.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;t8(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},M.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?t9(this):t7(this),3==this.readyState&&t8(this)}},M.Za=function(e){this.g&&(this.response=this.responseText=e,t9(this))},M.Ya=function(e){this.g&&(this.response=e,t9(this))},M.ka=function(){this.g&&t9(this)},M.setRequestHeader=function(e,t){this.v.append(e,t)},M.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},M.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(t3.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ne=O.JSON.parse;function nt(e){eL.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=nn,this.L=this.M=!1}z(nt,eL);var nn="",nr=/^https?$/i,ni=["POST","PUT"];function ns(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,na(e),nl(e)}function na(e){e.F||(e.F=!0,eO(e,"complete"),eO(e,"error"))}function no(e){if(e.h&&void 0!==L&&(!e.C[1]||4!=nh(e)||2!=e.da())){if(e.v&&4==nh(e))eQ(e.La,0,e);else if(eO(e,"readystatechange"),4==nh(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.I).match(tS)[1]||null;!i&&O.self&&O.self.location&&(i=O.self.location.protocol.slice(0,-1)),n=!nr.test(i?i.toLowerCase():"")}t=n}if(t)eO(e,"complete"),eO(e,"success");else{e.m=6;try{var s=2<nh(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",na(e)}}finally{nl(e)}}}}function nl(e,t){if(e.g){nu(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||eO(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function nu(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(O.clearTimeout(e.A),e.A=null)}function nh(e){return e.g?e.g.readyState:0}function nc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case nn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function nf(e){let t="";return ew(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function nd(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=nf(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tR(e,t,n))}function ng(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nm(e){this.Ga=0,this.j=[],this.l=new eZ,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ng("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ng("baseRetryDelayMs",5e3,e),this.hb=ng("retryDelaySeedMs",1e4,e),this.eb=ng("forwardChannelMaxRetries",2,e),this.xa=ng("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tH(e&&e.concurrentRequestLimit),this.Ja=new t2,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function np(e){if(nw(e),3==e.H){var t=e.W++,n=tD(e.I);if(tR(n,"SID",e.K),tR(n,"RID",t),tR(n,"TYPE","terminate"),nx(e,n),(t=new th(e,e.l,t)).L=2,t.A=tM(tD(n)),n=!1,O.navigator&&O.navigator.sendBeacon)try{n=O.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&O.Image&&((new Image).src=t.A,n=!0),n||(t.g=nM(t.l,null),t.g.ha(t.A)),t.G=Date.now(),tv(t)}nk(e)}function ny(e){e.g&&(nT(e),e.g.cancel(),e.g=null)}function nw(e){ny(e),e.u&&(O.clearTimeout(e.u),e.u=null),nC(e),e.i.cancel(),e.m&&("number"==typeof e.m&&O.clearTimeout(e.m),e.m=null)}function nv(e){if(!tY(e.i)&&!e.m){e.m=!0;var t=e.Na;eB||eG(),eU||(eB(),eU=!0),ez.add(t,e),e.C=0}}function nb(e,t){var n;n=t?t.m:e.W++;let r=tD(e.I);tR(r,"SID",e.K),tR(r,"RID",n),tR(r,"AID",e.V),nx(e,r),e.o&&e.s&&nd(r,e.o,e.s),n=new th(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=n_(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),tZ(e.i,n),tm(n,r,t)}function nx(e,t){e.na&&ew(e.na,function(e,n){tR(t,n,e)}),e.h&&tT({},function(e,n){tR(t,n,e)})}function n_(e,t,n){n=Math.min(e.j.length,n);var r=e.h?B(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{tT(e,function(e,n){let i=e;F(e)&&(i=eF(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function nI(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eB||eG(),eU||(eB(),eU=!0),ez.add(t,e),e.A=0}}function nE(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=e7(B(e.Ma,e),nA(e,e.A)),e.A++,!0)}function nT(e){null!=e.B&&(O.clearTimeout(e.B),e.B=null)}function nS(e){e.g=new th(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tD(e.wa);tR(t,"RID","rpc"),tR(t,"SID",e.K),tR(t,"AID",e.V),tR(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tR(t,"TO",e.qa),tR(t,"TYPE","xmlhttp"),nx(e,t),e.o&&e.s&&nd(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=tM(tD(t)),n.u=null,n.S=!0,tp(n,e)}function nC(e){null!=e.v&&(O.clearTimeout(e.v),e.v=null)}function nD(e,t){var n=null;if(e.g==t){nC(e),nT(e),e.g=null;var r=2}else{if(!tJ(e.i,t))return;n=t.F,t0(e.i,t),r=1}if(0!=e.H){if(t.i){if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i,s=e.C;eO(r=e5(),new e9(r,n)),nv(e)}else nI(e)}else if(3==(s=t.s)||0==s&&0<t.ca||!(1==r&&(i=t,!(tX(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=i.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=e7(B(e.Na,e,i),nA(e,e.C)),e.C++,0))))||2==r&&nE(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),s){case 1:nN(e,5);break;case 4:nN(e,10);break;case 3:nN(e,6);break;default:nN(e,2)}}}function nA(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nN(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=B(e.pb,e);n||(n=new tC("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||tA(n,"https"),tM(n)),function(e,t){let n=new eZ;if(O.Image){let r=new Image;r.onload=U(t5,n,r,"TestLoadImage: loaded",!0,t),r.onerror=U(t5,n,r,"TestLoadImage: error",!1,t),r.onabort=U(t5,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=U(t5,n,r,"TestLoadImage: timeout",!1,t),O.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else e8(2);e.H=0,e.h&&e.h.za(t),nk(e),nw(e)}function nk(e){if(e.H=0,e.ma=[],e.h){let t=t1(e.i);0==t.length&&0==e.j.length||($(e.ma,t),$(e.ma,e.j),e.i.i.length=0,K(e.j),e.j.length=0),e.h.ya()}}function nR(e,t,n){var r=n instanceof tC?tD(n):new tC(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tN(r,r.m);else{var i=O.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tC(null);r&&tA(s,r),t&&(s.g=t),i&&tN(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tR(r,n,t),tR(r,"VER",e.ra),nx(e,r),r}function nM(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new nt(e.Ha&&!e.va?new t6({ob:n}):e.va)).Oa(e.J),t}function nL(){}function nO(){if(en&&!(10<=Number(ec)))throw Error("Environmental error: no available transport.")}function nP(e,t){eL.call(this),this.g=new nm(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!W(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!W(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nq(this)}function nF(e){to.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nV(){tl.call(this),this.status=1}function nq(e){this.g=e}function nB(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nU(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478&0xffffffff;a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(a<<7&0xffffffff|a>>>25))+((a=s+(i^t&(n^i))+r[1]+0xe8c7b756&0xffffffff)<<12&0xffffffff|a>>>20))+((a=i+(n^s&(t^n))+r[2]+0x242070db&0xffffffff)<<17&0xffffffff|a>>>15))+((a=n+(t^i&(s^t))+r[3]+0xc1bdceee&0xffffffff)<<22&0xffffffff|a>>>10))+((a=t+(s^n&(i^s))+r[4]+0xf57c0faf&0xffffffff)<<7&0xffffffff|a>>>25))+((a=s+(i^t&(n^i))+r[5]+0x4787c62a&0xffffffff)<<12&0xffffffff|a>>>20))+((a=i+(n^s&(t^n))+r[6]+0xa8304613&0xffffffff)<<17&0xffffffff|a>>>15))+((a=n+(t^i&(s^t))+r[7]+0xfd469501&0xffffffff)<<22&0xffffffff|a>>>10))+((a=t+(s^n&(i^s))+r[8]+0x698098d8&0xffffffff)<<7&0xffffffff|a>>>25))+((a=s+(i^t&(n^i))+r[9]+0x8b44f7af&0xffffffff)<<12&0xffffffff|a>>>20))+((a=i+(n^s&(t^n))+r[10]+0xffff5bb1&0xffffffff)<<17&0xffffffff|a>>>15))+((a=n+(t^i&(s^t))+r[11]+0x895cd7be&0xffffffff)<<22&0xffffffff|a>>>10))+((a=t+(s^n&(i^s))+r[12]+0x6b901122&0xffffffff)<<7&0xffffffff|a>>>25))+((a=s+(i^t&(n^i))+r[13]+0xfd987193&0xffffffff)<<12&0xffffffff|a>>>20))+((a=i+(n^s&(t^n))+r[14]+0xa679438e&0xffffffff)<<17&0xffffffff|a>>>15))+((a=n+(t^i&(s^t))+r[15]+0x49b40821&0xffffffff)<<22&0xffffffff|a>>>10))+((a=t+(i^s&(n^i))+r[1]+0xf61e2562&0xffffffff)<<5&0xffffffff|a>>>27))+((a=s+(n^i&(t^n))+r[6]+0xc040b340&0xffffffff)<<9&0xffffffff|a>>>23))+((a=i+(t^n&(s^t))+r[11]+0x265e5a51&0xffffffff)<<14&0xffffffff|a>>>18))+((a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa&0xffffffff)<<20&0xffffffff|a>>>12))+((a=t+(i^s&(n^i))+r[5]+0xd62f105d&0xffffffff)<<5&0xffffffff|a>>>27))+((a=s+(n^i&(t^n))+r[10]+0x2441453&0xffffffff)<<9&0xffffffff|a>>>23))+((a=i+(t^n&(s^t))+r[15]+0xd8a1e681&0xffffffff)<<14&0xffffffff|a>>>18))+((a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8&0xffffffff)<<20&0xffffffff|a>>>12))+((a=t+(i^s&(n^i))+r[9]+0x21e1cde6&0xffffffff)<<5&0xffffffff|a>>>27))+((a=s+(n^i&(t^n))+r[14]+0xc33707d6&0xffffffff)<<9&0xffffffff|a>>>23))+((a=i+(t^n&(s^t))+r[3]+0xf4d50d87&0xffffffff)<<14&0xffffffff|a>>>18))+((a=n+(s^t&(i^s))+r[8]+0x455a14ed&0xffffffff)<<20&0xffffffff|a>>>12))+((a=t+(i^s&(n^i))+r[13]+0xa9e3e905&0xffffffff)<<5&0xffffffff|a>>>27))+((a=s+(n^i&(t^n))+r[2]+0xfcefa3f8&0xffffffff)<<9&0xffffffff|a>>>23))+((a=i+(t^n&(s^t))+r[7]+0x676f02d9&0xffffffff)<<14&0xffffffff|a>>>18))+((a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a&0xffffffff)<<20&0xffffffff|a>>>12))+((a=t+(n^i^s)+r[5]+0xfffa3942&0xffffffff)<<4&0xffffffff|a>>>28))+((a=s+(t^n^i)+r[8]+0x8771f681&0xffffffff)<<11&0xffffffff|a>>>21))+((a=i+(s^t^n)+r[11]+0x6d9d6122&0xffffffff)<<16&0xffffffff|a>>>16))+((a=n+(i^s^t)+r[14]+0xfde5380c&0xffffffff)<<23&0xffffffff|a>>>9))+((a=t+(n^i^s)+r[1]+0xa4beea44&0xffffffff)<<4&0xffffffff|a>>>28))+((a=s+(t^n^i)+r[4]+0x4bdecfa9&0xffffffff)<<11&0xffffffff|a>>>21))+((a=i+(s^t^n)+r[7]+0xf6bb4b60&0xffffffff)<<16&0xffffffff|a>>>16))+((a=n+(i^s^t)+r[10]+0xbebfbc70&0xffffffff)<<23&0xffffffff|a>>>9))+((a=t+(n^i^s)+r[13]+0x289b7ec6&0xffffffff)<<4&0xffffffff|a>>>28))+((a=s+(t^n^i)+r[0]+0xeaa127fa&0xffffffff)<<11&0xffffffff|a>>>21))+((a=i+(s^t^n)+r[3]+0xd4ef3085&0xffffffff)<<16&0xffffffff|a>>>16))+((a=n+(i^s^t)+r[6]+0x4881d05&0xffffffff)<<23&0xffffffff|a>>>9))+((a=t+(n^i^s)+r[9]+0xd9d4d039&0xffffffff)<<4&0xffffffff|a>>>28))+((a=s+(t^n^i)+r[12]+0xe6db99e5&0xffffffff)<<11&0xffffffff|a>>>21))+((a=i+(s^t^n)+r[15]+0x1fa27cf8&0xffffffff)<<16&0xffffffff|a>>>16))+((a=n+(i^s^t)+r[2]+0xc4ac5665&0xffffffff)<<23&0xffffffff|a>>>9))+((a=t+(i^(n|~s))+r[0]+0xf4292244&0xffffffff)<<6&0xffffffff|a>>>26))+((a=s+(n^(t|~i))+r[7]+0x432aff97&0xffffffff)<<10&0xffffffff|a>>>22))+((a=i+(t^(s|~n))+r[14]+0xab9423a7&0xffffffff)<<15&0xffffffff|a>>>17))+((a=n+(s^(i|~t))+r[5]+0xfc93a039&0xffffffff)<<21&0xffffffff|a>>>11))+((a=t+(i^(n|~s))+r[12]+0x655b59c3&0xffffffff)<<6&0xffffffff|a>>>26))+((a=s+(n^(t|~i))+r[3]+0x8f0ccc92&0xffffffff)<<10&0xffffffff|a>>>22))+((a=i+(t^(s|~n))+r[10]+0xffeff47d&0xffffffff)<<15&0xffffffff|a>>>17))+((a=n+(s^(i|~t))+r[1]+0x85845dd1&0xffffffff)<<21&0xffffffff|a>>>11))+((a=t+(i^(n|~s))+r[8]+0x6fa87e4f&0xffffffff)<<6&0xffffffff|a>>>26))+((a=s+(n^(t|~i))+r[15]+0xfe2ce6e0&0xffffffff)<<10&0xffffffff|a>>>22))+((a=i+(t^(s|~n))+r[6]+0xa3014314&0xffffffff)<<15&0xffffffff|a>>>17))+((a=n+(s^(i|~t))+r[13]+0x4e0811a1&0xffffffff)<<21&0xffffffff|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+0xf7537e82&0xffffffff)<<6&0xffffffff|a>>>26))+((a=s+(n^(t|~i))+r[11]+0xbd3af235&0xffffffff)<<10&0xffffffff|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+0x2ad7d2bb&0xffffffff)<<15&0xffffffff|a>>>17))|~t))+r[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(i+(a<<21&0xffffffff|a>>>11))&0xffffffff,e.g[2]=e.g[2]+i&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function nz(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(M=nt.prototype).Oa=function(e){this.M=e},M.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ts.g(),this.C=this.u?tr(this.u):tr(ts),this.g.onreadystatechange=B(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void ns(this,e)}if(e=n||"",n=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(let e of r.keys())n.set(e,r.get(e))}}for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=O.FormData&&e instanceof O.FormData,!(0<=j(ni,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;nu(this),0<this.B&&((this.L=(s=this.g,en&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=B(this.ua,this)):this.A=eQ(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){ns(this,e)}},M.ua=function(){void 0!==L&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eO(this,"timeout"),this.abort(8))},M.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eO(this,"complete"),eO(this,"abort"),nl(this))},M.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),nl(this,!0)),nt.$.N.call(this)},M.La=function(){this.s||(this.G||this.v||this.l?no(this):this.kb())},M.kb=function(){no(this)},M.isActive=function(){return!!this.g},M.da=function(){try{return 2<nh(this)?this.g.status:-1}catch(e){return -1}},M.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},M.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ne(t)}},M.Ia=function(){return this.m},M.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(M=nm.prototype).ra=8,M.H=1,M.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new th(this,this.l,e),s=this.s;if(this.U&&(s?ex(s=ev(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=n_(this,i,t),tR(n=tD(this.I),"RID",e),tR(n,"CVER",22),this.F&&tR(n,"X-HTTP-Session-Id",this.F),nx(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(nf(s)))+"&"+t:this.o&&nd(n,this.o,s)),tZ(this.i,i),this.bb&&tR(n,"TYPE","init"),this.P?(tR(n,"$req",t),tR(n,"SID","null"),i.aa=!0,tm(i,n,null)):tm(i,n,t),this.H=2}}else 3==this.H&&(e?nb(this,e):0==this.j.length||tY(this.i)||nb(this))}},M.Ma=function(){if(this.u=null,nS(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=e7(B(this.jb,this),e)}},M.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,e8(10),ny(this),nS(this))},M.ib=function(){null!=this.v&&(this.v=null,ny(this),nE(this),e8(19))},M.pb=function(e){e?(this.l.info("Successfully pinged google.com"),e8(2)):(this.l.info("Failed to ping google.com"),e8(1))},M.isActive=function(){return!!this.h&&this.h.isActive(this)},(M=nL.prototype).Ba=function(){},M.Aa=function(){},M.za=function(){},M.ya=function(){},M.isActive=function(){return!0},M.Va=function(){},nO.prototype.g=function(e,t){return new nP(e,t)},z(nP,eL),nP.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;e8(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=nR(e,null,e.Y),nv(e)},nP.prototype.close=function(){np(this.g)},nP.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eF(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&nv(t)},nP.prototype.N=function(){this.g.h=null,delete this.j,np(this.g),delete this.g,nP.$.N.call(this)},z(nF,to),z(nV,tl),z(nq,nL),nq.prototype.Ba=function(){eO(this.g,"a")},nq.prototype.Aa=function(e){eO(this.g,new nF(e))},nq.prototype.za=function(e){eO(this.g,new nV)},nq.prototype.ya=function(){eO(this.g,"b")},z(nB,function(){this.blockSize=-1}),nB.prototype.reset=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.i=this.h=0},nB.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nU(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nU(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nU(this,r),i=0;break}}this.h=i,this.i+=t},nB.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nG={};function nj(e){var t;return -128<=e&&128>e?(t=function(e){return new nz([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(nG,e)?nG[e]:nG[e]=t(e)):new nz([0|e],0>e?-1:0)}function nK(e){if(isNaN(e)||!isFinite(e))return nQ;if(0>e)return nJ(nK(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=n$;return new nz(t,0)}var n$=0x100000000,nQ=nj(0),nH=nj(1),nW=nj(0x1000000);function nY(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function nX(e){return -1==e.h}function nJ(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nz(n,~e.h).add(nH)}function nZ(e,t){return e.add(nJ(t))}function n0(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function n1(e,t){this.g=e,this.h=t}function n2(e,t){if(nY(t))throw Error("division by zero");if(nY(e))return new n1(nQ,nQ);if(nX(e))return t=n2(nJ(e),t),new n1(nJ(t.g),nJ(t.h));if(nX(t))return t=n2(e,nJ(t)),new n1(nJ(t.g),t.h);if(30<e.g.length){if(nX(e)||nX(t))throw Error("slowDivide_ only works with positive integers.");for(var n=nH,r=t;0>=r.X(e);)n=n5(n),r=n5(r);var i=n6(n,1),s=n6(r,1);for(r=n6(r,2),n=n6(n,2);!nY(r);){var a=s.add(r);0>=a.X(e)&&(i=i.add(n),s=a),r=n6(r,1),n=n6(n,1)}return t=nZ(e,i.R(t)),new n1(i,t)}for(i=nQ;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=nK(n)).R(t);nX(a)||0<a.X(e);)a=(s=nK(n-=r)).R(t);nY(s)&&(s=nH),i=i.add(s),e=nZ(e,a)}return new n1(i,e)}function n5(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nz(n,e.h)}function n6(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nz(i,e.h)}(M=nz.prototype).ea=function(){if(nX(this))return-nJ(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:n$+r)*t,t*=n$}return e},M.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(nY(this))return"0";if(nX(this))return"-"+nJ(this).toString(e);for(var t=nK(Math.pow(e,6)),n=this,r="";;){var i=n2(n,t).g,s=((0<(n=nZ(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(nY(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},M.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},M.X=function(e){return nX(e=nZ(this,e))?-1:nY(e)?0:1},M.abs=function(){return nX(this)?nJ(this):this},M.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new nz(n,-0x80000000&n[n.length-1]?-1:0)},M.R=function(e){if(nY(this)||nY(e))return nQ;if(nX(this))return nX(e)?nJ(this).R(nJ(e)):nJ(nJ(this).R(e));if(nX(e))return nJ(this.R(nJ(e)));if(0>this.X(nW)&&0>e.X(nW))return nK(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=a*l,n0(n,2*r+2*i),n[2*r+2*i+1]+=s*l,n0(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,n0(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,n0(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nz(n,0)},M.gb=function(e){return n2(this,e).h},M.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nz(n,this.h&e.h)},M.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nz(n,this.h|e.h)},M.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nz(n,this.h^e.h)},nO.prototype.createWebChannel=nO.prototype.g,nP.prototype.send=nP.prototype.u,nP.prototype.open=nP.prototype.m,nP.prototype.close=nP.prototype.close,te.NO_ERROR=0,te.TIMEOUT=8,te.HTTP_ERROR=6,tt.COMPLETE="complete",ti.EventType=ta,ta.OPEN="a",ta.CLOSE="b",ta.ERROR="c",ta.MESSAGE="d",eL.prototype.listen=eL.prototype.O,nt.prototype.listenOnce=nt.prototype.P,nt.prototype.getLastError=nt.prototype.Sa,nt.prototype.getLastErrorCode=nt.prototype.Ia,nt.prototype.getStatus=nt.prototype.da,nt.prototype.getResponseJson=nt.prototype.Wa,nt.prototype.getResponseText=nt.prototype.ja,nt.prototype.send=nt.prototype.ha,nt.prototype.setWithCredentials=nt.prototype.Oa,nB.prototype.digest=nB.prototype.l,nB.prototype.reset=nB.prototype.reset,nB.prototype.update=nB.prototype.j,nz.prototype.add=nz.prototype.add,nz.prototype.multiply=nz.prototype.R,nz.prototype.modulo=nz.prototype.gb,nz.prototype.compare=nz.prototype.X,nz.prototype.toNumber=nz.prototype.ea,nz.prototype.toString=nz.prototype.toString,nz.prototype.getBits=nz.prototype.D,nz.fromNumber=nK,nz.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return nJ(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=nK(Math.pow(n,8)),i=nQ,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=nK(Math.pow(n,a)),i=i.R(a).add(nK(o))):i=(i=i.R(r)).add(nK(o))}return i};let n3="@firebase/firestore";class n4{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n4.UNAUTHENTICATED=new n4(null),n4.GOOGLE_CREDENTIALS=new n4("google-credentials-uid"),n4.FIRST_PARTY=new n4("first-party-uid"),n4.MOCK_USER=new n4("mock-user");let n8="10.8.0",n9=new class{constructor(e){this.name=e,this._logLevel=D,this._logHandler=N,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in R))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?C[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,R.DEBUG,...e),this._logHandler(this,R.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,R.VERBOSE,...e),this._logHandler(this,R.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,R.INFO,...e),this._logHandler(this,R.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,R.WARN,...e),this._logHandler(this,R.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,R.ERROR,...e),this._logHandler(this,R.ERROR,...e)}}("@firebase/firestore");function n7(){return n9.logLevel}function re(e){n9.setLogLevel(e)}function rt(e,...t){if(n9.logLevel<=R.DEBUG){let n=t.map(ri);n9.debug(`Firestore (${n8}): ${e}`,...n)}}function rn(e,...t){if(n9.logLevel<=R.ERROR){let n=t.map(ri);n9.error(`Firestore (${n8}): ${e}`,...n)}}function rr(e,...t){if(n9.logLevel<=R.WARN){let n=t.map(ri);n9.warn(`Firestore (${n8}): ${e}`,...n)}}function ri(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function rs(e="Unexpected state"){let t=`FIRESTORE (${n8}) INTERNAL ASSERTION FAILED: `+e;throw rn(t),Error(t)}function ra(e,t){e||rs()}let ro={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rl extends b{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ru{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rc{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n4.UNAUTHENTICATED))}shutdown(){}}class rf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rd{constructor(e){this.t=e,this.currentUser=n4.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new ru;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ru,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{rt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(rt("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ru)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||rs(),new rh(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||rs(),new n4(e)}}class rg{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=n4.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rm{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new rg(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(n4.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ry{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=e=>{null!=e.error&&rt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,rt("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{rt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?r(e):rt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||rs(),this.R=e.token,new rp(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class rw{getToken(){return Promise.resolve(new rp(""))}invalidateToken(){}start(e,t){}shutdown(){}}class rv{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function rb(e,t){return e<t?-1:e>t?1:0}function rx(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class r_{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rl(ro.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new rl(ro.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r_.fromMillis(Date.now())}static fromDate(e){return r_.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r_(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rb(this.nanoseconds,e.nanoseconds):rb(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rI{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rI(e)}static min(){return new rI(new r_(0,0))}static max(){return new rI(new r_(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rE{constructor(e,t,n){void 0===t?t=0:t>e.length&&rs(),void 0===n?n=e.length-t:n>e.length-t&&rs(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rE.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rE?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rT extends rE{construct(e,t,n){return new rT(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new rl(ro.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new rT(t)}static emptyPath(){return new rT([])}}let rS=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rC extends rE{construct(e,t,n){return new rC(e,t,n)}static isValidIdentifier(e){return rS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rC.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rC(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new rl(ro.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new rl(ro.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rl(ro.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rl(ro.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rC(t)}static emptyPath(){return new rC([])}}class rD{constructor(e){this.path=e}static fromPath(e){return new rD(rT.fromString(e))}static fromName(e){return new rD(rT.fromString(e).popFirst(5))}static empty(){return new rD(rT.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rT.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rT.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rD(new rT(e.slice()))}}class rA{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rN(e){return e.fields.find(e=>2===e.kind)}function rk(e){return e.fields.filter(e=>2!==e.kind)}function rR(e,t){let n=rb(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=rC.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:rb(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return rb(e.fields.length,t.fields.length)}rA.UNKNOWN_ID=-1;class rM{constructor(e,t){this.fieldPath=e,this.kind=t}}class rL{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rL(0,rF.min())}}function rO(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rF(rI.fromTimestamp(1e9===r?new r_(n+1,0):new r_(n,r)),rD.empty(),t)}function rP(e){return new rF(e.readTime,e.key,-1)}class rF{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rF(rI.min(),rD.empty(),-1)}static max(){return new rF(rI.max(),rD.empty(),-1)}}function rV(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=rD.comparator(e.documentKey,t.documentKey))?n:rb(e.largestBatchId,t.largestBatchId)}let rq="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rB{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rU(e){if(e.code!==ro.FAILED_PRECONDITION||e.message!==rq)throw e;rt("LocalStore","Unexpectedly lost primary lease")}class rz{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&rs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rz((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rz?t:rz.resolve(t)}catch(e){return rz.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rz.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rz.reject(t)}static resolve(e){return new rz((t,n)=>{t(e)})}static reject(e){return new rz((t,n)=>{n(e)})}static waitFor(e){return new rz((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rz.resolve(!1);for(let n of e)t=t.next(e=>e?rz.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rz((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rz((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class rG{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ru,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new r$(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{let n=rX(t.target.error);this.V.reject(new r$(e,n))}}static open(e,t,n,r){try{return new rG(t,e.transaction(r,n))}catch(e){throw new r$(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(rt("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rH(this.transaction.objectStore(e))}}class rj{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===rj.S(w())&&rn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return rt("SimpleDb","Removing database:",e),rW(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}())return!1;if(rj.C())return!0;let e=w(),t=rj.S(e),n=rj.v(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){var e;return void 0!==u&&"YES"===(null===(e=u.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static v(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async O(e){return this.db||(rt("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new r$(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new rl(ro.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new rl(ro.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new r$(e,r))},r.onupgradeneeded=e=>{rt("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next(()=>{rt("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.O(e);let t=rG.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),rz.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(rt("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rK{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return rW(this.k.delete())}}class r$ extends rl{constructor(e,t){super(ro.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rQ(e){return"IndexedDbTransactionError"===e.name}class rH{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(rt("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(rt("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),rW(n)}add(e){return rt("SimpleDb","ADD",this.store.name,e,e),rW(this.store.add(e))}get(e){return rW(this.store.get(e)).next(t=>(void 0===t&&(t=null),rt("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return rt("SimpleDb","DELETE",this.store.name,e),rW(this.store.delete(e))}count(){return rt("SimpleDb","COUNT",this.store.name),rW(this.store.count())}W(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new rz((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.G(e,(e,n)=>{t.push(n)}).next(()=>t)}}j(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new rz((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}H(e,t){rt("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.J=!1;let r=this.cursor(n);return this.G(r,(e,t,n)=>n.delete())}Y(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.G(r,t)}Z(e){let t=this.cursor({});return new rz((n,r)=>{t.onerror=e=>{r(rX(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}G(e,t){let n=[];return new rz((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new rK(i),a=t(i.primaryKey,i.value,s);if(a instanceof rz){let e=a.catch(e=>(s.done(),rz.reject(e)));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}}).next(()=>rz.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rW(e){return new rz((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(rX(e.target.error))}})}let rY=!1;function rX(e){let t=rj.S(w());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rl("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rY||(rY=!0,setTimeout(()=>{throw e},0)),e}}return e}class rJ{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){rt("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{rt("IndexBackfiller",`Documents written: ${await this.X.te()}`)}catch(e){rQ(e)?rt("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await rU(e)}await this.ee(6e4)})}}class rZ{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))}ne(e,t){let n=new Set,r=t,i=!0;return rz.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return rt("IndexBackfiller",`Processing collection: ${t}`),this.re(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ie(r,n)).next(n=>(rt("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}ie(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=rP(t);rV(r,n)>0&&(n=r)}),new rF(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class r0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}function r1(e){return null==e}function r2(e){return 0===e&&1/e==-1/0}function r5(e){return"number"==typeof e&&Number.isInteger(e)&&!r2(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function r6(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}function r3(e){let t=e.length;if(t>=2||rs(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||rs(),rT.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&rs(),e.charAt(t+1)){case"\x01":let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:rs()}s=t+2}return new rT(r)}r0._e=-1;let r4=["userId","batchId"],r8={},r9=["prefixPath","collectionGroup","readTime","documentId"],r7=["prefixPath","collectionGroup","documentId"],ie=["collectionGroup","readTime","prefixPath","documentId"],it=["canonicalId","targetId"],ir=["targetId","path"],ii=["path","targetId"],is=["collectionId","parent"],ia=["indexId","uid"],io=["uid","sequenceNumber"],il=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iu=["indexId","uid","orderedDocumentKey"],ih=["userId","collectionPath","documentId"],ic=["userId","collectionPath","largestBatchId"],id=["userId","collectionGroup","largestBatchId"],ig=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],im=[...ig,"documentOverlays"],ip=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],iy=[...ip,"indexConfiguration","indexState","indexEntries"];class iw extends rB{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function iv(e,t){return rj.M(e.ae,t)}function ib(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ix(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function i_(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class iI{constructor(e,t){this.comparator=e,this.root=t||iT.EMPTY}insert(e,t){return new iI(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,iT.BLACK,null,null))}remove(e){return new iI(this.comparator,this.root.remove(e,this.comparator).copy(null,null,iT.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new iE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new iE(this.root,e,this.comparator,!1)}getReverseIterator(){return new iE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new iE(this.root,e,this.comparator,!0)}}class iE{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class iT{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:iT.RED,this.left=null!=r?r:iT.EMPTY,this.right=null!=i?i:iT.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new iT(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return iT.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return iT.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,iT.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,iT.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw rs();let e=this.left.check();if(e!==this.right.check())throw rs();return e+(this.isRed()?0:1)}}iT.EMPTY=null,iT.RED=!0,iT.BLACK=!1,iT.EMPTY=new class{constructor(){this.size=0}get key(){throw rs()}get value(){throw rs()}get color(){throw rs()}get left(){throw rs()}get right(){throw rs()}copy(e,t,n,r,i){return this}insert(e,t,n){return new iT(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class iS{constructor(e){this.comparator=e,this.data=new iI(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iC(this.data.getIterator())}getIteratorFrom(e){return new iC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iS)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iS(this.comparator);return t.data=e,t}}class iC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function iD(e){return e.hasNext()?e.getNext():void 0}class iA{constructor(e){this.fields=e,e.sort(rC.comparator)}static empty(){return new iA([])}unionWith(e){let t=new iS(rC.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new iA(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rx(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class iN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function ik(){return"undefined"!=typeof atob}class iR{constructor(e){this.binaryString=e}static fromBase64String(e){return new iR(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new iN("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new iR(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rb(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iR.EMPTY_BYTE_STRING=new iR("");let iM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iL(e){if(e||rs(),"string"==typeof e){let t=0,n=iM.exec(e);if(n||rs(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:iO(e.seconds),nanos:iO(e.nanos)}}function iO(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iP(e){return"string"==typeof e?iR.fromBase64String(e):iR.fromUint8Array(e)}function iF(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function iV(e){let t=e.mapValue.fields.__previous_value__;return iF(t)?iV(t):t}function iq(e){let t=iL(e.mapValue.fields.__local_write_time__.timestampValue);return new r_(t.seconds,t.nanos)}class iB{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class iU{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iU("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iU&&e.projectId===this.projectId&&e.database===this.database}}let iz={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},iG={nullValue:"NULL_VALUE"};function ij(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?iF(e)?4:i5(e)?0x1fffffffffffff:10:rs()}function iK(e,t){if(e===t)return!0;let n=ij(e);if(n!==ij(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iq(e).isEqual(iq(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=iL(e.timestampValue),r=iL(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return iP(e.bytesValue).isEqual(iP(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return iO(e.geoPointValue.latitude)===iO(t.geoPointValue.latitude)&&iO(e.geoPointValue.longitude)===iO(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return iO(e.integerValue)===iO(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=iO(e.doubleValue),r=iO(t.doubleValue);return n===r?r2(n)===r2(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return rx(e.arrayValue.values||[],t.arrayValue.values||[],iK);case 10:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ib(n)!==ib(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!iK(n[e],r[e])))return!1;return!0}(e,t);default:return rs()}}function i$(e,t){return void 0!==(e.values||[]).find(e=>iK(e,t))}function iQ(e,t){if(e===t)return 0;let n=ij(e),r=ij(t);if(n!==r)return rb(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return rb(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=iO(e.integerValue||e.doubleValue),r=iO(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return iH(e.timestampValue,t.timestampValue);case 4:return iH(iq(e),iq(t));case 5:return rb(e.stringValue,t.stringValue);case 6:return function(e,t){let n=iP(e),r=iP(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rb(n[e],r[e]);if(0!==t)return t}return rb(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=rb(iO(e.latitude),iO(t.latitude));return 0!==n?n:rb(iO(e.longitude),iO(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=iQ(n[e],r[e]);if(t)return t}return rb(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===iz.mapValue&&t===iz.mapValue)return 0;if(e===iz.mapValue)return 1;if(t===iz.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rb(r[e],s[e]);if(0!==t)return t;let a=iQ(n[r[e]],i[s[e]]);if(0!==a)return a}return rb(r.length,s.length)}(e.mapValue,t.mapValue);default:throw rs()}}function iH(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rb(e,t);let n=iL(e),r=iL(t),i=rb(n.seconds,r.seconds);return 0!==i?i:rb(n.nanos,r.nanos)}function iW(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=iL(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?iP(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,rD.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=iW(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${iW(e.fields[i])}`;return n+"}"}(e.mapValue):rs()}function iY(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iX(e){return!!e&&"integerValue"in e}function iJ(e){return!!e&&"arrayValue"in e}function iZ(e){return!!e&&"nullValue"in e}function i0(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function i1(e){return!!e&&"mapValue"in e}function i2(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return ix(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=i2(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=i2(e.arrayValue.values[n]);return t}return Object.assign({},e)}function i5(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function i6(e,t){let n=iQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function i3(e,t){let n=iQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class i4{constructor(e){this.value=e}static empty(){return new i4({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!i1(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=i2(t)}setAll(e){let t=rC.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=i2(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());i1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iK(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];i1(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(ix(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new i4(i2(this.value))}}class i8{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new i8(e,0,rI.min(),rI.min(),rI.min(),i4.empty(),0)}static newFoundDocument(e,t,n,r){return new i8(e,1,t,rI.min(),n,r,0)}static newNoDocument(e,t){return new i8(e,2,t,rI.min(),rI.min(),i4.empty(),0)}static newUnknownDocument(e,t){return new i8(e,3,t,rI.min(),rI.min(),i4.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rI.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=i4.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=i4.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rI.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof i8&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i8(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class i9{constructor(e,t){this.position=e,this.inclusive=t}}function i7(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?rD.comparator(rD.fromName(a.referenceValue),n.key):iQ(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function se(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iK(e.position[n],t.position[n]))return!1;return!0}class st{constructor(e,t="asc"){this.field=e,this.dir=t}}class sn{}class sr extends sn{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new sh(e,t,n):"array-contains"===t?new sg(e,n):"in"===t?new sm(e,n):"not-in"===t?new sp(e,n):"array-contains-any"===t?new sy(e,n):new sr(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new sc(e,n):new sf(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(iQ(t,this.value)):null!==t&&ij(this.value)===ij(t)&&this.matchesComparison(iQ(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class si extends sn{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new si(e,t)}matches(e){return ss(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function ss(e){return"and"===e.op}function sa(e){return"or"===e.op}function so(e){return sl(e)&&ss(e)}function sl(e){for(let t of e.filters)if(t instanceof si)return!1;return!0}function su(e,t){let n=e.filters.concat(t);return si.create(n,e.op)}class sh extends sr{constructor(e,t,n){super(e,t,n),this.key=rD.fromName(n.referenceValue)}matches(e){let t=rD.comparator(e.key,this.key);return this.matchesComparison(t)}}class sc extends sr{constructor(e,t){super(e,"in",t),this.keys=sd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sf extends sr{constructor(e,t){super(e,"not-in",t),this.keys=sd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sd(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>rD.fromName(e.referenceValue))}class sg extends sr{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return iJ(t)&&i$(t.arrayValue,this.value)}}class sm extends sr{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&i$(this.value.arrayValue,t)}}class sp extends sr{constructor(e,t){super(e,"not-in",t)}matches(e){if(i$(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!i$(this.value.arrayValue,t)}}class sy extends sr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!iJ(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>i$(this.value.arrayValue,e))}}class sw{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ce=null}}function sv(e,t=null,n=[],r=[],i=null,s=null,a=null){return new sw(e,t,n,r,i,s,a)}function sb(e){if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof sr)return t.field.canonicalString()+t.op.toString()+iW(t.value);if(so(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),r1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>iW(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>iW(e)).join(",")),e.ce=t}return e.ce}function sx(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof sr?n instanceof sr&&t.op===n.op&&t.field.isEqual(n.field)&&iK(t.value,n.value):t instanceof si?n instanceof si&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void rs()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!se(e.startAt,t.startAt)&&se(e.endAt,t.endAt)}function s_(e){return rD.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function sI(e,t){return e.filters.filter(e=>e instanceof sr&&e.field.isEqual(t))}function sE(e,t,n){let r=iG,i=!0;for(let n of sI(e,t)){let e=iG,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?iG:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?iY(iU.empty(),rD.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:rs();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=iG}0>i6({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>i6({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function sT(e,t,n){let r=iz,i=!0;for(let n of sI(e,t)){let e=iz,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?iY(iU.empty(),rD.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?iz:rs(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=iz}i3({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];i3({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class sS{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function sC(e){return new sS(e)}function sD(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sA(e){return null!==e.collectionGroup}function sN(e){if(null===e.le){let t;e.le=[];let n=new Set;for(let t of e.explicitOrderBy)e.le.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new iS(rC.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.le.push(new st(t,r))}),n.has(rC.keyField().canonicalString())||e.le.push(new st(rC.keyField(),r))}return e.le}function sk(e){return e.he||(e.he=sR(e,sN(e))),e.he}function sR(e,t){if("F"===e.limitType)return sv(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new st(e.field,t)});let n=e.endAt?new i9(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new i9(e.startAt.position,e.startAt.inclusive):null;return sv(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function sM(e,t){let n=e.filters.concat([t]);return new sS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sL(e,t,n){return new sS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sO(e,t){return sx(sk(e),sk(t))&&e.limitType===t.limitType}function sP(e){return`${sb(sk(e))}|lt:${e.limitType}`}function sF(e){var t;let n;return`Query(target=${n=(t=sk(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof sr?`${t.field.canonicalString()} ${t.op} ${iW(t.value)}`:t instanceof si?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),r1(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>iW(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>iW(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function sV(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rD.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of sN(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&!(e.startAt&&!function(e,t,n){let r=i7(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sN(e),t))&&!(e.endAt&&!function(e,t,n){let r=i7(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sN(e),t))}function sq(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sB(e){return(t,n)=>{let r=!1;for(let i of sN(e)){let e=function(e,t,n){let r=e.field.isKeyField()?rD.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?iQ(r,i):rs()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return rs()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sU{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ix(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return i_(this.inner)}size(){return this.innerSize}}let sz=new iI(rD.comparator),sG=new iI(rD.comparator);function sj(...e){let t=sG;for(let n of e)t=t.insert(n.key,n);return t}function sK(e){let t=sG;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function s$(){return new sU(e=>e.toString(),(e,t)=>e.isEqual(t))}let sQ=new iI(rD.comparator),sH=new iS(rD.comparator);function sW(...e){let t=sH;for(let n of e)t=t.add(n);return t}let sY=new iS(rb);function sX(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:r2(t)?"-0":t}}function sJ(e){return{integerValue:""+e}}function sZ(e,t){return r5(t)?sJ(t):sX(e,t)}class s0{constructor(){this._=void 0}}function s1(e,t){return e instanceof s8?iX(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class s2 extends s0{}class s5 extends s0{constructor(e){super(),this.elements=e}}function s6(e,t){let n=s7(t);for(let t of e.elements)n.some(e=>iK(e,t))||n.push(t);return{arrayValue:{values:n}}}class s3 extends s0{constructor(e){super(),this.elements=e}}function s4(e,t){let n=s7(t);for(let t of e.elements)n=n.filter(e=>!iK(e,t));return{arrayValue:{values:n}}}class s8 extends s0{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function s9(e){return iO(e.integerValue||e.doubleValue)}function s7(e){return iJ(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ae{constructor(e,t){this.field=e,this.transform=t}}class at{constructor(e,t){this.version=e,this.transformResults=t}}class an{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new an}static exists(e){return new an(void 0,e)}static updateTime(e){return new an(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ar(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ai{}function as(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ad(e.key,an.none()):new al(e.key,e.data,an.none());{let n=e.data,r=i4.empty(),i=new iS(rC.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new au(e.key,r,new iA(i.toArray()),an.none())}}function aa(e,t,n,r){return e instanceof al?function(e,t,n,r){if(!ar(e.precondition,t))return n;let i=e.value.clone(),s=af(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof au?function(e,t,n,r){if(!ar(e.precondition,t))return n;let i=af(e.fieldTransforms,r,t),s=t.data;return s.setAll(ah(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):ar(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ao(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&rx(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof s5&&r instanceof s5||n instanceof s3&&r instanceof s3?rx(n.elements,r.elements,iK):n instanceof s8&&r instanceof s8?iK(n.Ie,r.Ie):n instanceof s2&&r instanceof s2)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class al extends ai{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class au extends ai{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ah(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ac(e,t,n){var r;let i=new Map;e.length===n.length||rs();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof s5?s6(o,l):o instanceof s3?s4(o,l):r))}return i}function af(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof s2?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&iF(t)&&(t=iV(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):e instanceof s5?s6(e,s):e instanceof s3?s4(e,s):function(e,t){let n=s1(e,t),r=s9(n)+s9(e.Ie);return iX(n)&&iX(e.Ie)?sJ(r):sX(e.serializer,r)}(e,s))}return r}class ad extends ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ag extends ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class am{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){var r;let i=this.mutations[t];i.key.isEqual(e.key)&&(r=n[t],i instanceof al?function(e,t,n){let r=e.value.clone(),i=ac(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(i,e,r):i instanceof au?function(e,t,n){if(!ar(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=ac(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ah(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(i,e,r):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,r))}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=aa(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=aa(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=s$();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=as(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(rI.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sW())}isEqual(e){return this.batchId===e.batchId&&rx(this.mutations,e.mutations,(e,t)=>ao(e,t))&&rx(this.baseMutations,e.baseMutations,(e,t)=>ao(e,t))}}class ap{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||rs();let r=sQ,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ap(e,t,n,r)}}class ay{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class aw{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class av{constructor(e,t){this.count=e,this.unchangedNames=t}}function ab(e){switch(e){default:return rs();case ro.CANCELLED:case ro.UNKNOWN:case ro.DEADLINE_EXCEEDED:case ro.RESOURCE_EXHAUSTED:case ro.INTERNAL:case ro.UNAVAILABLE:case ro.UNAUTHENTICATED:return!1;case ro.INVALID_ARGUMENT:case ro.NOT_FOUND:case ro.ALREADY_EXISTS:case ro.PERMISSION_DENIED:case ro.FAILED_PRECONDITION:case ro.ABORTED:case ro.OUT_OF_RANGE:case ro.UNIMPLEMENTED:case ro.DATA_LOSS:return!0}}function ax(e){if(void 0===e)return rn("GRPC error has no .code"),ro.UNKNOWN;switch(e){case a.OK:return ro.OK;case a.CANCELLED:return ro.CANCELLED;case a.UNKNOWN:return ro.UNKNOWN;case a.DEADLINE_EXCEEDED:return ro.DEADLINE_EXCEEDED;case a.RESOURCE_EXHAUSTED:return ro.RESOURCE_EXHAUSTED;case a.INTERNAL:return ro.INTERNAL;case a.UNAVAILABLE:return ro.UNAVAILABLE;case a.UNAUTHENTICATED:return ro.UNAUTHENTICATED;case a.INVALID_ARGUMENT:return ro.INVALID_ARGUMENT;case a.NOT_FOUND:return ro.NOT_FOUND;case a.ALREADY_EXISTS:return ro.ALREADY_EXISTS;case a.PERMISSION_DENIED:return ro.PERMISSION_DENIED;case a.FAILED_PRECONDITION:return ro.FAILED_PRECONDITION;case a.ABORTED:return ro.ABORTED;case a.OUT_OF_RANGE:return ro.OUT_OF_RANGE;case a.UNIMPLEMENTED:return ro.UNIMPLEMENTED;case a.DATA_LOSS:return ro.DATA_LOSS;default:return rs()}}(o=a||(a={}))[o.OK=0]="OK",o[o.CANCELLED=1]="CANCELLED",o[o.UNKNOWN=2]="UNKNOWN",o[o.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",o[o.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",o[o.NOT_FOUND=5]="NOT_FOUND",o[o.ALREADY_EXISTS=6]="ALREADY_EXISTS",o[o.PERMISSION_DENIED=7]="PERMISSION_DENIED",o[o.UNAUTHENTICATED=16]="UNAUTHENTICATED",o[o.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",o[o.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",o[o.ABORTED=10]="ABORTED",o[o.OUT_OF_RANGE=11]="OUT_OF_RANGE",o[o.UNIMPLEMENTED=12]="UNIMPLEMENTED",o[o.INTERNAL=13]="INTERNAL",o[o.UNAVAILABLE=14]="UNAVAILABLE",o[o.DATA_LOSS=15]="DATA_LOSS";let a_=null;function aI(){return new TextEncoder}let aE=new nz([0xffffffff,0xffffffff],0);function aT(e){let t=aI().encode(e),n=new nB;return n.update(t),new Uint8Array(n.digest())}function aS(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new nz([n,r],0),new nz([i,s],0)]}class aC{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new aD(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new aD(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new aD(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=nz.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(nz.fromNumber(n)));return 1===r.compare(aE)&&(r=new nz([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;let[t,n]=aS(aT(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);if(!this.Ae(r))return!1}return!0}static create(e,t,n){let r=new aC(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Te)return;let[t,n]=aS(aT(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);this.Re(r)}}Re(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class aD extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class aA{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,aN.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new aA(rI.min(),r,new iI(rb),sz,sW())}}class aN{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new aN(n,t,sW(),sW(),sW())}}class ak{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class aR{constructor(e,t){this.targetId=e,this.fe=t}}class aM{constructor(e,t,n=iR.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class aL{constructor(){this.ge=0,this.pe=aF(),this.ye=iR.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=sW(),t=sW(),n=sW();return this.pe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:rs()}}),new aN(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=aF()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,this.ge>=0||rs()}Be(){this.Se=!0,this.we=!0}}class aO{constructor(e){this.Le=e,this.ke=new Map,this.qe=sz,this.Qe=aP(),this.Ke=new iI(rb)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:rs()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((e,n)=>{this.je(n)&&t(n)})}Je(e){let t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){let i=r.target;if(s_(i)){if(0===n){let e=new rD(i.path);this.We(t,e,i8.newNoDocument(e,rI.min()))}else 1===n||rs()}else{let r=this.Ze(t);if(r!==n){let n=this.Xe(e),i=n?this.et(n,e,r):1;0!==i&&(this.He(t),this.Ke=this.Ke.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==a_||a_.tt(function(e,t,n,r,i){var s,a,o,l,u,h;let c={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},f=t.unchangedNames;return f&&(c.bloomFilter={applied:0===i,hashCount:null!==(s=null==f?void 0:f.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==f?void 0:f.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(h=null===(u=null==f?void 0:f.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),c}(r,e.fe,this.Le.nt(),n,i))}}}}Xe(e){let t,n;let r=e.fe.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=iP(i).toUint8Array()}catch(e){if(e instanceof iN)return rr("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new aC(t,s,a)}catch(e){return rr(e instanceof aD?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Te?null:n}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){let n=this.Le.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)}),r}it(e){let t=new Map;this.ke.forEach((n,r)=>{let i=this.Ye(r);if(i){if(n.current&&s_(i.target)){let t=new rD(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,i8.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}});let n=sW();this.Qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.qe.forEach((t,n)=>n.setReadTime(e));let r=new aA(e,t,this.Ke,this.qe,n);return this.qe=sz,this.Qe=aP(),this.Ke=new iI(rb),r}Ue(e,t){if(!this.je(e))return;let n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;let r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new aL,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new iS(rb),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=null!==this.Ye(e);return t||rt("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new aL),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function aP(){return new iI(rD.comparator)}function aF(){return new iI(rD.comparator)}let aV={asc:"ASCENDING",desc:"DESCENDING"},aq={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aB={and:"AND",or:"OR"};class aU{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function az(e,t){return e.useProto3Json||r1(t)?t:{value:t}}function aG(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function aj(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aK(e){return e||rs(),rI.fromTimestamp(function(e){let t=iL(e);return new r_(t.seconds,t.nanos)}(e))}function a$(e,t){return aQ(e,t).canonicalString()}function aQ(e,t){let n=new rT(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function aH(e){let t=rT.fromString(e);return oe(t)||rs(),t}function aW(e,t){return a$(e.databaseId,t.path)}function aY(e,t){let n=aH(t);if(n.get(1)!==e.databaseId.projectId)throw new rl(ro.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rl(ro.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rD(a0(n))}function aX(e,t){return a$(e.databaseId,t)}function aJ(e){let t=aH(e);return 4===t.length?rT.emptyPath():a0(t)}function aZ(e){return new rT(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function a0(e){return e.length>4&&"documents"===e.get(4)||rs(),e.popFirst(5)}function a1(e,t,n){return{name:aW(e,t),fields:n.value.mapValue.fields}}function a2(e,t,n){let r=aY(e,t.name),i=aK(t.updateTime),s=t.createTime?aK(t.createTime):rI.min(),a=new i4({mapValue:{fields:t.fields}}),o=i8.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function a5(e,t){var n;let r;if(t instanceof al)r={update:a1(e,t.key,t.value)};else if(t instanceof ad)r={delete:aW(e,t.key)};else if(t instanceof au)r={update:a1(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ag))return rs();r={verify:aW(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof s2)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof s5)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof s3)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof s8)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw rs()})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aG(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:rs()),r}function a6(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?an.updateTime(aK(n.updateTime)):void 0!==n.exists?an.exists(n.exists):an.none():an.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?("REQUEST_TIME"===t.setToServerValue||rs(),n=new s2):"appendMissingElements"in t?n=new s5(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new s3(t.removeAllFromArray.values||[]):"increment"in t?n=new s8(e,t.increment):rs(),new ae(rC.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=aY(e,t.update.name),s=new i4({mapValue:{fields:t.update.fields}});return t.updateMask?new au(n,s,new iA((t.updateMask.fieldPaths||[]).map(e=>rC.fromServerFormat(e))),r,i):new al(n,s,r,i)}return t.delete?new ad(aY(e,t.delete),r):t.verify?new ag(aY(e,t.verify),r):rs()}function a3(e,t){return{documents:[aX(e,t.path)]}}function a4(e,t){var n,r;let i;let s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=aX(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof sr?function(e){if("=="===e.op){if(i0(e.value))return{unaryFilter:{field:a9(e.field),op:"IS_NAN"}};if(iZ(e.value))return{unaryFilter:{field:a9(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(i0(e.value))return{unaryFilter:{field:a9(e.field),op:"IS_NOT_NAN"}};if(iZ(e.value))return{unaryFilter:{field:a9(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:a9(e.field),op:aq[e.op],value:e.value}}}(t):t instanceof si?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:aB[t.op],filters:n}}}(t):rs()}(si.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:a9(e.field),direction:aV[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=az(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ut:s,parent:i}}function a8(e){var t;let n,r=aJ(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){1===s||rs();let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=a7(e.unaryFilter.field);return sr.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=a7(e.unaryFilter.field);return sr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=a7(e.unaryFilter.field);return sr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=a7(e.unaryFilter.field);return sr.create(i,"!=",{nullValue:"NULL_VALUE"});default:return rs()}}(t):void 0!==t.fieldFilter?sr.create(a7(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return rs()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?si.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rs()}}(t.compositeFilter.op)):rs()}(e);return t instanceof si&&so(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new st(a7(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=r1(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new i9(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new i9(e.values||[],t)}(i.endAt)),new sS(r,a,l,o,u,"F",h,c)}function a9(e){return{fieldPath:e.canonicalString()}}function a7(e){return rC.fromServerFormat(e.fieldPath)}function oe(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class ot{constructor(e,t,n,r,i=rI.min(),s=rI.min(),a=iR.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ot(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class on{constructor(e){this.ct=e}}function or(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:oi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:aW(i=e.ct,t.key),fields:t.data.value.mapValue.fields,updateTime:aG(i,t.version.toTimestamp()),createTime:aG(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:os(t.version)};else{if(!t.isUnknownDocument())return rs();r.unknownDocument={path:n.path.toArray(),version:os(t.version)}}return r}function oi(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function os(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function oa(e){let t=new r_(e.seconds,e.nanoseconds);return rI.fromTimestamp(t)}function oo(e,t){let n=(t.baseMutations||[]).map(t=>a6(e.ct,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>a6(e.ct,t)),i=r_.fromMillis(t.localWriteTimeMs);return new am(t.batchId,i,n,r)}function ol(e){var t;let n=oa(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?oa(e.lastLimboFreeSnapshotVersion):rI.min();return new ot(void 0!==e.query.documents?(1===(t=e.query).documents.length||rs(),sk(sC(aJ(t.documents[0])))):sk(a8(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,iR.fromBase64String(e.resumeToken))}function ou(e,t){let n;let r=os(t.snapshotVersion),i=os(t.lastLimboFreeSnapshotVersion);n=s_(t.target)?a3(e.ct,t.target):a4(e.ct,t.target).ut;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:sb(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function oh(e){let t=a8({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sL(t,t.limit,"L"):t}function oc(e,t){return new ay(t.largestBatchId,a6(e.ct,t.overlayMutation))}function of(e,t){let n=t.path.lastSegment();return[e,r6(t.path.popLast()),n]}function od(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:os(r.readTime),documentKey:r6(r.documentKey.path),largestBatchId:r.largestBatchId}}class og{getBundleMetadata(e,t){return om(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:oa(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return om(e).put({bundleId:t.id,createTime:os(aK(t.createTime)),version:t.version})}getNamedQuery(e,t){return op(e).get(t).next(e=>{if(e)return{name:e.name,query:oh(e.bundledQuery),readTime:oa(e.readTime)}})}saveNamedQuery(e,t){return op(e).put({name:t.name,readTime:os(aK(t.readTime)),bundledQuery:t.bundledQuery})}}function om(e){return iv(e,"bundles")}function op(e){return iv(e,"namedQueries")}class oy{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new oy(e,t.uid||"")}getOverlay(e,t){return ow(e).get(of(this.userId,t)).next(e=>e?oc(this.serializer,e):null)}getOverlays(e,t){let n=s$();return rz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new ay(t,i);r.push(this.ht(e,s))}),rz.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(r6(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ow(e).H("collectionPathOverlayIndex",r))}),rz.waitFor(i)}getOverlaysForCollection(e,t,n){let r=s$(),i=r6(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ow(e).W("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=oc(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=s$(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ow(e).Y({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=oc(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}ht(e,t){return ow(e).put(function(e,t,n){let[r,i,s]=of(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:a5(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function ow(e){return iv(e,"documentOverlays")}class ov{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(iO(e.integerValue));else if("doubleValue"in e){let n=iO(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),r2(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(iP(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?i5(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):rs()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};for(let e of(this.Et(t,55),Object.keys(n)))this.Rt(e,t),this.It(n[e],t)}wt(e,t){let n=e.values||[];for(let e of(this.Et(t,50),n))this.It(e,t)}gt(e,t){this.Et(t,37),rD.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function ob(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}ov.bt=new ov;class ox{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{let e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{let e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Bt(e){let t=this.Lt(e),n=ob(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){let t=this.Lt(e),n=ob(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ct(e){let t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class o_{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class oI{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class oE{constructor(){this.Gt=new ox,this.zt=new o_(this.Gt),this.jt=new oI(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class oT{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new oT(this.indexId,this.documentKey,this.arrayValue,n)}}function oS(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=oC(e.arrayValue,t.arrayValue))?n:0!==(n=oC(e.directionalValue,t.directionalValue))?n:rD.comparator(e.documentKey,t.documentKey)}function oC(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class oD{constructor(e){for(let t of(this.Yt=new iS((e,t)=>rC.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[],e.filters))t.isInequality()?this.Yt=this.Yt.add(t):this.Xt.push(t)}get en(){return this.Yt.size>1}tn(e){if(e.collectionGroup===this.collectionId||rs(),this.en)return!1;let t=rN(e);if(void 0!==t&&!this.nn(t))return!1;let n=rk(e),r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){let e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new iS(rC.comparator),t=[];for(let n of this.Xt)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new rM(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new rM(n.field,0))}}for(let n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new rM(n.field,"asc"===n.dir?0:1)));return new rA(rA.UNKNOWN_ID,this.collectionId,t,rL.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function oA(e){return e instanceof sr}function oN(e){return e instanceof si&&so(e)}function ok(e){return oA(e)||oN(e)||function(e){if(e instanceof si&&sa(e)){for(let t of e.getFilters())if(!oA(t)&&!oN(t))return!1;return!0}return!1}(e)}function oR(e,t){return e instanceof sr||e instanceof si||rs(),t instanceof sr||t instanceof si||rs(),oL(e instanceof sr?t instanceof sr?si.create([e,t],"and"):oM(e,t):t instanceof sr?oM(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||rs(),ss(e)&&ss(t))return su(e,t.getFilters());let n=sa(e)?e:t,r=sa(e)?t:e,i=n.filters.map(e=>oR(e,r));return si.create(i,"or")}(e,t))}function oM(e,t){if(ss(t))return su(t,e.getFilters());{let n=t.filters.map(t=>oR(e,t));return si.create(n,"or")}}function oL(e){if(e instanceof sr||e instanceof si||rs(),e instanceof sr)return e;let t=e.getFilters();if(1===t.length)return oL(t[0]);if(sl(e))return e;let n=t.map(e=>oL(e)),r=[];return n.forEach(t=>{t instanceof sr?r.push(t):t instanceof si&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:si.create(r,e.op)}class oO{constructor(){this._n=new oP}addToCollectionParentIndex(e,t){return this._n.add(t),rz.resolve()}getCollectionParents(e,t){return rz.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return rz.resolve()}deleteFieldIndex(e,t){return rz.resolve()}deleteAllFieldIndexes(e){return rz.resolve()}createTargetIndexes(e,t){return rz.resolve()}getDocumentsMatchingTarget(e,t){return rz.resolve(null)}getIndexType(e,t){return rz.resolve(0)}getFieldIndexes(e,t){return rz.resolve([])}getNextCollectionGroupToUpdate(e){return rz.resolve(null)}getMinOffset(e,t){return rz.resolve(rF.min())}getMinOffsetFromCollectionGroup(e,t){return rz.resolve(rF.min())}updateCollectionGroup(e,t,n){return rz.resolve()}updateIndexEntries(e,t){return rz.resolve()}}class oP{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new iS(rT.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new iS(rT.comparator)).toArray()}}let oF=new Uint8Array(0);class oV{constructor(e,t){this.databaseId=t,this.an=new oP,this.un=new sU(e=>sb(e),(e,t)=>sx(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let i={collectionId:n,parent:r6(r)};return oq(e).put(i)}return rz.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return oq(e).W(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(r3(r.parent))}return n})}addFieldIndex(e,t){let n=oU(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=oz(e);return i.next(e=>{n.put(od(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=oU(e),r=oz(e),i=oB(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=oU(e),n=oB(e),r=oz(e);return t.H().next(()=>n.H()).next(()=>r.H())}createTargetIndexes(e,t){return rz.forEach(this.cn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new oD(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=oB(e),r=!0,i=new Map;return rz.forEach(this.cn(t),t=>this.ln(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sW(),r=[];return rz.forEach(i,(i,s)=>{rt("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${sb(t)}`);let a=function(e,t){let n=rN(t);if(void 0===n)return null;for(let t of sI(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of rk(t))for(let t of sI(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of rk(t)){let t=0===i.kind?sE(e,i.fieldPath,e.startAt):sT(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new i9(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of rk(t)){let t=0===i.kind?sT(e,i.fieldPath,e.endAt):sE(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new i9(n,r)}(s,i),h=this.hn(i,s,l),c=this.hn(i,s,u),f=this.Pn(i,s,o),d=this.In(i.indexId,a,h,l.inclusive,c,u.inclusive,f);return rz.forEach(d,i=>n.j(i,t.limit).next(t=>{t.forEach(t=>{let n=rD.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return rz.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof sr||t instanceof si||rs(),t instanceof sr)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=si.create(n,t.op);return ok(r=oL(r))?r:(r instanceof si||rs(),ss(r)||rs(),r.filters.length>1||rs(),r.filters.reduce((e,t)=>oR(e,t)))}(function e(t){var n,r;if(t instanceof sr||t instanceof si||rs(),t instanceof sr){if(t instanceof sm){let e=(null===(r=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>sr.create(t.field,"==",e)))||[];return si.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return si.create(i,t.op)}(e));return ok(t)||rs(),oA(t)||oN(t)?[t]:t.getFilters()})(si.create(e.filters,"and")).map(t=>sv(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Tn(t[h/l]):oF,c=this.En(e,o,n[h%l],r),f=this.dn(e,o,i[h%l],s),d=a.map(t=>this.En(e,o,t,!0));u.push(...this.createRange(c,f,d))}return u}En(e,t,n,r){let i=new oT(e,rD.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){let i=new oT(e,rD.empty(),t,n);return r?i.Jt():i}ln(e,t){let n=new oD(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.cn(t);return rz.forEach(r,t=>this.ln(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new iS(rC.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}An(e,t){let n=new oE;for(let r of rk(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Ht(r.kind);ov.bt.Pt(e,i)}return n.Wt()}Tn(e){let t=new oE;return ov.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let n=new oE;return ov.bt.Pt(iY(this.databaseId,t),n.Ht(function(e){let t=rk(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new oE);let i=0;for(let s of rk(e)){let e=n[i++];for(let n of r)if(this.Vn(t,s.fieldPath)&&iJ(e))r=this.mn(r,s,e);else{let t=n.Ht(s.kind);ov.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new oE;r.seed(n.Wt()),ov.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find(e=>e instanceof sr&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=oU(e),r=oz(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{let t=[];return rz.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new rL(t.sequenceNumber,new rF(oa(t.readTime),new rD(r3(t.documentKey)),t.largestBatchId)):rL.empty(),r=e.fields.map(([e,t])=>new rM(rC.fromServerFormat(e),t));return new rA(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rb(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=oU(e),i=oz(e);return this.gn(e).next(e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>rz.forEach(t,t=>i.put(od(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return rz.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?rz.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),rz.forEach(i,n=>this.pn(e,t,n).next(t=>{let i=this.yn(r,n);return t.isEqual(i)?rz.resolve():this.wn(e,r,n,t,i)}))))})}Sn(e,t,n,r){return oB(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return oB(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){let r=oB(e),i=new iS(oS);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(e,r)=>{i=i.add(new oT(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}yn(e,t){let n=new iS(oS),r=this.An(t,e);if(null==r)return n;let i=rN(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iJ(s))for(let i of s.arrayValue.values||[])n=n.add(new oT(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new oT(t.indexId,e.key,oF,r));return n}wn(e,t,n,r,i){rt("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=iD(s),l=iD(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=iD(a)):t?(i(o),o=iD(s)):(o=iD(s),l=iD(a))}}(r,i,oS,r=>{s.push(this.Sn(e,t,n,r))},r=>{s.push(this.bn(e,t,n,r))}),rz.waitFor(s)}gn(e){let t=1;return oz(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>oS(e,t)).filter((e,t,n)=>!t||0!==oS(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=oS(i,e),s=oS(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,oF,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,oF,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return oS(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oG)}getMinOffset(e,t){return rz.mapArray(this.cn(t),t=>this.ln(e,t).next(e=>e||rs())).next(oG)}}function oq(e){return iv(e,"collectionParents")}function oB(e){return iv(e,"indexEntries")}function oU(e){return iv(e,"indexConfiguration")}function oz(e){return iv(e,"indexState")}function oG(e){0!==e.length||rs();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>rV(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new rF(t.readTime,t.documentKey,n)}let oj={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oK{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new oK(e,oK.DEFAULT_COLLECTION_PERCENTILE,oK.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function o$(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.Y({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||rs()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,r6(h),c]);s.push(i.delete(r)),u.push(e.key)}return rz.waitFor(s).next(()=>u)}function oQ(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw rs();t=e.noDocument}return JSON.stringify(t).length}oK.DEFAULT_COLLECTION_PERCENTILE=10,oK.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oK.DEFAULT=new oK(0x2800000,oK.DEFAULT_COLLECTION_PERCENTILE,oK.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oK.DISABLED=new oK(-1,0,0);class oH{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){return""!==e.uid||rs(),new oH(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return oY(e).Y({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=oX(e),s=oY(e);return s.add({}).next(a=>{"number"==typeof a||rs();let o=new am(a,t,n,r),l=function(e,t,n){let r=n.baseMutations.map(t=>a5(e.ct,t)),i=n.mutations.map(t=>a5(e.ct,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,o),u=[],h=new iS((e,t)=>rb(e.canonicalString(),t.canonicalString()));for(let e of r){let t=[this.userId,r6(e.key.path),a];h=h.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,r8))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Cn[a]=o.keys()}),rz.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return oY(e).get(t).next(e=>e?(e.userId===this.userId||rs(),oo(this.serializer,e)):null)}vn(e,t){return this.Cn[t]?rz.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Cn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return oY(e).Y({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||rs(),i=oo(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return oY(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return oY(e).W("userMutationsIndex",t).next(e=>e.map(e=>oo(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,r6(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return oX(e).Y({range:r},(n,r,s)=>{let[a,o,l]=n,u=r3(o);if(a===this.userId&&t.path.isEqual(u))return oY(e).get(l).next(e=>{if(!e)throw rs();e.userId===this.userId||rs(),i.push(oo(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iS(rb),r=[];return t.forEach(t=>{let i=[this.userId,r6(t.path)],s=IDBKeyRange.lowerBound(i),a=oX(e).Y({range:s},(e,r,i)=>{let[s,a,o]=e,l=r3(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),rz.waitFor(r).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,r6(n)],s=IDBKeyRange.lowerBound(i),a=new iS(rb);return oX(e).Y({range:s},(e,t,i)=>{let[s,o,l]=e,u=r3(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(oY(e).get(t).next(e=>{if(null===e)throw rs();e.userId===this.userId||rs(),n.push(oo(this.serializer,e))}))}),rz.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return o$(e.ae,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),rz.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rz.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return oX(e).Y({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=r3(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||rs()})})}containsKey(e,t){return oW(e,this.userId,t)}xn(e){return oJ(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oW(e,t,n){let r=[t,r6(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return oX(e).Y({range:s,J:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function oY(e){return iv(e,"mutations")}function oX(e){return iv(e,"documentMutations")}function oJ(e){return iv(e,"mutationQueues")}class oZ{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new oZ(0)}static Bn(){return new oZ(-1)}}class o0{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let n=new oZ(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(e=>rI.fromTimestamp(new r_(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Ln(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Ln(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>o1(e).delete(t.targetId)).next(()=>this.Ln(e)).next(t=>(t.targetCount>0||rs(),t.targetCount-=1,this.kn(e,t)))}removeTargets(e,t,n){let r=0,i=[];return o1(e).Y((s,a)=>{let o=ol(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>rz.waitFor(i)).next(()=>r)}forEachTarget(e,t){return o1(e).Y((e,n)=>{t(ol(n))})}Ln(e){return o2(e).get("targetGlobalKey").next(e=>(null!==e||rs(),e))}kn(e,t){return o2(e).put("targetGlobalKey",t)}qn(e,t){return o1(e).put(ou(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next(e=>e.targetCount)}getTargetData(e,t){let n=sb(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return o1(e).Y({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=ol(n);sx(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=o5(e);return t.forEach(t=>{let s=r6(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),rz.waitFor(r)}removeMatchingKeys(e,t,n){let r=o5(e);return rz.forEach(t,t=>{let i=r6(t.path);return rz.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=o5(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=o5(e),i=sW();return r.Y({range:n,J:!0},(e,t,n)=>{let r=new rD(r3(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=r6(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return o5(e).Y({index:"documentTargetsIndex",J:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}_t(e,t){return o1(e).get(t).next(e=>e?ol(e):null)}}function o1(e){return iv(e,"targets")}function o2(e){return iv(e,"targetGlobal")}function o5(e){return iv(e,"targetDocuments")}function o6([e,t],[n,r]){let i=rb(e,n);return 0===i?rb(t,r):i}class o3{constructor(e){this.Kn=e,this.buffer=new iS(o6),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>o6(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class o4{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){rt("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rQ(e)?rt("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rU(e)}await this.zn(3e5)})}}class o8{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rz.resolve(r0._e);let n=new o3(t);return this.jn.forEachTarget(e,e=>n.Wn(e.sequenceNumber)).next(()=>this.jn.Jn(e,e=>n.Wn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(rt("LruGarbageCollector","Garbage collection skipped; disabled"),rz.resolve(oj)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(rt("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oj):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),n7()<=R.DEBUG&&rt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),rz.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class o9{constructor(e,t){this.db=e,this.garbageCollector=new o8(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Zn(e){let t=0;return this.Jn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(e,n)=>t(n))}addReference(e,t,n){return o7(e,n)}removeReference(e,t,n){return o7(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return o7(e,t)}er(e,t){let n;return n=!1,oJ(e).Z(r=>oW(e,r,t).next(e=>(e&&(n=!0),rz.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Xn(e,(s,a)=>{if(a<=t){let t=this.er(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,rI.min()),o5(e).delete([0,r6(s.path)])))});r.push(t)}}).next(()=>rz.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return o7(e,t)}Xn(e,t){let n=o5(e),r,i=r0._e;return n.Y({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==r0._e&&t(new rD(r3(r)),i),i=a,r=s):i=r0._e}).next(()=>{i!==r0._e&&t(new rD(r3(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function o7(e,t){var n;return o5(e).put((n=e.currentSequenceNumber,{targetId:0,path:r6(t.path),sequenceNumber:n}))}class le{constructor(){this.changes=new sU(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,i8.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rz.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lt{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return li(e).put(n)}removeEntry(e,t,n){return li(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],oi(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=i8.newInvalidDocument(t);return li(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ls(t))},(e,r)=>{n=this.nr(t,r)}).next(()=>n)}rr(e,t){let n={size:0,document:i8.newInvalidDocument(t)};return li(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ls(t))},(e,r)=>{n={document:this.nr(t,r),size:oQ(r)}}).next(()=>n)}getEntries(e,t){let n=sz;return this.ir(e,t,(e,t)=>{let r=this.nr(e,t);n=n.insert(e,r)}).next(()=>n)}sr(e,t){let n=sz,r=new iI(rD.comparator);return this.ir(e,t,(e,t)=>{let i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,oQ(t))}).next(()=>({documents:n,_r:r}))}ir(e,t,n){if(t.isEmpty())return rz.resolve();let r=new iS(lo);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(ls(r.first()),ls(r.last())),s=r.getIterator(),a=s.getNext();return li(e).Y({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=rD.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>lo(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.U(ls(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return li(e).W(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=sz;for(let i of e){let e=this.nr(rD.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(sV(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sz,s=la(t,n),a=la(t,rF.max());return li(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.nr(rD.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new ln(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return lr(e).get("remoteDocumentGlobalKey").next(e=>(e||rs(),e))}tr(e,t){return lr(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let e=function(e,t){let n;if(t.document)n=a2(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rD.fromSegments(t.noDocument.path),r=oa(t.noDocument.readTime);n=i8.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return rs();{let e=rD.fromSegments(t.unknownDocument.path),r=oa(t.unknownDocument.version);n=i8.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new r_(e[0],e[1]);return rI.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(rI.min()))return e}return i8.newInvalidDocument(e)}}class ln extends le{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new sU(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new iS((e,t)=>rb(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=or(this.ar.serializer,s);r=r.add(i.path.popLast());let l=oQ(o);n+=l-a.size,t.push(this.ar.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=or(this.ar.serializer,s.convertToNoDocument(rI.min()));t.push(this.ar.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.ar.updateMetadata(e,n)),rz.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:e,_r:t})=>(t.forEach((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function lr(e){return iv(e,"remoteDocumentGlobal")}function li(e){return iv(e,"remoteDocumentsV14")}function ls(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function la(e,t){let n=t.documentKey.path.toArray();return[e,oi(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function lo(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rb(n[e],r[e]))return i;return(i=rb(n.length,r.length))||(i=rb(n[n.length-2],r[r.length-2]))||rb(n[n.length-1],r[r.length-1])}class ll{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lu{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&aa(n.mutation,e,iA.empty(),r_.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sW()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sW()){let r=s$();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sj();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=s$();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sW()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sz,s=s$(),a=s$();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof au)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),aa(a.mutation,t,a.mutation.getFieldMask(),r_.now())):s.set(t.key,iA.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new ll(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=s$(),r=new iI((e,t)=>e-t),i=sW();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||iA.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sW()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=s$();l.forEach(e=>{if(!i.has(e)){let r=as(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rz.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return rD.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rz.resolve(s$()),a=-1,o=i;return s.next(t=>rz.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?rz.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sW())).next(e=>({batchId:a,changes:sK(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rD(t)).next(e=>{let t=sj();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=sj();return this.indexManager.getCollectionParents(e,i).next(a=>rz.forEach(a,a=>{let o=new sS(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,i8.newInvalidDocument(r)))});let n=sj();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&aa(s.mutation,r,iA.empty(),r_.now()),sV(t,r)&&(n=n.insert(e,r))}),n})}}class lh{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return rz.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:t.id,version:t.version,createTime:aK(t.createTime)}),rz.resolve()}getNamedQuery(e,t){return rz.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:t.name,query:oh(t.bundledQuery),readTime:aK(t.readTime)}),rz.resolve()}}class lc{constructor(){this.overlays=new iI(rD.comparator),this.hr=new Map}getOverlay(e,t){return rz.resolve(this.overlays.get(t))}getOverlays(e,t){let n=s$();return rz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),rz.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.hr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(n)),rz.resolve()}getOverlaysForCollection(e,t,n){let r=s$(),i=t.length+1,s=new rD(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rz.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new iI((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=s$(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=s$(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return rz.resolve(a)}ht(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ay(t,n));let i=this.hr.get(t);void 0===i&&(i=sW(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class lf{constructor(){this.Pr=new iS(ld.Ir),this.Tr=new iS(ld.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let n=new ld(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new ld(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){let t=new rD(new rT([])),n=new ld(t,e),r=new ld(t,e+1),i=[];return this.Tr.forEachInRange([n,r],e=>{this.Ar(e),i.push(e.key)}),i}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new rD(new rT([])),n=new ld(t,e),r=new ld(t,e+1),i=sW();return this.Tr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new ld(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ld{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return rD.comparator(e.key,t.key)||rb(e.pr,t.pr)}static Er(e,t){return rb(e.pr,t.pr)||rD.comparator(e.key,t.key)}}class lg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new iS(ld.Ir)}checkEmpty(e){return rz.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new am(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.wr=this.wr.add(new ld(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rz.resolve(s)}lookupMutationBatch(e,t){return rz.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.br(t+1),r=n<0?0:n;return rz.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rz.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return rz.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ld(t,0),r=new ld(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],e=>{let t=this.Sr(e.pr);i.push(t)}),rz.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iS(rb);return t.forEach(e=>{let t=new ld(e,0),r=new ld(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],e=>{n=n.add(e.pr)})}),rz.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rD.isDocumentKey(i)||(i=i.child(""));let s=new ld(new rD(i),0),a=new iS(rb);return this.wr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.pr)),!0)},s),rz.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(e=>{let n=this.Sr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Cr(t.batchId,"removed")||rs(),this.mutationQueue.shift();let n=this.wr;return rz.forEach(t.mutations,r=>{let i=new ld(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){let n=new ld(t,0),r=this.wr.firstAfterOrEqual(n);return rz.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rz.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lm{constructor(e){this.vr=e,this.docs=new iI(rD.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rz.resolve(n?n.document.mutableCopy():i8.newInvalidDocument(t))}getEntries(e,t){let n=sz;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():i8.newInvalidDocument(e))}),rz.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sz,s=t.path,a=new rD(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rV(rP(a),n)||(r.has(a.key)||sV(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rz.resolve(i)}getAllFromCollectionGroup(e,t,n,r){rs()}Fr(e,t){return rz.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lp(this)}getSize(e){return rz.resolve(this.size)}}class lp extends le{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)}),rz.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class ly{constructor(e){this.persistence=e,this.Mr=new sU(e=>sb(e),sx),this.lastRemoteSnapshotVersion=rI.min(),this.highestTargetId=0,this.Or=0,this.Nr=new lf,this.targetCount=0,this.Br=oZ.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,n)=>t(n)),rz.resolve()}getLastRemoteSnapshotVersion(e){return rz.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rz.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),rz.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),rz.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Br=new oZ(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,rz.resolve()}updateTargetData(e,t){return this.qn(t),rz.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,rz.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Mr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),rz.waitFor(i).next(()=>r)}getTargetCount(e){return rz.resolve(this.targetCount)}getTargetData(e,t){let n=this.Mr.get(t)||null;return rz.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),rz.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rz.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),rz.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Nr.gr(t);return rz.resolve(n)}containsKey(e,t){return rz.resolve(this.Nr.containsKey(t))}}class lw{constructor(e,t){this.Lr={},this.overlays={},this.kr=new r0(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new ly(this),this.indexManager=new oO,this.remoteDocumentCache=new lm(e=>this.referenceDelegate.Kr(e)),this.serializer=new on(t),this.$r=new lh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new lg(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){rt("MemoryPersistence","Starting transaction:",e);let r=new lv(this.kr.next());return this.referenceDelegate.Ur(),n(r).next(e=>this.referenceDelegate.Wr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Gr(e,t){return rz.or(Object.values(this.Lr).map(n=>()=>n.containsKey(e,t)))}}class lv extends rB{constructor(e){super(),this.currentSequenceNumber=e}}class lb{constructor(e){this.persistence=e,this.zr=new lf,this.jr=null}static Hr(e){return new lb(e)}get Jr(){if(this.jr)return this.jr;throw rs()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),rz.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),rz.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),rz.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rz.forEach(this.Jr,n=>{let r=rD.fromPath(n);return this.Yr(e,r).next(e=>{e||t.removeEntry(r,rI.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return rz.or([()=>rz.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class lx{constructor(e,t){this.persistence=e,this.Zr=new sU(e=>r6(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new o8(this,t)}static Hr(e,t){return new lx(e,t)}Ur(){}Wr(e){return rz.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Hn(e){let t=this.Zn(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Zn(e){let t=0;return this.Jn(e,e=>{t++}).next(()=>t)}Jn(e,t){return rz.forEach(this.Zr,(n,r)=>this.er(e,n,r).next(e=>e?rz.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Fr(e,r=>this.er(e,r,t).next(e=>{e||(n++,i.removeEntry(r,rI.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Zr.set(t,e.currentSequenceNumber),rz.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),rz.resolve()}removeReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),rz.resolve()}updateLimboDocument(e,t){return this.Zr.set(t,e.currentSequenceNumber),rz.resolve()}Kr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(ij(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=iV(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return iP(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:var r;let i;return r=t.mapValue,i=0,ix(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw rs()}}(e.data.value)),t}er(e,t,n){return rz.or([()=>this.persistence.Gr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Zr.get(t);return rz.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class l_{constructor(e){this.serializer=e}N(e,t,n,r){let i=new rG("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r4,{unique:!0}),e.createObjectStore("documentMutations"),lI(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=rz.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),lI(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rI.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").W().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r4,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return rz.waitFor(r)}))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.Xr(i))),n<6&&r>=6&&(s=s.next(()=>((function(e){e.createObjectStore("remoteDocumentGlobal")})(e),this.ei(i)))),n<7&&r>=7&&(s=s.next(()=>this.ti(i))),n<8&&r>=8&&(s=s.next(()=>this.ni(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.ri(i))),n<11&&r>=11&&(s=s.next(()=>{(function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore("documentOverlays",{keyPath:ih});t.createIndex("collectionPathOverlayIndex",ic,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",id,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:r9});t.createIndex("documentKeyIndex",r7),t.createIndex("collectionGroupIndex",ie)})(e)).next(()=>this.ii(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.si(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ia}).createIndex("sequenceNumberIndex",io,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:il}).createIndex("documentKeyIndex",iu,{unique:!1})})),s}ei(e){let t=0;return e.store("remoteDocuments").Y((e,n)=>{t+=oQ(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(t=>rz.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next(n=>rz.forEach(n,n=>{n.userId===t.userId||rs();let r=oo(this.serializer,n);return o$(e,t.userId,r).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.Y((n,i)=>{let s=new rT(n),a=[0,r6(s)];r.push(t.get(a).next(n=>n?rz.resolve():t.put({targetId:0,path:r6(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rz.waitFor(r))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:is});let n=t.store("collectionParents"),r=new oP,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:r6(r)})}};return t.store("remoteDocuments").Y({J:!0},(e,t)=>i(new rT(e).popLast())).next(()=>t.store("documentMutations").Y({J:!0},([e,t,n],r)=>i(r3(t).popLast())))}ri(e){let t=e.store("targets");return t.Y((e,n)=>{let r=ol(n),i=ou(this.serializer,r);return t.put(i)})}ii(e,t){let n=t.store("remoteDocuments"),r=[];return n.Y((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new rD(rT.fromString(n.document.name).popFirst(5)):n.noDocument?rD.fromSegments(n.noDocument.path):n.unknownDocument?rD.fromSegments(n.unknownDocument.path):rs()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>rz.waitFor(r))}si(e,t){let n=t.store("mutations"),r=new lt(this.serializer),i=new lw(lb.Hr,this.serializer.ct);return n.W().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:sW();oo(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),rz.forEach(n,(e,n)=>{let s=new n4(n),a=oy.lt(this.serializer,s),o=i.getIndexManager(s);return new lu(r,oH.lt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new iw(t,r0._e),e).next()})})}}function lI(e){e.createObjectStore("targetDocuments",{keyPath:ir}).createIndex("documentTargetsIndex",ii,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",it,{unique:!0}),e.createObjectStore("targetGlobal")}let lE="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class lT{constructor(e,t,n,r,i,s,a,o,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=a,this._i=l,this.ai=u,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!lT.D())throw new rl(ro.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new o9(this,r),this.Ti=t+"main",this.serializer=new on(o),this.Ei=new rj(this.Ti,this.ui,new l_(this.serializer)),this.Qr=new o0(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new lt(this.serializer),this.$r=new og,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&rn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rl(ro.FAILED_PRECONDITION,lE);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new r0(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(async()=>{this.started&&await this.Ai()}))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lC(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(rQ(e))return rt("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return rt("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return lS(e).get("owner").next(e=>rz.resolve(this.Si(e)))}bi(e){return lC(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=iv(e,"clientMetadata");return t.W().next(e=>{let n=this.vi(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return rz.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?rz.resolve(!0):lS(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new rl(ro.FAILED_PRECONDITION,lE);return!1}}return!(!this.networkEnabled||!this.inForeground)||lC(e).W().next(e=>void 0===this.vi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&rt("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new iw(e,r0._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Bi()}vi(e,t){return e.filter(e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>lC(e).W().next(e=>this.vi(e,18e5).map(e=>e.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return oH.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oV(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return oy.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){var r;let i;rt("IndexedDbPersistence","Starting transaction:",e);let s=15===(r=this.ui)?iy:14===r?ip:13===r?ip:12===r?im:11===r?ig:void rs();return this.Ei.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new iw(r,this.kr?this.kr.next():r0._e),"readwrite-primary"===t?this.gi(i).next(e=>!!e||this.pi(i)).next(t=>{if(!t)throw rn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new rl(ro.FAILED_PRECONDITION,rq);return n(i)}).next(e=>this.wi(i).next(()=>e)):this.ki(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}ki(e){return lS(e).get("owner").next(e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new rl(ro.FAILED_PRECONDITION,lE)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return lS(e).put("owner",t)}static D(){return rj.D()}yi(e){let t=lS(e);return t.get("owner").next(e=>this.Si(e)?(rt("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):rz.resolve())}Ci(e,t){let n=Date.now();return!(e<n-t||e>n&&(rn(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;v()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return rt("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return rn("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){rn("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lS(e){return iv(e,"owner")}function lC(e){return iv(e,"clientMetadata")}function lD(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class lA{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=sW(),r=sW();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lA(e,t.fromCache,n,r)}}class lN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lk{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=v()?8:rj.v(w())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ji(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Hi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new lN;return this.Ji(e,t,n).next(r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)})}).next(()=>i.result)}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(n7()<=R.DEBUG&&rt("QueryEngine","SDK will not create cache indexes for query:",sF(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),rz.resolve()):(n7()<=R.DEBUG&&rt("QueryEngine","Query:",sF(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(n7()<=R.DEBUG&&rt("QueryEngine","The SDK decides to create cache indexes for query:",sF(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sk(t))):rz.resolve())}ji(e,t){if(sD(t))return rz.resolve(null);let n=sk(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=sk(t=sL(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sW(...r);return this.zi.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,sL(t,null,"F")):this.es(e,s,t,n)}))})))}Hi(e,t,n,r){return sD(t)||r.isEqual(rI.min())?rz.resolve(null):this.zi.getDocuments(e,n).next(i=>{let s=this.Zi(t,i);return this.Xi(t,s,n,r)?rz.resolve(null):(n7()<=R.DEBUG&&rt("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sF(t)),this.es(e,s,t,rO(r,-1)).next(e=>e))})}Zi(e,t){let n=new iS(sB(e));return t.forEach((t,r)=>{sV(e,r)&&(n=n.add(r))}),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return n7()<=R.DEBUG&&rt("QueryEngine","Using full collection scan to execute query:",sF(t)),this.zi.getDocumentsMatchingQuery(e,t,rF.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class lR{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new iI(rb),this.rs=new sU(e=>sb(e),sx),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}async function lM(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e._s(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sW();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({us:e,removedBatchIds:i,addedBatchIds:s}))})})}function lL(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function lO(e,t,n){let r=sW(),i=sW();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sz;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rI.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):rt("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{cs:r,ls:i}})}function lP(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Qr.getTargetData(n,t).next(i=>i?(r=i,rz.resolve(r)):e.Qr.allocateTargetId(n).next(i=>(r=new ot(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.ns.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}async function lF(e,t,n){let r=e.ns.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!rQ(e))throw e;rt("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.ns=e.ns.remove(t),e.rs.delete(r.target)}function lV(e,t,n){let r=rI.min(),i=sW();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.rs.get(n);return void 0!==r?rz.resolve(e.ns.get(r)):e.Qr.getTargetData(t,n)})(e,s,sk(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Qr.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.ts.getDocumentsMatchingQuery(s,t,n?r:rI.min(),n?i:sW())).next(n=>(lU(e,sq(t),n),{documents:n,hs:i})))}function lq(e,t){let n=e.Qr,r=e.ns.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n._t(e,t).next(e=>e?e.target:null))}function lB(e,t){let n=e.ss.get(t)||rI.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.os.getAllFromCollectionGroup(r,t,rO(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(lU(e,t,n),n))}function lU(e,t,n){let r=e.ss.get(t)||rI.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.ss.set(t,r)}async function lz(e,t,n=sW()){let r=await lP(e,sk(oh(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=aK(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.$r.saveNamedQuery(i,t);let a=r.withResumeToken(iR.EMPTY_BYTE_STRING,s);return e.ns=e.ns.insert(a.targetId,a),e.Qr.updateTargetData(i,a).next(()=>e.Qr.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Qr.addMatchingKeys(i,n,r.targetId)).next(()=>e.$r.saveNamedQuery(i,t))})}function lG(e,t){return`firestore_clients_${e}_${t}`}function lj(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function lK(e,t){return`firestore_targets_${e}_${t}`}class l${constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new rl(r.error.code,r.error.message)),s?new l$(e,t,r.state,i):(rn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lQ{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rl(n.error.code,n.error.message)),i?new lQ(e,n.state,r):(rn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lH{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sY;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=r5(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lH(e,i):(rn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lW{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lW(t.clientId,t.onlineState):(rn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lY{constructor(){this.activeTargetIds=sY}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lX{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new iI(rb),this.started=!1,this.ys=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=lG(this.persistenceKey,this.Vs),this.Ss=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.ps=this.ps.insert(this.Vs,new lY),this.bs=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Ds=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Cs=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.vs=(a=this.persistenceKey,`firestore_online_state_${a}`),this.Fs=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Li())){if(e===this.Vs)continue;let t=this.getItem(lG(this.persistenceKey,e));if(t){let n=lH.Es(e,t);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let t=this.xs(e);t&&this.Os(t)}for(let e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(lK(this.persistenceKey,e));if(n){let r=lQ.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lK(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Ls(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return rt("SharedClientState","READ",e,t),t}setItem(e,t){rt("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){rt("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){if(e.storageArea===this.storage){if(rt("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void rn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.bs.test(e.key)){if(null==e.newValue){let t=this.$s(e.key);return this.Us(t,null)}{let t=this.Ws(e.key,e.newValue);if(t)return this.Us(t.clientId,t)}}else if(this.Ds.test(e.key)){if(null!==e.newValue){let t=this.Gs(e.key,e.newValue);if(t)return this.zs(t)}}else if(this.Cs.test(e.key)){if(null!==e.newValue){let t=this.js(e.key,e.newValue);if(t)return this.Hs(t)}}else if(e.key===this.vs){if(null!==e.newValue){let t=this.xs(e.newValue);if(t)return this.Os(t)}}else if(e.key===this.Ss){let t=function(e){let t=r0._e;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||rs(),t=n}catch(e){rn("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==r0._e&&this.sequenceNumberHandler(t)}else if(e.key===this.Fs){let t=this.Js(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Ys(e)))}}}else this.ys.push(e)})}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,n){let r=new l$(this.currentUser,e,t,n),i=lj(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Ls(e){let t=lj(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){let r=lK(this.persistenceKey,e),i=new lQ(e,t,n);this.setItem(r,i.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let n=this.$s(e);return lH.Es(n,t)}Gs(e,t){let n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return l$.Es(new n4(i),r,t)}js(e,t){let n=Number(this.Cs.exec(e)[1]);return lQ.Es(n,t)}xs(e){return lW.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);rt("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.eo(s,a).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=sY;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class lJ{constructor(){this.no=new lY,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new lY,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lZ{io(e){}shutdown(){}}class l0{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){for(let e of(rt("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.uo))e(0)}ao(){for(let e of(rt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.uo))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let l1=null;function l2(){return null===l1?l1=0x10000000+Math.round(0x80000000*Math.random()):l1++,"0x"+l1.toString(16)}let l5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class l6{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}let l3="WebChannelConnection";class l4 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){let s=l2(),a=this.bo(e,t.toUriEncodedString());rt("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(o,r,i),this.Co(e,a,o,n).then(t=>(rt("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw rr("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+n8}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}bo(e,t){let n=l5[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){let i=l2();return new Promise((s,a)=>{let o=new nt;o.setWithCredentials(!0),o.listenOnce(tt.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case te.NO_ERROR:let t=o.getResponseJson();rt(l3,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case te.TIMEOUT:rt(l3,`RPC '${e}' ${i} timed out`),a(new rl(ro.DEADLINE_EXCEEDED,"Request time out"));break;case te.HTTP_ERROR:let n=o.getStatus();if(rt(l3,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(ro).indexOf(t)>=0?t:ro.UNKNOWN}(t.status);a(new rl(e,t.message))}else a(new rl(ro.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new rl(ro.UNAVAILABLE,"Connection failed."));break;default:rs()}}finally{rt(l3,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);rt(l3,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)})}Fo(e,t,n){let r=l2(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new nO,o=e5(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let h=i.join("");rt(l3,`Creating RPC '${e}' stream ${r}: ${h}`,l);let c=s.createWebChannel(h,l),f=!1,d=!1,g=new l6({lo:t=>{d?rt(l3,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(f||(rt(l3,`Opening RPC '${e}' stream ${r} transport.`),c.open(),f=!0),rt(l3,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},ho:()=>c.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(c,ti.EventType.OPEN,()=>{d||rt(l3,`RPC '${e}' stream ${r} transport opened.`)}),m(c,ti.EventType.CLOSE,()=>{d||(d=!0,rt(l3,`RPC '${e}' stream ${r} transport closed`),g.Vo())}),m(c,ti.EventType.ERROR,t=>{d||(d=!0,rr(l3,`RPC '${e}' stream ${r} transport errored:`,t),g.Vo(new rl(ro.UNAVAILABLE,"The operation could not be completed")))}),m(c,ti.EventType.MESSAGE,t=>{var n;if(!d){let i=t.data[0];i||rs();let s=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(s){rt(l3,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=a[e];if(void 0!==t)return ax(t)}(t),i=s.message;void 0===n&&(n=ro.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),d=!0,g.Vo(new rl(n,i)),c.close()}else rt(l3,`RPC '${e}' stream ${r} received:`,i),g.mo(i)}}),m(o,e1.STAT_EVENT,t=>{10===t.stat?rt(l3,`RPC '${e}' stream ${r} detected buffering proxy`):11===t.stat&&rt(l3,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.Ro()},0),g}}function l8(){return"undefined"!=typeof window?window:null}function l9(){return"undefined"!=typeof document?document:null}function l7(e){return new aU(e,!0)}class ue{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&rt("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class ut{constructor(e,t,n,r,i,s,a,o){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ue(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===ro.RESOURCE_EXHAUSTED?(rn(t.toString()),rn("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===ro.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Wo===t&&this.o_(e,n)},t=>{e(()=>{let e=new rl(ro.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)})})}o_(e,t){let n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{n(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(e=>{n(()=>this.__(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Yo(){this.state=5,this.jo.qo(async()=>{this.state=0,this.start()})}__(e){return rt("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(rt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class un extends ut{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:rs(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||rs(),iR.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||rs(),iR.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new aM(s,a,o,l&&new rl(void 0===l.code?ro.UNKNOWN:ax(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=aY(e,r.document.name),s=aK(r.document.updateTime),a=r.document.createTime?aK(r.document.createTime):rI.min(),o=new i4({mapValue:{fields:r.document.fields}}),l=i8.newFoundDocument(i,s,a,o);n=new ak(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=aY(e,r.document),s=r.readTime?aK(r.readTime):rI.min(),a=i8.newNoDocument(i,s);n=new ak([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=aY(e,r.document);n=new ak([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rs();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new av(r,i);n=new aR(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return rI.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?rI.min():t.readTime?aK(t.readTime):rI.min()}(e);return this.listener.u_(t,n)}c_(e){let t={};t.database=aZ(this.serializer),t.addTarget=function(e,t){let n;let r=t.target;if((n=s_(r)?{documents:a3(e,r)}:{query:a4(e,r).ut}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=aj(e,t.resumeToken);let r=az(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(rI.min())>0){n.readTime=aG(e,t.snapshotVersion.toTimestamp());let r=az(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rs()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){let t={};t.database=aZ(this.serializer),t.removeTarget=e,this.t_(t)}}class ur extends ut{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||rs(),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||rs(),t.map(e=>{let t;return(t=e.updateTime?aK(e.updateTime):aK(n)).isEqual(rI.min())&&(t=aK(n)),new at(t,e.transformResults||[])})):[]),i=aK(e.commitTime);return this.listener.T_(i,r)}return e.writeResults&&0!==e.writeResults.length&&rs(),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=aZ(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>a5(this.serializer,e))};this.t_(t)}}class ui extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new rl(ro.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.So(e,aQ(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===ro.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rl(ro.UNKNOWN,e.toString())})}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.vo(e,aQ(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===ro.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rl(ro.UNKNOWN,e.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class us{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(rn(t),this.g_=!1):rt("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class ua{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(e=>{n.enqueueAndForget(async()=>{um(this)&&(rt("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.v_.add(4),await ul(e),e.x_.set("Unknown"),e.v_.delete(4),await uo(e)}(this))})}),this.x_=new us(n,r)}}async function uo(e){if(um(e))for(let t of e.F_)await t(!0)}async function ul(e){for(let t of e.F_)await t(!1)}function uu(e,t){e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),ug(e)?ud(e):uN(e).Jo()&&uc(e,t))}function uh(e,t){let n=uN(e);e.C_.delete(t),n.Jo()&&uf(e,t),0===e.C_.size&&(n.Jo()?n.Xo():um(e)&&e.x_.set("Unknown"))}function uc(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rI.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}uN(e).c_(t)}function uf(e,t){e.O_.Oe(t),uN(e).l_(t)}function ud(e){e.O_=new aO({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),uN(e).start(),e.x_.p_()}function ug(e){return um(e)&&!uN(e).Ho()&&e.C_.size>0}function um(e){return 0===e.v_.size}async function up(e){e.C_.forEach((t,n)=>{uc(e,t)})}async function uy(e,t){e.O_=void 0,ug(e)?(e.x_.S_(t),ud(e)):e.x_.set("Unknown")}async function uw(e,t,n){if(e.x_.set("Online"),t instanceof aM&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){rt("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await uv(e,n)}else if(t instanceof ak?e.O_.$e(t):t instanceof aR?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(rI.min()))try{let t=await lL(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.O_.it(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(iR.EMPTY_BYTE_STRING,r.snapshotVersion)),uf(e,t);let i=new ot(r.target,t,n,r.sequenceNumber);uc(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){rt("RemoteStore","Failed to raise snapshot:",t),await uv(e,t)}}async function uv(e,t,n){if(!rQ(t))throw t;e.v_.add(1),await ul(e),e.x_.set("Offline"),n||(n=()=>lL(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rt("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await uo(e)})}function ub(e,t){return t().catch(n=>uv(e,n,t))}async function ux(e){let t=uk(e),n=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;um(e)&&e.D_.length<10;)try{let r=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,n);if(null===r){0===e.D_.length&&t.Xo();break}n=r.batchId,function(e,t){e.D_.push(t);let n=uk(e);n.Jo()&&n.P_&&n.I_(t.mutations)}(e,r)}catch(t){await uv(e,t)}u_(e)&&uI(e)}function u_(e){return um(e)&&!uk(e).Ho()&&e.D_.length>0}function uI(e){uk(e).start()}async function uE(e){uk(e).d_()}async function uT(e){let t=uk(e);for(let n of e.D_)t.I_(n.mutations)}async function uS(e,t,n){let r=e.D_.shift(),i=ap.from(r,t,n);await ub(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await ux(e)}async function uC(e,t){t&&uk(e).P_&&await async function(e,t){var n;if(ab(n=t.code)&&n!==ro.ABORTED){let n=e.D_.shift();uk(e).Zo(),await ub(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ux(e)}}(e,t),u_(e)&&uI(e)}async function uD(e,t){e.asyncQueue.verifyOperationInProgress(),rt("RemoteStore","RemoteStore received new credentials");let n=um(e);e.v_.add(3),await ul(e),n&&e.x_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),await uo(e)}async function uA(e,t){t?(e.v_.delete(2),await uo(e)):t||(e.v_.add(2),await ul(e),e.x_.set("Unknown"))}function uN(e){var t,n,r;return e.N_||(e.N_=(t=e.datastore,n=e.asyncQueue,r={Po:up.bind(null,e),To:uy.bind(null,e),u_:uw.bind(null,e)},t.R_(),new un(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.F_.push(async t=>{t?(e.N_.Zo(),ug(e)?ud(e):e.x_.set("Unknown")):(await e.N_.stop(),e.O_=void 0)})),e.N_}function uk(e){var t,n,r;return e.B_||(e.B_=(t=e.datastore,n=e.asyncQueue,r={Po:uE.bind(null,e),To:uC.bind(null,e),E_:uT.bind(null,e),T_:uS.bind(null,e)},t.R_(),new ur(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.F_.push(async t=>{t?(e.B_.Zo(),await ux(e)):(await e.B_.stop(),e.D_.length>0&&(rt("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))})),e.B_}class uR{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ru,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new uR(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rl(ro.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uM(e,t){if(rn("AsyncQueue",`${t}: ${e}`),rQ(e))return new rl(ro.UNAVAILABLE,`${t}: ${e}`);throw e}class uL{constructor(e){this.comparator=e?(t,n)=>e(t,n)||rD.comparator(t.key,n.key):(e,t)=>rD.comparator(e.key,t.key),this.keyedMap=sj(),this.sortedSet=new iI(this.comparator)}static emptySet(e){return new uL(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uL)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new uL;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class uO{constructor(){this.L_=new iI(rD.comparator)}track(e){let t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):rs():this.L_=this.L_.insert(t,e)}k_(){let e=[];return this.L_.inorderTraversal((t,n)=>{e.push(n)}),e}}class uP{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new uP(e,t,uL.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sO(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class uF{constructor(){this.q_=void 0,this.Q_=[]}}class uV{constructor(){this.queries=new sU(e=>sP(e),sO),this.onlineState="Unknown",this.K_=new Set}}async function uq(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i||(r=!0,i=new uF),r)try{i.q_=await e.onListen(n)}catch(n){let e=uM(n,`Initialization of query '${sF(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Q_.push(t),t.U_(e.onlineState),i.q_&&t.W_(i.q_)&&uG(e)}async function uB(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i){let e=i.Q_.indexOf(t);e>=0&&(i.Q_.splice(e,1),r=0===i.Q_.length)}if(r)return e.queries.delete(n),e.onUnlisten(n)}function uU(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Q_)e.W_(r)&&(n=!0);i.q_=r}}n&&uG(e)}function uz(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Q_)e.onError(n);e.queries.delete(t)}function uG(e){e.K_.forEach(e=>{e.next()})}class uj{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new uP(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){return!e.fromCache||(!this.options.Z_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;let t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=uP.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class uK{constructor(e,t){this.X_=e,this.byteLength=t}ea(){return"metadata"in this.X_}}class u${constructor(e){this.serializer=e}Ps(e){return aY(this.serializer,e)}Is(e){return e.metadata.exists?a2(this.serializer,e.document,!1):i8.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return aK(e)}}class uQ{constructor(e,t,n){this.ta=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=uH(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;let n=rT.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ra(e){let t=new Map,n=new u$(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ps(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||sW()).add(e);t.set(n,r)}}return t}async complete(){let e=await async function(e,t,n,r){let i=sW(),s=sz;for(let e of n){let n=t.Ps(e.metadata.name);e.document&&(i=i.add(n));let r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),s=s.insert(n,r)}let a=e.os.newChangeBuffer({trackRemovals:!0}),o=await lP(e,sk(sC(rT.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>lO(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Qr.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Qr.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.cs,n.ls)).next(()=>n.cs)))}(this.localStore,new u$(this.serializer),this.documents,this.ta.id),t=this.ra(this.documents);for(let e of this.queries)await lz(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}}}function uH(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uW{constructor(e){this.key=e}}class uY{constructor(e){this.key=e}}class uX{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=sW(),this.mutatedKeys=sW(),this.ua=sB(e),this.ca=new uL(this.ua)}get la(){return this.oa}ha(e,t){let n=t?t.Pa:new uO,r=t?t.ca:this.ca,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=sV(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),f=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),d=!1;u&&h?u.data.isEqual(h.data)?c!==f&&(n.track({type:3,doc:h}),d=!0):this.Ia(u,h)||(n.track({type:2,doc:h}),d=!0,(o&&this.ua(h,o)>0||l&&0>this.ua(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),d=!0):u&&!h&&(n.track({type:1,doc:u}),d=!0,(o||l)&&(a=!0)),d&&(h?(s=s.add(h),i=f?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:a,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;let s=e.Pa.k_();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rs()}};return n(e)-n(t)})(e.type,t.type)||this.ua(e.doc,t.doc)),this.Ta(n),r=null!=r&&r;let a=t&&!r?this.Ea():[],o=0===this.aa.size&&this.current&&!r?1:0,l=o!==this._a;return this._a=o,0!==s.length||l?{snapshot:new uP(this.query,e.ca,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new uO,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(e=>this.oa=this.oa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.oa=this.oa.delete(e)),this.current=e.current)}Ea(){if(!this.current)return[];let e=this.aa;this.aa=sW(),this.ca.forEach(e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))});let t=[];return e.forEach(e=>{this.aa.has(e)||t.push(new uY(e))}),this.aa.forEach(n=>{e.has(n)||t.push(new uW(n))}),t}Ra(e){this.oa=e.hs,this.aa=sW();let t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return uP.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class uJ{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uZ{constructor(e){this.key=e,this.ma=!1}}class u0{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new sU(e=>sP(e),sO),this.pa=new Map,this.ya=new Set,this.wa=new iI(rD.comparator),this.Sa=new Map,this.ba=new lf,this.Da={},this.Ca=new Map,this.va=oZ.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function u1(e,t){let n,r;let i=hp(e),s=i.ga.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.Va();else{let e=await lP(i.localStore,sk(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await u2(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&uu(i.remoteStore,e)}return r}async function u2(e,t,n,r,i){e.Ma=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await lV(e.localStore,t.query,!1).then(({documents:e})=>t.view.ha(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return hr(e,t.targetId,o.da),o.snapshot})(e,t,n,r);let s=await lV(e.localStore,t,!0),a=new uX(t,s.hs),o=a.ha(s.documents),l=aN.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);hr(e,n,u.da);let h=new uJ(t,n,a);return e.ga.set(t,h),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}async function u5(e,t){let n=e.ga.get(t),r=e.pa.get(n.targetId);if(r.length>1)return e.pa.set(n.targetId,r.filter(e=>!sO(e,t))),void e.ga.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lF(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),uh(e.remoteStore,n.targetId),ht(e,n.targetId)}).catch(rU)):(ht(e,n.targetId),await lF(e.localStore,n.targetId,!0))}async function u6(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.os.newChangeBuffer({trackRemovals:!0});r=e.ns;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(e.Qr.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Qr.addMatchingKeys(i,s.addedDocuments,o)));let h=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(iR.EMPTY_BYTE_STRING,rI.min()).withLastLimboFreeSnapshotVersion(rI.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),r=r.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Qr.updateTargetData(i,h))});let o=sz,l=sW();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),a.push(lO(i,s,t.documentUpdates).next(e=>{o=e.cs,l=e.ls})),!n.isEqual(rI.min())){let t=e.Qr.getLastRemoteSnapshotVersion(i).next(t=>e.Qr.setTargetsMetadata(i,i.currentSequenceNumber,n));a.push(t)}return rz.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.ns=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Sa.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||rs(),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?r.ma||rs():t.removedDocuments.size>0&&(r.ma||rs(),r.ma=!1))}),await hs(e,n,t)}catch(e){await rU(e)}}function u3(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n;let i=[];e.ga.forEach((e,n)=>{let r=n.view.U_(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Q_)e.U_(t)&&(n=!0)}),n&&uG(r),i.length&&e.fa.u_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function u4(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Sa.get(t),i=r&&r.key;if(i){let n=new iI(rD.comparator);n=n.insert(i,i8.newNoDocument(i,rI.min()));let r=sW().add(i),s=new aA(rI.min(),new Map,new iI(rb),n,r);await u6(e,s),e.wa=e.wa.remove(i),e.Sa.delete(t),hi(e)}else await lF(e.localStore,t,!1).then(()=>ht(e,t,n)).catch(rU)}async function u8(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=rz.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||rs(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sW();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))});he(e,r,null),u7(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await hs(e,i)}catch(e){await rU(e)}}async function u9(e,t,n){var r;try{let i=await (r=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||rs(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))});he(e,t,n),u7(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await hs(e,i)}catch(e){await rU(e)}}function u7(e,t){(e.Ca.get(t)||[]).forEach(e=>{e.resolve()}),e.Ca.delete(t)}function he(e,t,n){let r=e.Da[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Da[e.currentUser.toKey()]=r}}function ht(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.pa.get(t)))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach(t=>{e.ba.containsKey(t)||hn(e,t)})}function hn(e,t){e.ya.delete(t.path.canonicalString());let n=e.wa.get(t);null!==n&&(uh(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),hi(e))}function hr(e,t,n){for(let r of n)r instanceof uW?(e.ba.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(rt("SyncEngine","New document in limbo: "+n),e.ya.add(r),hi(e))}(e,r)):r instanceof uY?(rt("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||hn(e,r.key)):rs()}function hi(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){let t=e.ya.values().next().value;e.ya.delete(t);let n=new rD(rT.fromString(t)),r=e.va.next();e.Sa.set(r,new uZ(n)),e.wa=e.wa.insert(n,r),uu(e.remoteStore,new ot(sk(sC(n.path)),r,"TargetPurposeLimboResolution",r0._e))}}async function hs(e,t,n){let r=[],i=[],s=[];e.ga.isEmpty()||(e.ga.forEach((a,o)=>{s.push(e.Ma(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);let e=lA.Ki(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.fa.u_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rz.forEach(t,t=>rz.forEach(t.qi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rz.forEach(t.Qi,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rQ(e))throw e;rt("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.ns.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.ns=e.ns.insert(t,i)}}}(e.localStore,i))}async function ha(e,t){var n;if(!e.currentUser.isEqual(t)){rt("SyncEngine","User change. New user:",t.toKey());let r=await lM(e.localStore,t);e.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",e.Ca.forEach(e=>{e.forEach(e=>{e.reject(new rl(ro.CANCELLED,n))})}),e.Ca.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await hs(e,r.us)}}function ho(e,t){let n=e.Sa.get(t);if(n&&n.ma)return sW().add(n.key);{let n=sW(),r=e.pa.get(t);if(!r)return n;for(let t of r){let r=e.ga.get(t);n=n.unionWith(r.view.la)}return n}}async function hl(e,t){let n=await lV(e.localStore,t.query,!0),r=t.view.Ra(n);return e.isPrimaryClient&&hr(e,t.targetId,r.da),r}async function hu(e,t){return lB(e.localStore,t).then(t=>hs(e,t))}async function hh(e,t,n,r){let i=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.vn(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):rz.resolve(null)))}(e.localStore,t);null!==i?("pending"===n?await ux(e.remoteStore):"acknowledged"===n||"rejected"===n?(he(e,t,r||null),u7(e,t),function(e,t){e.mutationQueue.Mn(t)}(e.localStore,t)):rs(),await hs(e,i)):rt("SyncEngine","Cannot apply mutation batch with id: "+t)}async function hc(e,t,n){let r=[],i=[];for(let n of t){let t;let s=e.pa.get(n);if(s&&0!==s.length)for(let n of(t=await lP(e.localStore,sk(s[0])),s)){let t=e.ga.get(n),r=await hl(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await lq(e.localStore,n);t=await lP(e.localStore,r),await u2(e,hf(r),n,!1,t.resumeToken)}r.push(t)}return e.fa.u_(i),r}function hf(e){var t,n,r,i;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,new sS(t,n,r,i,e.limit,"F",e.startAt,e.endAt)}function hd(e){return e.localStore.persistence.Li()}async function hg(e,t,n,r){if(e.Fa)return void rt("SyncEngine","Ignoring unexpected query state notification.");let i=e.pa.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await lB(e.localStore,sq(i[0])),s=aA.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,iR.EMPTY_BYTE_STRING);await hs(e,r,s);break}case"rejected":await lF(e.localStore,t,!0),ht(e,t,r);break;default:rs()}}async function hm(e,t,n){let r=hp(e);if(r.Fa){for(let e of t){if(r.pa.has(e)){rt("SyncEngine","Adding an already active target "+e);continue}let t=await lq(r.localStore,e),n=await lP(r.localStore,t);await u2(r,hf(t),n.targetId,!1,n.resumeToken),uu(r.remoteStore,n)}for(let e of n)r.pa.has(e)&&await lF(r.localStore,e,!1).then(()=>{uh(r.remoteStore,e),ht(r,e)}).catch(rU)}}function hp(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=u6.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ho.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=u4.bind(null,e),e.fa.u_=uU.bind(null,e.eventManager),e.fa.xa=uz.bind(null,e.eventManager),e}function hy(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=u8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=u9.bind(null,e),e}class hw{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=l7(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t;return t=this.persistence,new lR(t,new lk,e.initialUser,this.serializer)}createPersistence(e){return new lw(lb.Hr,this.serializer)}createSharedClientState(e){return new lJ}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hv extends hw{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return this.persistence.referenceDelegate instanceof lx||rs(),new o4(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?oK.withCacheSize(this.cacheSizeBytes):oK.DEFAULT;return new lw(e=>lx.Hr(e,t),this.serializer)}}class hb extends hw{constructor(e,t,n){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Na.initialize(this,e),await hy(this.Na.syncEngine),await ux(this.Na.remoteStore),await this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t;return t=this.persistence,new lR(t,new lk,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new o4(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new rZ(t,this.persistence);return new rJ(e.asyncQueue,n)}createPersistence(e){let t=lD(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?oK.withCacheSize(this.cacheSizeBytes):oK.DEFAULT;return new lT(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,l8(),l9(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lJ}}class hx extends hb{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Na.syncEngine;this.sharedClientState instanceof lX&&(this.sharedClientState.syncEngine={Zs:hh.bind(null,t),Xs:hg.bind(null,t),eo:hm.bind(null,t),Li:hd.bind(null,t),Ys:hu.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi(async e=>{await async function(e,t){if(hp(e),hy(e),!0===t&&!0!==e.Fa){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await hc(e,t.toArray());for(let t of(e.Fa=!0,await uA(e.remoteStore,!0),n))uu(e.remoteStore,t)}else if(!1===t&&!1!==e.Fa){let t=[],n=Promise.resolve();e.pa.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(ht(e,i),lF(e.localStore,i,!0))),uh(e.remoteStore,i)}),await n,await hc(e,t),e.Sa.forEach((t,n)=>{uh(e.remoteStore,n)}),e.ba.mr(),e.Sa=new Map,e.wa=new iI(rD.comparator),e.Fa=!1,await uA(e.remoteStore,!1)}}(this.Na.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=l8();if(!lX.D(t))throw new rl(ro.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=lD(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new lX(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class h_{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>u3(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ha.bind(null,this.syncEngine),await uA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uV}createDatastore(e){let t=l7(e.databaseInfo.databaseId),n=new l4(e.databaseInfo);return new ui(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){var t;return t=this.localStore,new ua(t,this.datastore,e.asyncQueue,e=>u3(this.syncEngine,e,0),l0.D()?new l0:new lZ)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new u0(e,t,n,r,i,s);return a&&(o.Fa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){rt("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await ul(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}function hI(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class hE{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):rn("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hT{constructor(e,t){this.ka=e,this.serializer=t,this.metadata=new ru,this.buffer=new Uint8Array,this.qa=new TextDecoder("utf-8"),this.Qa().then(e=>{e&&e.ea()?this.metadata.resolve(e.X_.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.X_)}`))},e=>this.metadata.reject(e))}close(){return this.ka.cancel()}async getMetadata(){return this.metadata.promise}async Oa(){return await this.getMetadata(),this.Qa()}async Qa(){let e=await this.Ka();if(null===e)return null;let t=this.qa.decode(e),n=Number(t);return isNaN(n)&&this.$a(`length string (${t}) is not valid number`),new uK(JSON.parse(await this.Ua(n)),e.length+n)}Wa(){return this.buffer.findIndex(e=>123===e)}async Ka(){for(;0>this.Wa()&&!await this.Ga(););if(0===this.buffer.length)return null;let e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ua(e){for(;this.buffer.length<e;)await this.Ga()&&this.$a("Reached the end of bundle when more is expected.");let t=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}$a(e){throw this.ka.cancel(),Error(`Invalid bundle format: ${e}`)}async Ga(){let e=await this.ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class hS{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new rl(ro.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>aW(e.serializer,t))},r=await e.vo("BatchGetDocuments",e.serializer.databaseId,rT.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r=(n=e.serializer,"found"in t?function(e,t){t.found||rs(),t.found.name,t.found.updateTime;let n=aY(e,t.found.name),r=aK(t.found.updateTime),i=t.found.createTime?aK(t.found.createTime):rI.min(),s=new i4({mapValue:{fields:t.found.fields}});return i8.newFoundDocument(n,r,i,s)}(n,t):"missing"in t?function(e,t){t.missing||rs(),t.readTime||rs();let n=aY(e,t.missing),r=aK(t.readTime);return i8.newNoDocument(n,r)}(n,t):rs());i.set(r.key.toString(),r)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());t||rs(),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ad(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rD.fromPath(t);this.mutations.push(new ag(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>a5(e.serializer,t))};await e.So("Commit",e.serializer.databaseId,rT.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw rs();t=rI.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new rl(ro.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rI.min())?an.exists(!1):an.updateTime(t):an.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(rI.min()))throw new rl(ro.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return an.updateTime(t)}return an.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class hC{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.za=n.maxAttempts,this.jo=new ue(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo(async()=>{let e=new hS(this.datastore),t=this.Ja(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Ya(e)}))}).catch(e=>{this.Ya(e)})})}Ja(e){try{let t=this.updateFunction(e);return!r1(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ha(),Promise.resolve()))):this.deferred.reject(e)}Za(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ab(t)}return!1}}class hD{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=n4.UNAUTHENTICATED,this.clientId=rv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{rt("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rt("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rl(ro.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ru;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=uM(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hA(e,t){e.asyncQueue.verifyOperationInProgress(),rt("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await lM(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hN(e,t){e.asyncQueue.verifyOperationInProgress();let n=await hR(e);rt("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>uD(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>uD(t.remoteStore,n)),e._onlineComponents=t}function hk(e){return"FirebaseError"===e.name?e.code===ro.FAILED_PRECONDITION||e.code===ro.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function hR(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){rt("FirestoreClient","Using user provided OfflineComponentProvider");try{await hA(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!hk(t))throw t;rr("Error using user provided cache. Falling back to memory cache: "+t),await hA(e,new hw)}}else rt("FirestoreClient","Using default OfflineComponentProvider"),await hA(e,new hw)}return e._offlineComponents}async function hM(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rt("FirestoreClient","Using user provided OnlineComponentProvider"),await hN(e,e._uninitializedComponentsProvider._online)):(rt("FirestoreClient","Using default OnlineComponentProvider"),await hN(e,new h_))),e._onlineComponents}function hL(e){return hR(e).then(e=>e.persistence)}function hO(e){return hR(e).then(e=>e.localStore)}function hP(e){return hM(e).then(e=>e.remoteStore)}function hF(e){return hM(e).then(e=>e.syncEngine)}function hV(e){return hM(e).then(e=>e.datastore)}async function hq(e){let t=await hM(e),n=t.eventManager;return n.onListen=u1.bind(null,t.syncEngine),n.onUnlisten=u5.bind(null,t.syncEngine),n}function hB(e,t,n={}){let r=new ru;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new hE({next:s=>{t.enqueueAndForget(()=>uB(e,a));let o=s.docs.has(n);!o&&s.fromCache?i.reject(new rl(ro.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&s.fromCache&&r&&"server"===r.source?i.reject(new rl(ro.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new uj(sC(n.path),s,{includeMetadataChanges:!0,Z_:!0});return uq(e,a)})(await hq(e),e.asyncQueue,t,n,r)),r.promise}function hU(e,t,n={}){let r=new ru;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new uj(n,new hE({next:n=>{t.enqueueAndForget(()=>uB(e,s)),n.fromCache&&"server"===r.source?i.reject(new rl(ro.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,Z_:!0});return uq(e,s)})(await hq(e),e.asyncQueue,t,n,r)),r.promise}function hz(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hG=new Map;function hj(e,t,n){if(!n)throw new rl(ro.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hK(e,t,n,r){if(!0===t&&!0===r)throw new rl(ro.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function h$(e){if(!rD.isDocumentKey(e))throw new rl(ro.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hQ(e){if(rD.isDocumentKey(e))throw new rl(ro.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hH(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":rs()}function hW(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rl(ro.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=hH(e);throw new rl(ro.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function hY(e,t){if(t<=0)throw new rl(ro.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class hX{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new rl(ro.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new rl(ro.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hK("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hz(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rl(ro.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new rl(ro.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new rl(ro.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hJ{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hX({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new rl(ro.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rl(ro.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hX(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new rc;switch(e.type){case"firstParty":return new rm(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rl(ro.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=hG.get(e);t&&(rt("ComponentProvider","Removing Datastore"),hG.delete(e),t.terminate())}(this),Promise.resolve()}}function hZ(e,t,n,r={}){var i;let s=(e=hW(e,hJ))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=n4.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new rl(ro.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new n4(s)}e._authCredentials=new rf(new rh(t,n))}}class h0{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new h0(this.firestore,e,this._query)}}class h1{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new h2(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new h1(this.firestore,e,this._key)}}class h2 extends h0{constructor(e,t,n){super(e,t,sC(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new h1(this.firestore,null,new rD(e))}withConverter(e){return new h2(this.firestore,e,this._path)}}function h5(e,t,...n){if(e=T(e),hj("collection","path",t),e instanceof hJ){let r=rT.fromString(t,...n);return hQ(r),new h2(e,null,r)}{if(!(e instanceof h1||e instanceof h2))throw new rl(ro.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rT.fromString(t,...n));return hQ(r),new h2(e.firestore,null,r)}}function h6(e,t){if(e=hW(e,hJ),hj("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new rl(ro.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new h0(e,null,new sS(rT.emptyPath(),t))}function h3(e,t,...n){if(e=T(e),1==arguments.length&&(t=rv.newId()),hj("doc","path",t),e instanceof hJ){let r=rT.fromString(t,...n);return h$(r),new h1(e,null,new rD(r))}{if(!(e instanceof h1||e instanceof h2))throw new rl(ro.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rT.fromString(t,...n));return h$(r),new h1(e.firestore,e instanceof h2?e.converter:null,new rD(r))}}function h4(e,t){return e=T(e),t=T(t),(e instanceof h1||e instanceof h2)&&(t instanceof h1||t instanceof h2)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function h8(e,t){return e=T(e),t=T(t),e instanceof h0&&t instanceof h0&&e.firestore===t.firestore&&sO(e._query,t._query)&&e.converter===t.converter}class h9{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new ue(this,"async_queue_retry"),this._u=()=>{let e=l9();e&&rt("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let e=l9();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;let t=l9();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});let t=new ru;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!rQ(e))throw e;rt("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo(()=>this.cu())}}uu(e){let t=this.Xa.then(()=>(this.iu=!0,e().catch(e=>{let t;throw this.ru=e,this.iu=!1,rn("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.iu=!1,e))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);let r=uR.createAndSchedule(this,e,t,n,e=>this.lu(e));return this.nu.push(r),r}au(){this.ru&&rs()}verifyOperationInProgress(){}async hu(){let e;do e=this.Xa,await e;while(e!==this.Xa)}Pu(e){for(let t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{for(let t of(this.nu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.nu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){let t=this.nu.indexOf(e);this.nu.splice(t,1)}}function h7(e){return function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])}class ce{constructor(){this._progressObserver={},this._taskCompletionResolver=new ru,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let ct=-1;class cn extends hJ{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new h9,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ca(this),this._firestoreClient.terminate()}}function cr(e,t,n){n||(n="(default)");let r=(0,l._getProvider)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n});if(I(r.getOptions(n),t))return e;throw new rl(ro.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new rl(ro.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new rl(ro.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})}function ci(e,t){let n="object"==typeof e?e:(0,l.getApp)(),r=(0,l._getProvider)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){let e=y("firestore");e&&hZ(r,...e)}return r}function cs(e){return e._firestoreClient||ca(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function ca(e){var t,n,r,i;let s=e._freezeSettings(),a=(i=e._databaseId,new iB(i,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,hz(s.experimentalLongPollingOptions),s.useFetchStreams));e._firestoreClient=new hD(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}function co(e,t){cy(e=hW(e,cn));let n=cs(e);if(n._uninitializedComponentsProvider)throw new rl(ro.FAILED_PRECONDITION,"SDK cache is already specified.");rr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings(),i=new h_;return cu(n,i,new hb(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function cl(e){cy(e=hW(e,cn));let t=cs(e);if(t._uninitializedComponentsProvider)throw new rl(ro.FAILED_PRECONDITION,"SDK cache is already specified.");rr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings(),r=new h_;return cu(t,r,new hx(r,n.cacheSizeBytes))}function cu(e,t,n){let r=new ru;return e.asyncQueue.enqueue(async()=>{try{await hA(e,n),await hN(e,t),r.resolve()}catch(e){if(!hk(e))throw e;rr("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}}).then(()=>r.promise)}function ch(e){if(e._initialized&&!e._terminated)throw new rl(ro.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new ru;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rj.D())return Promise.resolve();await rj.delete(e+"main")}(lD(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function cc(e){return function(e){let t=new ru;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t){var n;um(e.remoteStore)||rt("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Ca.get(r)||[];i.push(t),e.Ca.set(r,i)}catch(n){let e=uM(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}})(await hF(e),t)),t.promise}(cs(e=hW(e,cn)))}function cf(e){var t;return(t=cs(e=hW(e,cn))).asyncQueue.enqueue(async()=>{let e=await hL(t),n=await hP(t);return e.setNetworkEnabled(!0),n.v_.delete(0),uo(n)})}function cd(e){var t;return(t=cs(e=hW(e,cn))).asyncQueue.enqueue(async()=>{let e=await hL(t),n=await hP(t);return e.setNetworkEnabled(!1),async function(e){e.v_.add(0),await ul(e),e.x_.set("Offline")}(n)})}function cg(e){return(0,l._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function cm(e,t){let n=cs(e=hW(e,cn)),r=new ce;return function(e,t,n,r){var i;let s=(i=l7(t),new hT(function(e,t){if(e instanceof Uint8Array)return hI(e,void 0);if(e instanceof ArrayBuffer)return hI(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?aI().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){(async function(e,t,n){try{var r;let i=await t.getMetadata();if(await function(e,t){let n=aK(t.createTime);return e.persistence.runTransaction("hasNewerBundle","readonly",n=>e.$r.getBundleMetadata(n,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}(e.localStore,i))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(uH(i));let s=new uQ(i,e.localStore,t.serializer),a=await t.Oa();for(;a;){let e=await s.na(a);e&&n._updateProgress(e),a=await t.Oa()}let o=await s.complete();return await hs(e,o.sa,void 0),await (r=e.localStore).persistence.runTransaction("Save bundle","readwrite",e=>r.$r.saveBundleMetadata(e,i)),n._completeWith(o.progress),Promise.resolve(o.ia)}catch(e){return rr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(e,t,n).then(t=>{e.sharedClientState.notifyBundleLoaded(t)})}(await hF(e),s,r)})}(n,e._databaseId,t,r),r}function cp(e,t){var n;return(n=cs(e=hW(e,cn))).asyncQueue.enqueue(async()=>{var e;return(e=await hO(n)).persistence.runTransaction("Get named query","readonly",n=>e.$r.getNamedQuery(n,t))}).then(t=>t?new h0(e,null,t.query):null)}function cy(e){if(e._initialized||e._terminated)throw new rl(ro.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class cw{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class cv{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class cb{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cb(iR.fromBase64String(e))}catch(e){throw new rl(ro.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cb(iR.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class cx{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rl(ro.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rC(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function c_(){return new cx("__name__")}class cI{constructor(e){this._methodName=e}}class cE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rl(ro.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rl(ro.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rb(this._lat,e._lat)||rb(this._long,e._long)}}let cT=/^__.*__$/;class cS{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new au(e,this.data,this.fieldMask,t,this.fieldTransforms):new al(e,this.data,t,this.fieldTransforms)}}class cC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new au(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cD(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rs()}}class cA{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new cA(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return cW(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(cD(this.du)&&cT.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class cN{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||l7(e)}Su(e,t,n,r=!1){return new cA({du:e,methodName:t,wu:n,path:rC.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ck(e){let t=e._freezeSettings(),n=l7(e._databaseId);return new cN(e._databaseId,!!t.ignoreUndefinedProperties,n)}function cR(e,t,n,r,i,s={}){let a,o;let l=e.Su(s.merge||s.mergeFields?2:0,t,n,i);cK("Data must be an object, but it was:",l,r);let u=cG(r,l);if(s.merge)a=new iA(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=c$(t,r,n);if(!l.contains(i))throw new rl(ro.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cY(e,i)||e.push(i)}a=new iA(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cS(new i4(u),a,o)}class cM extends cI{_toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cM}}function cL(e,t,n){return new cA({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class cO extends cI{_toFieldTransform(e){return new ae(e.path,new s2)}isEqual(e){return e instanceof cO}}class cP extends cI{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=cL(this,e,!0),n=new s5(this.bu.map(e=>cz(e,t)));return new ae(e.path,n)}isEqual(e){return e instanceof cP&&I(this.bu,e.bu)}}class cF extends cI{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=cL(this,e,!0),n=new s3(this.bu.map(e=>cz(e,t)));return new ae(e.path,n)}isEqual(e){return e instanceof cF&&I(this.bu,e.bu)}}class cV extends cI{constructor(e,t){super(e),this.Du=t}_toFieldTransform(e){let t=new s8(e.serializer,sZ(e.serializer,this.Du));return new ae(e.path,t)}isEqual(e){return e instanceof cV&&this.Du===e.Du}}function cq(e,t,n,r){let i=e.Su(1,t,n);cK("Data must be an object, but it was:",i,r);let s=[],a=i4.empty();return ix(r,(e,r)=>{let o=cH(t,e,n);r=T(r);let l=i.fu(o);if(r instanceof cM)s.push(o);else{let e=cz(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new cC(a,new iA(s),i.fieldTransforms)}function cB(e,t,n,r,i,s){let a=e.Su(1,t,n),o=[c$(t,r,n)],l=[i];if(s.length%2!=0)throw new rl(ro.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(c$(t,s[e])),l.push(s[e+1]);let u=[],h=i4.empty();for(let e=o.length-1;e>=0;--e)if(!cY(u,o[e])){let t=o[e],n=l[e];n=T(n);let r=a.fu(t);if(n instanceof cM)u.push(t);else{let e=cz(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new cC(h,new iA(u),a.fieldTransforms)}function cU(e,t,n,r=!1){return cz(n,e.Su(r?4:3,t))}function cz(e,t){if(cj(e=T(e)))return cK("Unsupported field value:",t,e),cG(e,t);if(e instanceof cI)return function(e,t){if(!cD(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){let n=[],r=0;for(let i of e){let e=cz(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=T(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sZ(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=r_.fromDate(e);return{timestampValue:aG(t.serializer,n)}}if(e instanceof r_){let n=new r_(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aG(t.serializer,n)}}if(e instanceof cE)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cb)return{bytesValue:aj(t.serializer,e._byteString)};if(e instanceof h1){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:a$(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${hH(e)}`)}(e,t)}function cG(e,t){let n={};return i_(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ix(e,(e,r)=>{let i=cz(r,t.Ru(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function cj(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof r_||e instanceof cE||e instanceof cb||e instanceof h1||e instanceof cI)}function cK(e,t,n){if(!cj(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){let r=hH(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function c$(e,t,n){if((t=T(t))instanceof cx)return t._internalPath;if("string"==typeof t)return cH(e,t);throw cW("Field path arguments must be of type string or ",e,!1,void 0,n)}let cQ=RegExp("[~\\*/\\[\\]]");function cH(e,t,n){if(t.search(cQ)>=0)throw cW(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new cx(...t.split("."))._internalPath}catch(r){throw cW(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function cW(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new rl(ro.INVALID_ARGUMENT,o+e+l)}function cY(e,t){return e.some(e=>e.isEqual(t))}class cX{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new h1(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new cJ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cZ("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cJ extends cX{data(){return super.data()}}function cZ(e,t){return"string"==typeof t?cH(e,t):t instanceof cx?t._internalPath:t._delegate._internalPath}function c0(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rl(ro.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class c1{}class c2 extends c1{}function c5(e,t,...n){let r=[];for(let i of(t instanceof c1&&r.push(t),function(e){let t=e.filter(e=>e instanceof c4).length,n=e.filter(e=>e instanceof c6).length;if(t>1||t>0&&n>0)throw new rl(ro.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class c6 extends c2{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new c6(e,t,n)}_apply(e){let t=this._parse(e);return fd(e._query,t),new h0(e.firestore,e.converter,sM(e._query,t))}_parse(e){let t=ck(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rl(ro.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ff(a,s);let t=[];for(let n of a)t.push(fc(r,e,n));o={arrayValue:{values:t}}}else o=fc(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ff(a,s),o=cU(n,t,a,"in"===s||"not-in"===s);return sr.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function c3(e,t,n){let r=cZ("where",e);return c6._create(r,t,n)}class c4 extends c1{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c4(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:si.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())fd(n,e),n=sM(n,e)}(e._query,t),new h0(e.firestore,e.converter,sM(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function c8(...e){return e.forEach(e=>fg("or",e)),c4._create("or",e)}function c9(...e){return e.forEach(e=>fg("and",e)),c4._create("and",e)}class c7 extends c2{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new c7(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new rl(ro.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rl(ro.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new st(t,n)}(e._query,this._field,this._direction);return new h0(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new sS(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function fe(e,t="asc"){let n=cZ("orderBy",e);return c7._create(n,t)}class ft extends c2{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ft(e,t,n)}_apply(e){return new h0(e.firestore,e.converter,sL(e._query,this._limit,this._limitType))}}function fn(e){return hY("limit",e),ft._create("limit",e,"F")}function fr(e){return hY("limitToLast",e),ft._create("limitToLast",e,"L")}class fi extends c2{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fi(e,t,n)}_apply(e){var t;let n=fh(e,this.type,this._docOrFields,this._inclusive);return new h0(e.firestore,e.converter,new sS((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}function fs(...e){return fi._create("startAt",e,!0)}function fa(...e){return fi._create("startAfter",e,!1)}class fo extends c2{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fo(e,t,n)}_apply(e){var t;let n=fh(e,this.type,this._docOrFields,this._inclusive);return new h0(e.firestore,e.converter,new sS((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n))}}function fl(...e){return fo._create("endBefore",e,!1)}function fu(...e){return fo._create("endAt",e,!0)}function fh(e,t,n,r){if(n[0]=T(n[0]),n[0]instanceof cX)return function(e,t,n,r,i){if(!r)throw new rl(ro.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of sN(e))if(n.field.isKeyField())s.push(iY(t,r.key));else{let e=r.data.field(n.field);if(iF(e))throw new rl(ro.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new rl(ro.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new i9(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=ck(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rl(ro.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rl(ro.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!sA(e)&&-1!==l.indexOf("/"))throw new rl(ro.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(rT.fromString(l));if(!rD.isDocumentKey(n))throw new rl(ro.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rD(n);o.push(iY(t,i))}else{let e=cU(n,r,l);o.push(e)}}return new i9(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function fc(e,t,n){if("string"==typeof(n=T(n))){if(""===n)throw new rl(ro.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sA(t)&&-1!==n.indexOf("/"))throw new rl(ro.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(rT.fromString(n));if(!rD.isDocumentKey(r))throw new rl(ro.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return iY(e,new rD(r))}if(n instanceof h1)return iY(e,n._key);throw new rl(ro.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hH(n)}.`)}function ff(e,t){if(!Array.isArray(e)||0===e.length)throw new rl(ro.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function fd(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new rl(ro.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rl(ro.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function fg(e,t){if(!(t instanceof c6||t instanceof c4))throw new rl(ro.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class fm{convertValue(e,t="none"){switch(ij(e)){case 0:return null;case 1:return e.booleanValue;case 2:return iO(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iP(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw rs()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return ix(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new cE(iO(e.latitude),iO(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=iV(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iq(e));default:return null}}convertTimestamp(e){let t=iL(e);return new r_(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=rT.fromString(e);oe(n)||rs();let r=new iU(n.get(1),n.get(3)),i=new rD(n.popFirst(5));return r.isEqual(t)||rn(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function fp(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class fy extends fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new cb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new h1(this.firestore,null,t)}}function fw(e){return new cw("sum",c$("sum",e))}function fv(e){return new cw("avg",c$("average",e))}function fb(){return new cw("count")}function fx(e,t){var n,r;return e instanceof cw&&t instanceof cw&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())}function f_(e,t){return h8(e.query,t.query)&&I(e.data(),t.data())}class fI{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fE extends cX{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new fT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(cZ("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class fT extends fE{data(e={}){return super.data(e)}}class fS{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fI(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new fT(this._firestore,this._userDataWriter,n.key,n,new fI(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rl(ro.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new fT(e._firestore,e._userDataWriter,n.doc.key,n.doc,new fI(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new fT(e._firestore,e._userDataWriter,t.doc.key,t.doc,new fI(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rs()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function fC(e,t){return e instanceof fE&&t instanceof fE?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof fS&&t instanceof fS&&e._firestore===t._firestore&&h8(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function fD(e){e=hW(e,h1);let t=hW(e.firestore,cn);return hB(cs(t),e._key).then(n=>fz(t,e,n))}class fA extends fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new cb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new h1(this.firestore,null,t)}}function fN(e){e=hW(e,h1);let t=hW(e.firestore,cn),n=cs(t),r=new fA(t);return(function(e,t){let n=new ru;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new rl(ro.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=uM(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await hO(e),t,n)),n.promise})(n,e._key).then(n=>new fE(t,r,e._key,n,new fI(null!==n&&n.hasLocalMutations,!0),e.converter))}function fk(e){e=hW(e,h1);let t=hW(e.firestore,cn);return hB(cs(t),e._key,{source:"server"}).then(n=>fz(t,e,n))}function fR(e){e=hW(e,h0);let t=hW(e.firestore,cn),n=cs(t),r=new fA(t);return c0(e._query),hU(n,e._query).then(n=>new fS(t,r,e,n))}function fM(e){e=hW(e,h0);let t=hW(e.firestore,cn),n=cs(t),r=new fA(t);return(function(e,t){let n=new ru;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await lV(e,t,!0),i=new uX(t,r.hs),s=i.ha(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=uM(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await hO(e),t,n)),n.promise})(n,e._query).then(n=>new fS(t,r,e,n))}function fL(e){e=hW(e,h0);let t=hW(e.firestore,cn),n=cs(t),r=new fA(t);return hU(n,e._query,{source:"server"}).then(n=>new fS(t,r,e,n))}function fO(e,t,n){e=hW(e,h1);let r=hW(e.firestore,cn),i=fp(e.converter,t,n);return fU(r,[cR(ck(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,an.none())])}function fP(e,t,n,...r){e=hW(e,h1);let i=hW(e.firestore,cn),s=ck(i);return fU(i,[("string"==typeof(t=T(t))||t instanceof cx?cB(s,"updateDoc",e._key,t,n,r):cq(s,"updateDoc",e._key,t)).toMutation(e._key,an.exists(!0))])}function fF(e){return fU(hW(e.firestore,cn),[new ad(e._key,an.none())])}function fV(e,t){let n=hW(e.firestore,cn),r=h3(e),i=fp(e.converter,t);return fU(n,[cR(ck(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,an.exists(!1))]).then(()=>r)}function fq(e,...t){var n,r,i;let s,a,o;e=T(e);let l={includeMetadataChanges:!1},u=0;"object"!=typeof t[0]||h7(t[u])||(l=t[u],u++);let h={includeMetadataChanges:l.includeMetadataChanges};if(h7(t[u])){let e=t[u];t[u]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[u+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[u+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}if(e instanceof h1)a=hW(e.firestore,cn),o=sC(e._key.path),s={next:n=>{t[u]&&t[u](fz(a,e,n))},error:t[u+1],complete:t[u+2]};else{let n=hW(e,h0);a=hW(n.firestore,cn),o=n._query;let r=new fA(a);s={next:e=>{t[u]&&t[u](new fS(a,r,n,e))},error:t[u+1],complete:t[u+2]},c0(e._query)}return function(e,t,n,r){let i=new hE(r),s=new uj(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>uq(await hq(e),s)),()=>{i.La(),e.asyncQueue.enqueueAndForget(async()=>uB(await hq(e),s))}}(cs(a),o,h,s)}function fB(e,t){return function(e,t){let n=new hE(t);return e.asyncQueue.enqueueAndForget(async()=>{(await hq(e)).K_.add(n),n.next()}),()=>{n.La(),e.asyncQueue.enqueueAndForget(async()=>(function(e,t){e.K_.delete(t)})(await hq(e),n))}}(cs(e=hW(e,cn)),h7(t)?t:{next:t})}function fU(e,t){return function(e,t){let n=new ru;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){let r=hy(e);try{var i;let e;let s=await function(e,t){let n,r;let i=r_.now(),s=t.reduce((e,t)=>e.add(t.key),sW());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=sz,l=sW();return e.os.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=s1(r.transform,e||null);null!=i&&(null===n&&(n=i4.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new au(e.key,t,function e(t){let n=[];return ix(t.fields,(t,r)=>{let i=new rC([t]);if(i1(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new iA(n)}(t.value.mapValue),an.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:sK(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.Da[r.currentUser.toKey()])||(e=new iI(rb)),e=e.insert(i,n),r.Da[r.currentUser.toKey()]=e,await hs(r,s.changes),await ux(r.remoteStore)}catch(t){let e=uM(t,"Failed to persist write");n.reject(e)}})(await hF(e),t,n)),n.promise}(cs(e),t)}function fz(e,t,n){let r=n.docs.get(t._key),i=new fA(e);return new fE(e,i,t._key,r,new fI(n.hasPendingWrites,n.fromCache),t.converter)}function fG(e){return fj(e,{count:fb()})}function fj(e,t){let n=hW(e.firestore,cn),r=cs(n),i=function(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}(t,(e,t)=>new aw(t,e.aggregateType,e._internalFieldPath));return(function(e,t,n){let r=new ru;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await hV(e);r.resolve(async function(e,t,n){var r;let{request:i,V_:s,parent:a}=function(e,t,n){let{ut:r,parent:i}=a4(e,t),s={},a=[],o=0;return n.forEach(e=>{let t="aggregate_"+o++;s[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:a9(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:a9(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},V_:s,parent:i}}(e.serializer,(t.Pe||(t.Pe=sR(t,t.explicitOrderBy)),t.Pe),n);e.connection.wo||delete i.parent;let o=(await e.vo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);1===o.length||rs();let l=null===(r=o[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(i,t,n))}catch(e){r.reject(e)}}),r.promise})(r,e._query,i).then(t=>new cv(e,new fA(n),t))}class fK{constructor(e){this.kind="memory",this._onlineComponentProvider=new h_,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=new hw}toJSON(){return{kind:this.kind}}}class f${constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=f1(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class fQ{constructor(){this.kind="memoryEager",this._offlineComponentProvider=new hw}toJSON(){return{kind:this.kind}}}class fH{constructor(e){this.kind="memoryLru",this._offlineComponentProvider=new hv(e)}toJSON(){return{kind:this.kind}}}function fW(){return new fQ}function fY(e){return new fH(null==e?void 0:e.cacheSizeBytes)}function fX(e){return new fK(e)}function fJ(e){return new f$(e)}class fZ{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new h_,this._offlineComponentProvider=new hb(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}class f0{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new h_,this._offlineComponentProvider=new hx(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes)}}function f1(e){return new fZ(null==e?void 0:e.forceOwnership)}function f2(){return new f0}let f5={maxAttempts:5};class f6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ck(e)}set(e,t,n){this._verifyNotCommitted();let r=f3(e,this._firestore),i=fp(r.converter,t,n),s=cR(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,an.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=f3(e,this._firestore);return i="string"==typeof(t=T(t))||t instanceof cx?cB(this._dataReader,"WriteBatch.update",s._key,t,n,r):cq(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,an.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=f3(e,this._firestore);return this._mutations=this._mutations.concat(new ad(t._key,an.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rl(ro.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function f3(e,t){if((e=T(e)).firestore!==t)throw new rl(ro.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class f4 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ck(e)}get(e){let t=f3(e,this._firestore),n=new fy(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rs();let r=e[0];if(r.isFoundDocument())return new cX(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new cX(this._firestore,n,t._key,null,t.converter);throw rs()})}set(e,t,n){let r=f3(e,this._firestore),i=fp(r.converter,t,n),s=cR(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i;let s=f3(e,this._firestore);return i="string"==typeof(t=T(t))||t instanceof cx?cB(this._dataReader,"Transaction.update",s._key,t,n,r):cq(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=f3(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=f3(e,this._firestore),n=new fA(this._firestore);return super.get(e).then(e=>new fE(this._firestore,n,t._key,e._document,new fI(!1,!1),t.converter))}}function f8(e,t,n){e=hW(e,cn);let r=Object.assign(Object.assign({},f5),n);return function(e){if(e.maxAttempts<1)throw new rl(ro.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){let r=new ru;return e.asyncQueue.enqueueAndForget(async()=>{let i=await hV(e);new hC(e.asyncQueue,i,n,t,r).ja()}),r.promise}(cs(e),n=>t(new f4(e,n)),r)}function f9(){return new cM("deleteField")}function f7(){return new cO("serverTimestamp")}function de(...e){return new cP("arrayUnion",e)}function dt(...e){return new cF("arrayRemove",e)}function dn(e){return new cV("increment",e)}function dr(e){return cs(e=hW(e,cn)),new f6(e,t=>fU(e,t))}function di(e,t){var n;let r=cs(e=hW(e,cn));if(!r._uninitializedComponentsProvider||"memory"===(null===(n=r._uninitializedComponentsProvider)||void 0===n?void 0:n._offlineKind))return rr("Cannot enable indexes when persistence is disabled"),Promise.resolve();let i=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new rl(ro.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ds(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=cH("setIndexConfiguration",ds(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new rM(e,2)):"ASCENDING"===t.order?r.push(new rM(e,0)):"DESCENDING"===t.order&&r.push(new rM(e,1))}n.push(new rA(rA.UNKNOWN_ID,t,r,rL.empty()))}return n}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,rR,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>rz.waitFor(r)))})(await hO(r),i))}function ds(e,t){if("string"!=typeof e[t])throw new rl(ro.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class da{constructor(e){this._client=e,this.type="PersistentCacheIndexManager"}}function dl(e){var t;e=hW(e,cn);let n=dd.get(e);if(n)return n;let r=cs(e);if("persistent"!==(null===(t=r._uninitializedComponentsProvider)||void 0===t?void 0:t._offlineKind))return null;let i=new da(r);return dd.set(e,i),i}function du(e){df(e,!0)}function dh(e){df(e,!1)}function dc(e){var t;e._client.verifyNotTerminated(),(t=e._client).asyncQueue.enqueue(async()=>(function(e){let t=e.indexManager;return e.persistence.runTransaction("Delete All Indexes","readwrite",e=>t.deleteAllFieldIndexes(e))})(await hO(t))).then(e=>rt("deleting all persistent cache indexes succeeded")).catch(e=>rr("deleting all persistent cache indexes failed",e))}function df(e,t){var n;e._client.verifyNotTerminated(),(n=e._client).asyncQueue.enqueue(async()=>{(await hO(n)).ts.Ui=t}).then(e=>rt(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>rr(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let dd=new WeakMap;class dg{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return dm.instance.onExistenceFilterMismatch(e)}}class dm{constructor(){this.Cu=new Map}static get instance(){return dp||function(e){if(a_)throw Error("a TestingHooksSpi instance is already set");a_=e}(dp=new dm),dp}tt(e){this.Cu.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Cu;return n.set(t,e),()=>n.delete(t)}}let dp=null;!function(e,t=!0){n8=l.SDK_VERSION,(0,l._registerComponent)(new S("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new cn(new rd(e.getProvider("auth-internal")),new ry(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rl(ro.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iU(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,l.registerVersion)(n3,"4.4.2",void 0),(0,l.registerVersion)(n3,"4.4.2","esm2017")}()});