var e=globalThis;function t(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var n=e.parcelRequire94c2;(0,n.register)("4rxkr",function(r,i){t(r.exports,"setLogLevel",()=>n4),t(r.exports,"_logWarn",()=>n7),t(r.exports,"_debugAssert",()=>rn),t(r.exports,"FirestoreError",()=>ri),t(r.exports,"_EmptyAuthCredentialsProvider",()=>ro),t(r.exports,"_EmptyAppCheckTokenProvider",()=>rg),t(r.exports,"_AutoId",()=>rm),t(r.exports,"Timestamp",()=>rw),t(r.exports,"_FieldPath",()=>rE),t(r.exports,"_DocumentKey",()=>rx),t(r.exports,"_isBase64Available",()=>iC),t(r.exports,"_ByteString",()=>iD),t(r.exports,"_DatabaseId",()=>iF),t(r.exports,"_validateIsNotUsedTogether",()=>hU),t(r.exports,"_cast",()=>hK),t(r.exports,"connectFirestoreEmulator",()=>hW),t(r.exports,"Query",()=>hY),t(r.exports,"DocumentReference",()=>hX),t(r.exports,"CollectionReference",()=>hJ),t(r.exports,"collection",()=>hZ),t(r.exports,"collectionGroup",()=>h0),t(r.exports,"doc",()=>h1),t(r.exports,"refEqual",()=>h2),t(r.exports,"queryEqual",()=>h5),t(r.exports,"LoadBundleTask",()=>h4),t(r.exports,"CACHE_SIZE_UNLIMITED",()=>h8),t(r.exports,"Firestore",()=>h9),t(r.exports,"initializeFirestore",()=>h7),t(r.exports,"getFirestore",()=>ce),t(r.exports,"ensureFirestoreConfigured",()=>ct),t(r.exports,"enableIndexedDbPersistence",()=>cr),t(r.exports,"enableMultiTabIndexedDbPersistence",()=>ci),t(r.exports,"clearIndexedDbPersistence",()=>ca),t(r.exports,"waitForPendingWrites",()=>co),t(r.exports,"enableNetwork",()=>cl),t(r.exports,"disableNetwork",()=>cu),t(r.exports,"terminate",()=>ch),t(r.exports,"loadBundle",()=>cc),t(r.exports,"namedQuery",()=>cd),t(r.exports,"AggregateField",()=>cg),t(r.exports,"AggregateQuerySnapshot",()=>cm),t(r.exports,"Bytes",()=>cp),t(r.exports,"FieldPath",()=>cy),t(r.exports,"documentId",()=>cw),t(r.exports,"FieldValue",()=>cv),t(r.exports,"GeoPoint",()=>cb),t(r.exports,"QueryConstraint",()=>cJ),t(r.exports,"query",()=>cZ),t(r.exports,"QueryCompositeFilterConstraint",()=>c2),t(r.exports,"QueryFieldFilterConstraint",()=>c0),t(r.exports,"where",()=>c1),t(r.exports,"or",()=>c5),t(r.exports,"and",()=>c6),t(r.exports,"QueryOrderByConstraint",()=>c3),t(r.exports,"orderBy",()=>c4),t(r.exports,"QueryLimitConstraint",()=>c8),t(r.exports,"limit",()=>c9),t(r.exports,"limitToLast",()=>c7),t(r.exports,"QueryStartAtConstraint",()=>de),t(r.exports,"startAt",()=>dt),t(r.exports,"startAfter",()=>dn),t(r.exports,"QueryEndAtConstraint",()=>dr),t(r.exports,"endBefore",()=>di),t(r.exports,"endAt",()=>ds),t(r.exports,"AbstractUserDataWriter",()=>dd),t(r.exports,"sum",()=>dm),t(r.exports,"average",()=>dp),t(r.exports,"count",()=>dy),t(r.exports,"aggregateFieldEqual",()=>dw),t(r.exports,"aggregateQuerySnapshotEqual",()=>dv),t(r.exports,"SnapshotMetadata",()=>db),t(r.exports,"DocumentSnapshot",()=>d_),t(r.exports,"QueryDocumentSnapshot",()=>dI),t(r.exports,"QuerySnapshot",()=>dE),t(r.exports,"snapshotEqual",()=>dx),t(r.exports,"getDoc",()=>dT),t(r.exports,"getDocFromCache",()=>dC),t(r.exports,"getDocFromServer",()=>dD),t(r.exports,"getDocs",()=>dA),t(r.exports,"getDocsFromCache",()=>dN),t(r.exports,"getDocsFromServer",()=>dk),t(r.exports,"setDoc",()=>dR),t(r.exports,"executeWrite",()=>dV),t(r.exports,"updateDoc",()=>dM),t(r.exports,"deleteDoc",()=>dL),t(r.exports,"addDoc",()=>dO),t(r.exports,"onSnapshot",()=>dP),t(r.exports,"onSnapshotsInSync",()=>dF),t(r.exports,"getCountFromServer",()=>dq),t(r.exports,"getAggregateFromServer",()=>dU),t(r.exports,"persistentSingleTabManager",()=>dJ),t(r.exports,"memoryEagerGarbageCollector",()=>d$),t(r.exports,"memoryLruGarbageCollector",()=>dQ),t(r.exports,"memoryLocalCache",()=>dH),t(r.exports,"persistentLocalCache",()=>dW),t(r.exports,"persistentMultipleTabManager",()=>dZ),t(r.exports,"WriteBatch",()=>d1),t(r.exports,"Transaction",()=>d5),t(r.exports,"runTransaction",()=>d6),t(r.exports,"deleteField",()=>d3),t(r.exports,"serverTimestamp",()=>d4),t(r.exports,"arrayUnion",()=>d8),t(r.exports,"arrayRemove",()=>d9),t(r.exports,"increment",()=>d7),t(r.exports,"writeBatch",()=>fe),t(r.exports,"setIndexConfiguration",()=>ft),t(r.exports,"PersistentCacheIndexManager",()=>fr),t(r.exports,"getPersistentCacheIndexManager",()=>fi),t(r.exports,"enablePersistentCacheIndexAutoCreation",()=>fs),t(r.exports,"disablePersistentCacheIndexAutoCreation",()=>fa),t(r.exports,"deleteAllPersistentCacheIndexes",()=>fo),t(r.exports,"_TestingHooks",()=>fh);var s,a,o,l=n("8WRsO");let u=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(u(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new c;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let d=function(e){let t;return(t=u(e),h.encodeByteArray(t,!0)).replace(/\./g,"")},f=()=>{try{return function(){if("u">typeof self)return self;if("u">typeof window)return window;if(void 0!==e)return e;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&function(e){try{return h.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};function g(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return!function(){var t;let n=null==(t=f())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class p extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,y.prototype.create)}}class y{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?i.replace(w,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new p(r,a,n)}}let w=/\{\$([^}]+)}/g;function v(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(b(n)&&b(s)){if(!v(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function b(e){return null!==e&&"object"==typeof e}function _(e){return e&&e._delegate?e._delegate:e}class I{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(C=D||(D={}))[C.DEBUG=0]="DEBUG",C[C.VERBOSE=1]="VERBOSE",C[C.INFO=2]="INFO",C[C.WARN=3]="WARN",C[C.ERROR=4]="ERROR",C[C.SILENT=5]="SILENT";let E={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},x=D.INFO,T={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},S=(e,t,...n)=>{if(t<e.logLevel)return;let r=(new Date).toISOString(),i=T[t];if(!i)throw Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};var C,D,A,N=N||{},k=("u">typeof globalThis?globalThis:"u">typeof window?window:void 0!==e?e:"u">typeof self?self:{})||self;function R(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function M(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function L(e,t,n){return e.call.apply(e.bind,arguments)}function O(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function P(e,t,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:O).apply(null,arguments)}function F(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function V(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function B(){this.s=this.s,this.o=this.o}B.prototype.s=!1,B.prototype.sa=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let q=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function U(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function z(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(R(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.h=function(){this.defaultPrevented=!0};var G=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};k.addEventListener("test",e,t),k.removeEventListener("test",e,t)}catch(e){}return e}();function K(e){return/^[\s\xa0]*$/.test(e)}function $(){var e=k.navigator;return e&&(e=e.userAgent)?e:""}function Q(e){return -1!=$().indexOf(e)}function H(e){return H[" "](e),e}H[" "]=function(){};var W,Y,X=Q("Opera"),J=Q("Trident")||Q("MSIE"),Z=Q("Edge"),ee=Z||J,et=Q("Gecko")&&!(-1!=$().toLowerCase().indexOf("webkit")&&!Q("Edge"))&&!(Q("Trident")||Q("MSIE"))&&!Q("Edge"),en=-1!=$().toLowerCase().indexOf("webkit")&&!Q("Edge");function er(){var e=k.document;return e?e.documentMode:void 0}e:{var ei="",es=(Y=$(),et?/rv:([^\);]+)(\)|;)/.exec(Y):Z?/Edge\/([\d\.]+)/.exec(Y):J?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Y):en?/WebKit\/(\S+)/.exec(Y):X?/(?:Version)[ \/]?(\S+)/.exec(Y):void 0);if(es&&(ei=es?es[1]:""),J){var ea=er();if(null!=ea&&ea>parseFloat(ei)){W=String(ea);break e}}W=ei}var eo=k.document&&J&&(er()||parseInt(W,10))||void 0;function el(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(et){e:{try{H(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:eu[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&el.$.h.call(this)}}V(el,j);var eu={2:"touch",3:"pen",4:"mouse"};el.prototype.h=function(){el.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var eh="closure_listenable_"+(1e6*Math.random()|0),ec=0;function ed(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++ec,this.fa=this.ia=!1}function ef(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function eg(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function em(e){let t={};for(let n in e)t[n]=e[n];return t}let ep="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ey(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<ep.length;t++)n=ep[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ew(e){this.src=e,this.g={},this.h=0}function ev(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=q(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ef(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function eb(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}ew.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=eb(e,t,r,i);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new ed(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var e_="closure_lm_"+(1e6*Math.random()|0),eI={};function eE(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=M(i)?!!i.capture:!!i,o=eC(e);if(o||(e[e_]=o=new ew(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return eS.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)G||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(eT(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ex(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[eh])ev(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(eT(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=eC(t))?(ev(n,e),0==n.h&&(n.src=null,t[e_]=null)):ef(e)}}}function eT(e){return e in eI?eI[e]:eI[e]="on"+e}function eS(e,t){if(e.fa)e=!0;else{t=new el(t,this);var n=e.listener,r=e.la||e.src;e.ia&&ex(e),e=n.call(r,t)}return e}function eC(e){return(e=e[e_])instanceof ew?e:null}var eD="__closure_events_fn_"+(1e9*Math.random()>>>0);function eA(e){return"function"==typeof e?e:(e[eD]||(e[eD]=function(t){return e.handleEvent(t)}),e[eD])}function eN(){B.call(this),this.i=new ew(this),this.S=this,this.J=null}function ek(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var i=t;ey(t=new j(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eR(a,r,!0,t)&&i}if(i=eR(a=t.g=e,r,!0,t)&&i,i=eR(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eR(a=t.g=n[s],r,!1,t)&&i}function eR(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&ev(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}V(eN,B),eN.prototype[eh]=!0,eN.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=M(i)?!!i.capture:!!i,r=eA(r),t&&t[eh]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=eb(a=t.g[n],r,i,s))&&(ef(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=eC(t))&&(n=t.g[n.toString()],t=-1,n&&(t=eb(n,r,i,s)),(r=-1<t?n[t]:null)&&ex(r))}(this,e,t,n,r)},eN.prototype.N=function(){if(eN.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ef(n[r]);delete t.g[e],t.h--}}this.J=null},eN.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eN.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var eM=k.JSON.stringify,eL=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new eO,e=>e.reset());class eO{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let eP,eF=!1,eV=new class{constructor(){this.h=this.g=null}add(e,t){let n=eL.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},eB=()=>{let e=k.Promise.resolve(void 0);eP=()=>{e.then(eq)}};var eq=()=>{let e;for(var t;e=null,eV.g&&(e=eV.g,eV.g=eV.g.next,eV.g||(eV.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){k.setTimeout(()=>{throw e},0)}(e)}eL.j(t),100>eL.h&&(eL.h++,t.next=eL.g,eL.g=t)}eF=!1};function eU(e,t){eN.call(this),this.h=e||1,this.g=t||k,this.j=P(this.qb,this),this.l=Date.now()}function ez(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function ej(e,t,n){if("function"==typeof e)n&&(e=P(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=P(e.handleEvent,e)}return 0x7fffffff<Number(t)?-1:k.setTimeout(e,t||0)}V(eU,eN),(A=eU.prototype).ga=!1,A.T=null,A.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ek(this,"tick"),this.ga&&(ez(this),this.start()))}},A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},A.N=function(){eU.$.N.call(this),ez(this),delete this.g};class eG extends B{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ej(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eK(e){B.call(this),this.h=e,this.g={}}V(eK,B);var e$=[];function eQ(e,t,n,r){Array.isArray(n)||(n&&(e$[0]=n.toString()),n=e$);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eA(r),t&&t[eh]?t.P(n,r,M(i)?!!i.capture:!!i,s):eE(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eA(r),t&&t[eh]?t.O(n,r,M(i)?!!i.capture:!!i,s):eE(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eH(e){eg(e.g,function(e,t){this.g.hasOwnProperty(t)&&ex(e)},e),e.g={}}function eW(){this.g=!0}function eY(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eM(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eK.prototype.N=function(){eK.$.N.call(this),eH(this)},eK.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eW.prototype.Ea=function(){this.g=!1},eW.prototype.info=function(){};var eX={},eJ=null;function eZ(){return eJ=eJ||new eN}function e0(e){j.call(this,eX.Ta,e)}function e1(e){let t=eZ();ek(t,new e0(t))}function e2(e,t){j.call(this,eX.STAT_EVENT,e),this.stat=t}function e5(e){let t=eZ();ek(t,new e2(t,e))}function e6(e,t){j.call(this,eX.Ua,e),this.size=t}function e3(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){e()},t)}eX.Ta="serverreachability",V(e0,j),eX.STAT_EVENT="statevent",V(e2,j),eX.Ua="timingevent",V(e6,j);var e4={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},e8={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function e9(){}function e7(e){return e.h||(e.h=e.i())}function te(){}e9.prototype.h=null;var tt,tn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function tr(){j.call(this,"d")}function ti(){j.call(this,"c")}function ts(){}function ta(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eK(this),this.P=tl,e=ee?125:void 0,this.V=new eU(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new to}function to(){this.i=null,this.g="",this.h=!1}V(tr,j),V(ti,j),V(ts,e9),ts.prototype.g=function(){return new XMLHttpRequest},ts.prototype.i=function(){return{}},tt=new ts;var tl=45e3,tu={},th={};function tc(e,t,n){e.L=1,e.A=tA(tx(t)),e.u=n,e.S=!0,td(e,null)}function td(e,t){e.G=Date.now(),tm(e),e.B=tx(e.A);var n,r,i,s,a,o,l=e.B,u=e.W;Array.isArray(u)||(u=[String(u)]),tz(l.i,"t",u),e.o=0,l=e.l.J,e.h=new to,e.g=nA(e.l,l?t:null,!e.u),0<e.O&&(e.M=new eG(P(e.Pa,e,e.g),e.O)),eQ(e.U,e.g,"readystatechange",e.nb),t=e.I?em(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),e1(),n=e.j,r=e.v,i=e.B,s=e.m,a=e.W,o=e.u,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function tf(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function tg(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if((r=function(e,t){var n=e.o,r=t.indexOf("\n",n);return -1==r?th:isNaN(n=Number(t.substring(n,r)))?tu:(r+=1)+n>t.length?th:(t=t.slice(r,r+n),e.o=r+n,t)}(e,n))==th){4==t&&(e.s=4,e5(14),i=!1),eY(e.j,e.m,null,"[Incomplete Response]");break}if(r==tu){e.s=4,e5(15),eY(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}eY(e.j,e.m,r,null),tb(e,r)}tf(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,e5(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),n_(t),t.M=!0,e5(11))):(eY(e.j,e.m,n,"[Invalid Chunked Response]"),tv(e),tw(e))}function tm(e){e.Y=Date.now()+e.P,tp(e,e.P)}function tp(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=e3(P(e.lb,e),t)}function ty(e){e.C&&(k.clearTimeout(e.C),e.C=null)}function tw(e){0==e.l.H||e.J||nx(e.l,e)}function tv(e){ty(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,ez(e.V),eH(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function tb(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||tH(n.i,e))){if(!e.K&&tH(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;nE(n),nf(n)}nb(n),e5(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=e3(P(n.ib,n),6e3));if(1>=tQ(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nS(n,11)}else if((e.K||n.g==e)&&nE(n),!K(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.V=o[0],o=o[1],2==n.H)if("c"==o[0]){n.K=o[1],n.pa=o[2];let t=o[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=o[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tW(s,s.h),s.h=null))}if(r.F){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tD(r.I,r.F,e))}}if(n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),(r=n).wa=nD(r,r.J?r.pa:null,r.Y),e.K){tY(r.i,e);var a=r.L;a&&e.setTimeout(a),e.C&&(ty(e),tm(e)),r.g=e}else nv(r);0<n.j.length&&nm(n)}else"stop"!=o[0]&&"close"!=o[0]||nS(n,7);else 3==n.H&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nS(n,7):nd(n):"noop"!=o[0]&&n.h&&n.h.Aa(o),n.A=0)}}e1()}catch(e){}}function t_(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(R(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("u">typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("u">typeof Set&&e instanceof Set)){if(R(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("u">typeof Map&&e instanceof Map||"u">typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(R(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(A=ta.prototype).setTimeout=function(e){this.P=e},A.nb=function(e){e=e.target;let t=this.M;t&&3==na(e)?t.l():this.Pa(e)},A.Pa=function(e){try{if(e==this.g)e:{let p=na(this.g);var t=this.g.Ia();if(this.g.da(),!(3>p)&&(3!=p||ee||this.g&&(this.h.h||this.g.ja()||no(this.g)))){this.J||4!=p||7==t||e1(),ty(this);var n=this.g.da();this.ca=n;t:if(tf(this)){var r=no(this.g);e="";var i=r.length,s=4==na(this.g);if(!this.h.i){if("u"<typeof TextDecoder){tv(this),tw(this);var a="";break t}this.h.i=new k.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,o=this.j,l=this.v,u=this.B,h=this.m,c=this.W,d=n,o.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+c+"]: "+l+"\n"+u+"\n"+p+" "+d}),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l,u,h,c,d,f,g=this.g;if((f=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(f)){var m=f;break t}}m=null}if(!(n=m)){this.i=!1,this.s=3,e5(12),tv(this),tw(this);break e}eY(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tb(this,n)}this.S?(tg(this,p,a),ee&&this.i&&3==p&&(eQ(this.U,this.V,"tick",this.mb),this.V.start())):(eY(this.j,this.m,a,null),tb(this,a)),4==p&&tv(this),this.i&&!this.J&&(4==p?nx(this.l,this):(this.i=!1,tm(this)))}else(function(e){let t={};e=(e.g&&2<=na(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(K(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,e5(12)):(this.s=0,e5(13)),tv(this),tw(this)}}}catch(e){}},A.mb=function(){if(this.g){var e=na(this.g),t=this.g.ja();this.o<t.length&&(ty(this),tg(this,e,t),this.i&&4!=e&&tm(this))}},A.cancel=function(){this.J=!0,tv(this)},A.lb=function(){var e,t;this.C=null;let n=Date.now();0<=n-this.Y?(e=this.j,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(e1(),e5(17)),tv(this),this.s=2,tw(this)):tp(this,this.Y-n)};var tI=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tE(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tE){this.h=e.h,tT(this,e.j),this.s=e.s,this.g=e.g,tS(this,e.m),this.l=e.l;var t=e.i,n=new tV;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tC(this,n),this.o=e.o}else e&&(t=String(e).match(tI))?(this.h=!1,tT(this,t[1]||"",!0),this.s=tN(t[2]||""),this.g=tN(t[3]||"",!0),tS(this,t[4]),this.l=tN(t[5]||"",!0),tC(this,t[6]||"",!0),this.o=tN(t[7]||"")):(this.h=!1,this.i=new tV(null,this.h))}function tx(e){return new tE(e)}function tT(e,t,n){e.j=n?tN(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tS(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tC(e,t,n){var r,i;t instanceof tV?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tB(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tq(this,t),tz(this,n,e))},r)),r.j=i):(n||(t=tk(t,tP)),e.i=new tV(t,e.h))}function tD(e,t,n){e.i.set(t,n)}function tA(e){return tD(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tN(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tk(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tR),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tR(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tE.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tk(t,tM,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tk(t,tM,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tk(n,"/"==n.charAt(0)?tO:tL,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tk(n,tF)),e.join("")};var tM=/[#\/\?@]/g,tL=/[#\?:]/g,tO=/[#\?]/g,tP=/[#\?@]/g,tF=/#/g;function tV(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tB(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tq(e,t){tB(e),t=tj(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tU(e,t){return tB(e),t=tj(e,t),e.g.has(t)}function tz(e,t,n){tq(e,t),0<n.length&&(e.i=null,e.g.set(tj(e,t),U(n)),e.h+=n.length)}function tj(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tG(e){this.l=e||tK,e=k.PerformanceNavigationTiming?0<(e=k.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(A=tV.prototype).add=function(e,t){tB(this),this.i=null,e=tj(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},A.forEach=function(e,t){tB(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},A.ta=function(){tB(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},A.Z=function(e){tB(this);let t=[];if("string"==typeof e)tU(this,e)&&(t=t.concat(this.g.get(tj(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},A.set=function(e,t){return tB(this),this.i=null,tU(this,e=tj(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},A.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var tK=10;function t$(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tQ(e){return e.h?1:e.g?e.g.size:0}function tH(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tW(e,t){e.g?e.g.add(t):e.h=t}function tY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tX(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return U(e.i)}function tJ(){this.g=new class{stringify(e){return k.JSON.stringify(e,void 0)}parse(e){return k.JSON.parse(e,void 0)}}}function tZ(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function t0(e){this.l=e.ec||null,this.j=e.ob||!1}function t1(e,t){eN.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=t2,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tG.prototype.cancel=function(){if(this.i=tX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}},V(t0,e9),t0.prototype.g=function(){return new t1(this.l,this.j)},t0.prototype.i=(s={},function(){return s}),V(t1,eN);var t2=0;function t5(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function t6(e){e.readyState=4,e.l=null,e.j=null,e.A=null,t3(e)}function t3(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(A=t1.prototype).open=function(e,t){if(this.readyState!=t2)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,t3(this)},A.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||k).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,t6(this)),this.readyState=t2},A.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t3(this)),this.g&&(this.readyState=3,t3(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==k.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;t5(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},A.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?t6(this):t3(this),3==this.readyState&&t5(this)}},A.Za=function(e){this.g&&(this.response=this.responseText=e,t6(this))},A.Ya=function(e){this.g&&(this.response=e,t6(this))},A.ka=function(){this.g&&t6(this)},A.setRequestHeader=function(e,t){this.v.append(e,t)},A.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},A.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(t1.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var t4=k.JSON.parse;function t8(e){eN.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=t9,this.L=this.M=!1}V(t8,eN);var t9="",t7=/^https?$/i,ne=["POST","PUT"];function nt(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,nn(e),ni(e)}function nn(e){e.F||(e.F=!0,ek(e,"complete"),ek(e,"error"))}function nr(e){if(e.h&&void 0!==N&&(!e.C[1]||4!=na(e)||2!=e.da())){if(e.v&&4==na(e))ej(e.La,0,e);else if(ek(e,"readystatechange"),4==na(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.I).match(tI)[1]||null;!i&&k.self&&k.self.location&&(i=k.self.location.protocol.slice(0,-1)),n=!t7.test(i?i.toLowerCase():"")}t=n}if(t)ek(e,"complete"),ek(e,"success");else{e.m=6;try{var s=2<na(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",nn(e)}}finally{ni(e)}}}}function ni(e,t){if(e.g){ns(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||ek(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ns(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(k.clearTimeout(e.A),e.A=null)}function na(e){return e.g?e.g.readyState:0}function no(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case t9:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function nl(e){let t="";return eg(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function nu(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=nl(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tD(e,t,n))}function nh(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nc(e){this.Ga=0,this.j=[],this.l=new eW,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=nh("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=nh("baseRetryDelayMs",5e3,e),this.hb=nh("retryDelaySeedMs",1e4,e),this.eb=nh("forwardChannelMaxRetries",2,e),this.xa=nh("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tG(e&&e.concurrentRequestLimit),this.Ja=new tJ,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function nd(e){if(ng(e),3==e.H){var t=e.W++,n=tx(e.I);if(tD(n,"SID",e.K),tD(n,"RID",t),tD(n,"TYPE","terminate"),ny(e,n),(t=new ta(e,e.l,t)).L=2,t.A=tA(tx(n)),n=!1,k.navigator&&k.navigator.sendBeacon)try{n=k.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&k.Image&&((new Image).src=t.A,n=!0),n||(t.g=nA(t.l,null),t.g.ha(t.A)),t.G=Date.now(),tm(t)}nC(e)}function nf(e){e.g&&(n_(e),e.g.cancel(),e.g=null)}function ng(e){nf(e),e.u&&(k.clearTimeout(e.u),e.u=null),nE(e),e.i.cancel(),e.m&&("number"==typeof e.m&&k.clearTimeout(e.m),e.m=null)}function nm(e){if(!t$(e.i)&&!e.m){e.m=!0;var t=e.Na;eP||eB(),eF||(eP(),eF=!0),eV.add(t,e),e.C=0}}function np(e,t){var n;n=t?t.m:e.W++;let r=tx(e.I);tD(r,"SID",e.K),tD(r,"RID",n),tD(r,"AID",e.V),ny(e,r),e.o&&e.s&&nu(r,e.o,e.s),n=new ta(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=nw(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),tW(e.i,n),tc(n,r,t)}function ny(e,t){e.na&&eg(e.na,function(e,n){tD(t,n,e)}),e.h&&t_({},function(e,n){tD(t,n,e)})}function nw(e,t,n){n=Math.min(e.j.length,n);var r=e.h?P(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{t_(e,function(e,n){let i=e;M(e)&&(i=eM(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.F=e=e.j.splice(0,n),r}function nv(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eP||eB(),eF||(eP(),eF=!0),eV.add(t,e),e.A=0}}function nb(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=e3(P(e.Ma,e),nT(e,e.A)),e.A++,!0)}function n_(e){null!=e.B&&(k.clearTimeout(e.B),e.B=null)}function nI(e){e.g=new ta(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tx(e.wa);tD(t,"RID","rpc"),tD(t,"SID",e.K),tD(t,"AID",e.V),tD(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tD(t,"TO",e.qa),tD(t,"TYPE","xmlhttp"),ny(e,t),e.o&&e.s&&nu(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=tA(tx(t)),n.u=null,n.S=!0,td(n,e)}function nE(e){null!=e.v&&(k.clearTimeout(e.v),e.v=null)}function nx(e,t){var n,r=null;if(e.g==t){nE(e),n_(e),e.g=null;var i=2}else{if(!tH(e.i,t))return;r=t.F,tY(e.i,t),i=1}if(0!=e.H){if(t.i)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.G;var s=e.C;ek(i=eZ(),new e6(i,r)),nm(e)}else nv(e);else if(3==(s=t.s)||0==s&&0<t.ca||!(1==i&&(n=t,!(tQ(e.i)>=e.i.j-!!e.m||(e.m?(e.j=n.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=e3(P(e.Na,e,n),nT(e,e.C)),e.C++,0))))||2==i&&nb(e)))switch(r&&0<r.length&&((t=e.i).i=t.i.concat(r)),s){case 1:nS(e,5);break;case 4:nS(e,10);break;case 3:nS(e,6);break;default:nS(e,2)}}}function nT(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nS(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=P(e.pb,e);n||(n=new tE("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||tT(n,"https"),tA(n)),function(e,t){let n=new eW;if(k.Image){let r=new Image;r.onload=F(tZ,n,r,"TestLoadImage: loaded",!0,t),r.onerror=F(tZ,n,r,"TestLoadImage: error",!1,t),r.onabort=F(tZ,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=F(tZ,n,r,"TestLoadImage: timeout",!1,t),k.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else e5(2);e.H=0,e.h&&e.h.za(t),nC(e),ng(e)}function nC(e){if(e.H=0,e.ma=[],e.h){let t=tX(e.i);0==t.length&&0==e.j.length||(z(e.ma,t),z(e.ma,e.j),e.i.i.length=0,U(e.j),e.j.length=0),e.h.ya()}}function nD(e,t,n){var r=n instanceof tE?tx(n):new tE(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tS(r,r.m);else{var i=k.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tE(null);r&&tT(s,r),t&&(s.g=t),i&&tS(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tD(r,n,t),tD(r,"VER",e.ra),ny(e,r),r}function nA(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new t8(e.Ha&&!e.va?new t0({ob:n}):e.va)).Oa(e.J),t}function nN(){}function nk(){if(J&&!(10<=Number(eo)))throw Error("Environmental error: no available transport.")}function nR(e,t){eN.call(this),this.g=new nc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!K(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!K(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nO(this)}function nM(e){tr.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nL(){ti.call(this),this.status=1}function nO(e){this.g=e}function nP(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nF(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(a<<7|a>>>25))+((a=s+(i^t&(n^i))+r[1]+0xe8c7b756|0)<<12|a>>>20))+((a=i+(n^s&(t^n))+r[2]+0x242070db|0)<<17|a>>>15))+((a=n+(t^i&(s^t))+r[3]+0xc1bdceee|0)<<22|a>>>10))+((a=t+(s^n&(i^s))+r[4]+0xf57c0faf|0)<<7|a>>>25))+((a=s+(i^t&(n^i))+r[5]+0x4787c62a|0)<<12|a>>>20))+((a=i+(n^s&(t^n))+r[6]+0xa8304613|0)<<17|a>>>15))+((a=n+(t^i&(s^t))+r[7]+0xfd469501|0)<<22|a>>>10))+((a=t+(s^n&(i^s))+r[8]+0x698098d8|0)<<7|a>>>25))+((a=s+(i^t&(n^i))+r[9]+0x8b44f7af|0)<<12|a>>>20))+((a=i+(n^s&(t^n))+r[10]+0xffff5bb1|0)<<17|a>>>15))+((a=n+(t^i&(s^t))+r[11]+0x895cd7be|0)<<22|a>>>10))+((a=t+(s^n&(i^s))+r[12]+0x6b901122|0)<<7|a>>>25))+((a=s+(i^t&(n^i))+r[13]+0xfd987193|0)<<12|a>>>20))+((a=i+(n^s&(t^n))+r[14]+0xa679438e|0)<<17|a>>>15))+((a=n+(t^i&(s^t))+r[15]+0x49b40821|0)<<22|a>>>10))+((a=t+(i^s&(n^i))+r[1]+0xf61e2562|0)<<5|a>>>27))+((a=s+(n^i&(t^n))+r[6]+0xc040b340|0)<<9|a>>>23))+((a=i+(t^n&(s^t))+r[11]+0x265e5a51|0)<<14|a>>>18))+((a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0)<<20|a>>>12))+((a=t+(i^s&(n^i))+r[5]+0xd62f105d|0)<<5|a>>>27))+((a=s+(n^i&(t^n))+r[10]+0x2441453|0)<<9|a>>>23))+((a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0)<<14|a>>>18))+((a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0)<<20|a>>>12))+((a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0)<<5|a>>>27))+((a=s+(n^i&(t^n))+r[14]+0xc33707d6|0)<<9|a>>>23))+((a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0)<<14|a>>>18))+((a=n+(s^t&(i^s))+r[8]+0x455a14ed|0)<<20|a>>>12))+((a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0)<<5|a>>>27))+((a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0)<<9|a>>>23))+((a=i+(t^n&(s^t))+r[7]+0x676f02d9|0)<<14|a>>>18))+((a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0)<<20|a>>>12))+((a=t+(n^i^s)+r[5]+0xfffa3942|0)<<4|a>>>28))+((a=s+(t^n^i)+r[8]+0x8771f681|0)<<11|a>>>21))+((a=i+(s^t^n)+r[11]+0x6d9d6122|0)<<16|a>>>16))+((a=n+(i^s^t)+r[14]+0xfde5380c|0)<<23|a>>>9))+((a=t+(n^i^s)+r[1]+0xa4beea44|0)<<4|a>>>28))+((a=s+(t^n^i)+r[4]+0x4bdecfa9|0)<<11|a>>>21))+((a=i+(s^t^n)+r[7]+0xf6bb4b60|0)<<16|a>>>16))+((a=n+(i^s^t)+r[10]+0xbebfbc70|0)<<23|a>>>9))+((a=t+(n^i^s)+r[13]+0x289b7ec6|0)<<4|a>>>28))+((a=s+(t^n^i)+r[0]+0xeaa127fa|0)<<11|a>>>21))+((a=i+(s^t^n)+r[3]+0xd4ef3085|0)<<16|a>>>16))+((a=n+(i^s^t)+r[6]+0x4881d05|0)<<23|a>>>9))+((a=t+(n^i^s)+r[9]+0xd9d4d039|0)<<4|a>>>28))+((a=s+(t^n^i)+r[12]+0xe6db99e5|0)<<11|a>>>21))+((a=i+(s^t^n)+r[15]+0x1fa27cf8|0)<<16|a>>>16))+((a=n+(i^s^t)+r[2]+0xc4ac5665|0)<<23|a>>>9))+((a=t+(i^(n|~s))+r[0]+0xf4292244|0)<<6|a>>>26))+((a=s+(n^(t|~i))+r[7]+0x432aff97|0)<<10|a>>>22))+((a=i+(t^(s|~n))+r[14]+0xab9423a7|0)<<15|a>>>17))+((a=n+(s^(i|~t))+r[5]+0xfc93a039|0)<<21|a>>>11))+((a=t+(i^(n|~s))+r[12]+0x655b59c3|0)<<6|a>>>26))+((a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0)<<10|a>>>22))+((a=i+(t^(s|~n))+r[10]+0xffeff47d|0)<<15|a>>>17))+((a=n+(s^(i|~t))+r[1]+0x85845dd1|0)<<21|a>>>11))+((a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0)<<6|a>>>26))+((a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0)<<10|a>>>22))+((a=i+(t^(s|~n))+r[6]+0xa3014314|0)<<15|a>>>17))+((a=n+(s^(i|~t))+r[13]+0x4e0811a1|0)<<21|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+0xf7537e82|0)<<6|a>>>26))+((a=s+(n^(t|~i))+r[11]+0xbd3af235|0)<<10|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0)<<15|a>>>17))|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function nV(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(A=t8.prototype).Oa=function(e){this.M=e},A.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():tt.g(),this.C=this.u?e7(this.u):e7(tt),this.g.onreadystatechange=P(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void nt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(let e of r.keys())n.set(e,r.get(e))}for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=k.FormData&&e instanceof k.FormData,!(0<=q(ne,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;ns(this),0<this.B&&((this.L=(s=this.g,J&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=P(this.ua,this)):this.A=ej(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){nt(this,e)}},A.ua=function(){void 0!==N&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ek(this,"timeout"),this.abort(8))},A.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ek(this,"complete"),ek(this,"abort"),ni(this))},A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ni(this,!0)),t8.$.N.call(this)},A.La=function(){this.s||(this.G||this.v||this.l?nr(this):this.kb())},A.kb=function(){nr(this)},A.isActive=function(){return!!this.g},A.da=function(){try{return 2<na(this)?this.g.status:-1}catch(e){return -1}},A.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},A.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),t4(t)}},A.Ia=function(){return this.m},A.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(A=nc.prototype).ra=8,A.H=1,A.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new ta(this,this.l,e),s=this.s;if(this.U&&(s?ey(s=em(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=nw(this,i,t),tD(n=tx(this.I),"RID",e),tD(n,"CVER",22),this.F&&tD(n,"X-HTTP-Session-Id",this.F),ny(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(nl(s)))+"&"+t:this.o&&nu(n,this.o,s)),tW(this.i,i),this.bb&&tD(n,"TYPE","init"),this.P?(tD(n,"$req",t),tD(n,"SID","null"),i.aa=!0,tc(i,n,null)):tc(i,n,t),this.H=2}}else 3==this.H&&(e?np(this,e):0==this.j.length||t$(this.i)||np(this))},A.Ma=function(){if(this.u=null,nI(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=e3(P(this.jb,this),e)}},A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,e5(10),nf(this),nI(this))},A.ib=function(){null!=this.v&&(this.v=null,nf(this),nb(this),e5(19))},A.pb=function(e){e?(this.l.info("Successfully pinged google.com"),e5(2)):(this.l.info("Failed to ping google.com"),e5(1))},A.isActive=function(){return!!this.h&&this.h.isActive(this)},(A=nN.prototype).Ba=function(){},A.Aa=function(){},A.za=function(){},A.ya=function(){},A.isActive=function(){return!0},A.Va=function(){},nk.prototype.g=function(e,t){return new nR(e,t)},V(nR,eN),nR.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;e5(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=nD(e,null,e.Y),nm(e)},nR.prototype.close=function(){nd(this.g)},nR.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eM(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&nm(t)},nR.prototype.N=function(){this.g.h=null,delete this.j,nd(this.g),delete this.g,nR.$.N.call(this)},V(nM,tr),V(nL,ti),V(nO,nN),nO.prototype.Ba=function(){ek(this.g,"a")},nO.prototype.Aa=function(e){ek(this.g,new nM(e))},nO.prototype.za=function(e){ek(this.g,new nL)},nO.prototype.ya=function(){ek(this.g,"b")},V(nP,function(){this.blockSize=-1}),nP.prototype.reset=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.i=this.h=0},nP.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nF(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nF(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nF(this,r),i=0;break}}this.h=i,this.i+=t},nP.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nB={};function nq(e){var t;return -128<=e&&128>e?(t=function(e){return new nV([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(nB,e)?nB[e]:nB[e]=t(e)):new nV([0|e],0>e?-1:0)}function nU(e){if(isNaN(e)||!isFinite(e))return nj;if(0>e)return nH(nU(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=nz;return new nV(t,0)}var nz=0x100000000,nj=nq(0),nG=nq(1),nK=nq(0x1000000);function n$(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function nQ(e){return -1==e.h}function nH(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nV(n,~e.h).add(nG)}function nW(e,t){return e.add(nH(t))}function nY(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function nX(e,t){this.g=e,this.h=t}function nJ(e,t){if(n$(t))throw Error("division by zero");if(n$(e))return new nX(nj,nj);if(nQ(e))return t=nJ(nH(e),t),new nX(nH(t.g),nH(t.h));if(nQ(t))return t=nJ(e,nH(t)),new nX(nH(t.g),t.h);if(30<e.g.length){if(nQ(e)||nQ(t))throw Error("slowDivide_ only works with positive integers.");for(var n=nG,r=t;0>=r.X(e);)n=nZ(n),r=nZ(r);var i=n0(n,1),s=n0(r,1);for(r=n0(r,2),n=n0(n,2);!n$(r);){var a=s.add(r);0>=a.X(e)&&(i=i.add(n),s=a),r=n0(r,1),n=n0(n,1)}return t=nW(e,i.R(t)),new nX(i,t)}for(i=nj;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=nU(n)).R(t);nQ(a)||0<a.X(e);)a=(s=nU(n-=r)).R(t);n$(s)&&(s=nG),i=i.add(s),e=nW(e,a)}return new nX(i,e)}function nZ(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nV(n,e.h)}function n0(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nV(i,e.h)}(A=nV.prototype).ea=function(){if(nQ(this))return-nH(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:nz+r)*t,t*=nz}return e},A.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(n$(this))return"0";if(nQ(this))return"-"+nH(this).toString(e);for(var t=nU(Math.pow(e,6)),n=this,r="";;){var i=nJ(n,t).g,s=((0<(n=nW(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(n$(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},A.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},A.X=function(e){return nQ(e=nW(this,e))?-1:+!n$(e)},A.abs=function(){return nQ(this)?nH(this):this},A.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new nV(n,-0x80000000&n[n.length-1]?-1:0)},A.R=function(e){if(n$(this)||n$(e))return nj;if(nQ(this))return nQ(e)?nH(this).R(nH(e)):nH(nH(this).R(e));if(nQ(e))return nH(this.R(nH(e)));if(0>this.X(nK)&&0>e.X(nK))return nU(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=a*l,nY(n,2*r+2*i),n[2*r+2*i+1]+=s*l,nY(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,nY(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,nY(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nV(n,0)},A.gb=function(e){return nJ(this,e).h},A.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nV(n,this.h&e.h)},A.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nV(n,this.h|e.h)},A.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nV(n,this.h^e.h)},nk.prototype.createWebChannel=nk.prototype.g,nR.prototype.send=nR.prototype.u,nR.prototype.open=nR.prototype.m,nR.prototype.close=nR.prototype.close,e4.NO_ERROR=0,e4.TIMEOUT=8,e4.HTTP_ERROR=6,e8.COMPLETE="complete",te.EventType=tn,tn.OPEN="a",tn.CLOSE="b",tn.ERROR="c",tn.MESSAGE="d",eN.prototype.listen=eN.prototype.O,t8.prototype.listenOnce=t8.prototype.P,t8.prototype.getLastError=t8.prototype.Sa,t8.prototype.getLastErrorCode=t8.prototype.Ia,t8.prototype.getStatus=t8.prototype.da,t8.prototype.getResponseJson=t8.prototype.Wa,t8.prototype.getResponseText=t8.prototype.ja,t8.prototype.send=t8.prototype.ha,t8.prototype.setWithCredentials=t8.prototype.Oa,nP.prototype.digest=nP.prototype.l,nP.prototype.reset=nP.prototype.reset,nP.prototype.update=nP.prototype.j,nV.prototype.add=nV.prototype.add,nV.prototype.multiply=nV.prototype.R,nV.prototype.modulo=nV.prototype.gb,nV.prototype.compare=nV.prototype.X,nV.prototype.toNumber=nV.prototype.ea,nV.prototype.toString=nV.prototype.toString,nV.prototype.getBits=nV.prototype.D,nV.fromNumber=nU,nV.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return nH(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=nU(Math.pow(n,8)),i=nj,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=nU(Math.pow(n,a)),i=i.R(a).add(nU(o))):i=(i=i.R(r)).add(nU(o))}return i};let n1="@firebase/firestore";class n2{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n2.UNAUTHENTICATED=new n2(null),n2.GOOGLE_CREDENTIALS=new n2("google-credentials-uid"),n2.FIRST_PARTY=new n2("first-party-uid"),n2.MOCK_USER=new n2("mock-user");let n5="10.8.0",n6=new class{constructor(e){this.name=e,this._logLevel=x,this._logHandler=S,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?E[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...e),this._logHandler(this,D.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...e),this._logHandler(this,D.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,D.INFO,...e),this._logHandler(this,D.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,D.WARN,...e),this._logHandler(this,D.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...e),this._logHandler(this,D.ERROR,...e)}}("@firebase/firestore");function n3(){return n6.logLevel}function n4(e){n6.setLogLevel(e)}function n8(e,...t){if(n6.logLevel<=D.DEBUG){let n=t.map(re);n6.debug(`Firestore (${n5}): ${e}`,...n)}}function n9(e,...t){if(n6.logLevel<=D.ERROR){let n=t.map(re);n6.error(`Firestore (${n5}): ${e}`,...n)}}function n7(e,...t){if(n6.logLevel<=D.WARN){let n=t.map(re);n6.warn(`Firestore (${n5}): ${e}`,...n)}}function re(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function rt(e="Unexpected state"){let t=`FIRESTORE (${n5}) INTERNAL ASSERTION FAILED: `+e;throw n9(t),Error(t)}function rn(e,t){e||rt()}let rr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ri extends p{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rs{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ra{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ro{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n2.UNAUTHENTICATED))}shutdown(){}}class rl{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ru{constructor(e){this.t=e,this.currentUser=n2.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new rs;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rs,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{n8("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(n8("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rs)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n8("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||rt(),new ra(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||rt(),new n2(e)}}class rh{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=n2.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rc{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new rh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(n2.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rf{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=e=>{null!=e.error&&n8("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,n8("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{n8("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?r(e):n8("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||rt(),this.R=e.token,new rd(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class rg{getToken(){return Promise.resolve(new rd(""))}invalidateToken(){}start(e,t){}shutdown(){}}class rm{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function rp(e,t){return e<t?-1:+(e>t)}function ry(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class rw{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ri(rr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ri(rr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rw.fromMillis(Date.now())}static fromDate(e){return rw.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new rw(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rp(this.nanoseconds,e.nanoseconds):rp(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rv{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rv(e)}static min(){return new rv(new rw(0,0))}static max(){return new rv(new rw(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rb{constructor(e,t,n){void 0===t?t=0:t>e.length&&rt(),void 0===n?n=e.length-t:n>e.length-t&&rt(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rb.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rb?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:+(e.length>t.length)}}class r_ extends rb{construct(e,t,n){return new r_(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new ri(rr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new r_(t)}static emptyPath(){return new r_([])}}let rI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rE extends rb{construct(e,t,n){return new rE(e,t,n)}static isValidIdentifier(e){return rI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rE.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rE(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new ri(rr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new ri(rr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ri(rr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new ri(rr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rE(t)}static emptyPath(){return new rE([])}}class rx{constructor(e){this.path=e}static fromPath(e){return new rx(r_.fromString(e))}static fromName(e){return new rx(r_.fromString(e).popFirst(5))}static empty(){return new rx(r_.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===r_.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return r_.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rx(new r_(e.slice()))}}class rT{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rS(e){return e.fields.find(e=>2===e.kind)}function rC(e){return e.fields.filter(e=>2!==e.kind)}function rD(e,t){let n=rp(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=rE.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:rp(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return rp(e.fields.length,t.fields.length)}rT.UNKNOWN_ID=-1;class rA{constructor(e,t){this.fieldPath=e,this.kind=t}}class rN{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rN(0,rM.min())}}function rk(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rM(rv.fromTimestamp(1e9===r?new rw(n+1,0):new rw(n,r)),rx.empty(),t)}function rR(e){return new rM(e.readTime,e.key,-1)}class rM{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rM(rv.min(),rx.empty(),-1)}static max(){return new rM(rv.max(),rx.empty(),-1)}}function rL(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rx.comparator(e.documentKey,t.documentKey))?n:rp(e.largestBatchId,t.largestBatchId)}let rO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rF(e){if(e.code!==rr.FAILED_PRECONDITION||e.message!==rO)throw e;n8("LocalStore","Unexpectedly lost primary lease")}class rV{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&rt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rV((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rV?t:rV.resolve(t)}catch(e){return rV.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rV.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rV.reject(t)}static resolve(e){return new rV((t,n)=>{t(e)})}static reject(e){return new rV((t,n)=>{n(e)})}static waitFor(e){return new rV((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rV.resolve(!1);for(let n of e)t=t.next(e=>e?rV.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rV((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rV((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class rB{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new rs,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new rz(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{let n=rQ(t.target.error);this.V.reject(new rz(e,n))}}static open(e,t,n,r){try{return new rB(t,e.transaction(r,n))}catch(e){throw new rz(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(n8("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rG(this.transaction.objectStore(e))}}class rq{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===rq.S(g())&&n9("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return n8("SimpleDb","Removing database:",e),rK(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}())return!1;if(rq.C())return!0;let e=g(),t=rq.S(e),n=rq.v(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){return!1}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static v(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async O(e){return this.db||(n8("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new rz(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new ri(rr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new ri(rr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new rz(e,r))},r.onupgradeneeded=e=>{n8("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next(()=>{n8("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.O(e);let t=rB.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),rV.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(n8("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rU{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return rK(this.k.delete())}}class rz extends ri{constructor(e,t){super(rr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rj(e){return"IndexedDbTransactionError"===e.name}class rG{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(n8("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(n8("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),rK(n)}add(e){return n8("SimpleDb","ADD",this.store.name,e,e),rK(this.store.add(e))}get(e){return rK(this.store.get(e)).next(t=>(void 0===t&&(t=null),n8("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return n8("SimpleDb","DELETE",this.store.name,e),rK(this.store.delete(e))}count(){return n8("SimpleDb","COUNT",this.store.name),rK(this.store.count())}W(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new rV((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.G(e,(e,n)=>{t.push(n)}).next(()=>t)}}j(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new rV((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}H(e,t){n8("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.J=!1;let r=this.cursor(n);return this.G(r,(e,t,n)=>n.delete())}Y(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.G(r,t)}Z(e){let t=this.cursor({});return new rV((n,r)=>{t.onerror=e=>{r(rQ(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}G(e,t){let n=[];return new rV((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new rU(i),a=t(i.primaryKey,i.value,s);if(a instanceof rV){let e=a.catch(e=>(s.done(),rV.reject(e)));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}}).next(()=>rV.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rK(e){return new rV((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(rQ(e.target.error))}})}let r$=!1;function rQ(e){let t=rq.S(g());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new ri("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return r$||(r$=!0,setTimeout(()=>{throw e},0)),e}}return e}class rH{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){n8("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{n8("IndexBackfiller",`Documents written: ${await this.X.te()}`)}catch(e){rj(e)?n8("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await rF(e)}await this.ee(6e4)})}}class rW{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))}ne(e,t){let n=new Set,r=t,i=!0;return rV.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return n8("IndexBackfiller",`Processing collection: ${t}`),this.re(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ie(r,n)).next(n=>(n8("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}ie(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=rR(t);rL(r,n)>0&&(n=r)}),new rM(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rY{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}function rX(e){return null==e}function rJ(e){return 0===e&&1/e==-1/0}function rZ(e){return"number"==typeof e&&Number.isInteger(e)&&!rJ(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function r0(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}function r1(e){let t=e.length;if(t>=2||rt(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||rt(),r_.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&rt(),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:rt()}s=t+2}return new r_(r)}rY._e=-1;let r2=["userId","batchId"],r5={},r6=["prefixPath","collectionGroup","readTime","documentId"],r3=["prefixPath","collectionGroup","documentId"],r4=["collectionGroup","readTime","prefixPath","documentId"],r8=["canonicalId","targetId"],r9=["targetId","path"],r7=["path","targetId"],ie=["collectionId","parent"],it=["indexId","uid"],ir=["uid","sequenceNumber"],ii=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],is=["indexId","uid","orderedDocumentKey"],ia=["userId","collectionPath","documentId"],io=["userId","collectionPath","largestBatchId"],il=["userId","collectionGroup","largestBatchId"],iu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ih=[...iu,"documentOverlays"],ic=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],id=[...ic,"indexConfiguration","indexState","indexEntries"];class ig extends rP{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function im(e,t){return rq.M(e.ae,t)}function ip(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function iy(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function iw(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class iv{constructor(e,t){this.comparator=e,this.root=t||i_.EMPTY}insert(e,t){return new iv(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,i_.BLACK,null,null))}remove(e){return new iv(this.comparator,this.root.remove(e,this.comparator).copy(null,null,i_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ib(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ib(this.root,e,this.comparator,!1)}getReverseIterator(){return new ib(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ib(this.root,e,this.comparator,!0)}}class ib{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class i_{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:i_.RED,this.left=null!=r?r:i_.EMPTY,this.right=null!=i?i:i_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new i_(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return i_.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return i_.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw rt();let e=this.left.check();if(e!==this.right.check())throw rt();return e+ +!this.isRed()}}i_.EMPTY=null,i_.RED=!0,i_.BLACK=!1,i_.EMPTY=new class{constructor(){this.size=0}get key(){throw rt()}get value(){throw rt()}get color(){throw rt()}get left(){throw rt()}get right(){throw rt()}copy(e,t,n,r,i){return this}insert(e,t,n){return new i_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class iI{constructor(e){this.comparator=e,this.data=new iv(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iE(this.data.getIterator())}getIteratorFrom(e){return new iE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iI)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iI(this.comparator);return t.data=e,t}}class iE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ix(e){return e.hasNext()?e.getNext():void 0}class iT{constructor(e){this.fields=e,e.sort(rE.comparator)}static empty(){return new iT([])}unionWith(e){let t=new iI(rE.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new iT(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ry(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class iS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function iC(){return"u">typeof atob}class iD{constructor(e){this.binaryString=e}static fromBase64String(e){return new iD(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new iS("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new iD(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rp(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iD.EMPTY_BYTE_STRING=new iD("");let iA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iN(e){if(e||rt(),"string"==typeof e){let t=0,n=iA.exec(e);if(n||rt(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:ik(e.seconds),nanos:ik(e.nanos)}}function ik(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iR(e){return"string"==typeof e?iD.fromBase64String(e):iD.fromUint8Array(e)}function iM(e){var t,n;return"server_timestamp"===(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)}function iL(e){let t=e.mapValue.fields.__previous_value__;return iM(t)?iL(t):t}function iO(e){let t=iN(e.mapValue.fields.__local_write_time__.timestampValue);return new rw(t.seconds,t.nanos)}class iP{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class iF{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iF("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iF&&e.projectId===this.projectId&&e.database===this.database}}let iV={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},iB={nullValue:"NULL_VALUE"};function iq(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?iM(e)?4:iZ(e)?0x1fffffffffffff:10:rt()}function iU(e,t){if(e===t)return!0;let n=iq(e);if(n!==iq(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iO(e).isEqual(iO(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=iN(e.timestampValue),i=iN(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return iR(e.bytesValue).isEqual(iR(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ik(e.geoPointValue.latitude)===ik(t.geoPointValue.latitude)&&ik(e.geoPointValue.longitude)===ik(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return ik(e.integerValue)===ik(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=ik(e.doubleValue),r=ik(t.doubleValue);return n===r?rJ(n)===rJ(r):isNaN(n)&&isNaN(r)}return!1;case 9:return ry(e.arrayValue.values||[],t.arrayValue.values||[],iU);case 10:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(ip(s)!==ip(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!iU(s[e],a[e])))return!1;return!0;default:return rt()}}function iz(e,t){return void 0!==(e.values||[]).find(e=>iU(e,t))}function ij(e,t){var n,r,i,s;if(e===t)return 0;let a=iq(e),o=iq(t);if(a!==o)return rp(a,o);switch(a){case 0:case 0x1fffffffffffff:return 0;case 1:return rp(e.booleanValue,t.booleanValue);case 2:let l,u;return l=ik(e.integerValue||e.doubleValue),l<(u=ik(t.integerValue||t.doubleValue))?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1;case 3:return iG(e.timestampValue,t.timestampValue);case 4:return iG(iO(e),iO(t));case 5:return rp(e.stringValue,t.stringValue);case 6:let h,c;return n=e.bytesValue,r=t.bytesValue,h=iR(n),c=iR(r),h.compareTo(c);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rp(n[e],r[e]);if(0!==t)return t}return rp(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let d;return i=e.geoPointValue,s=t.geoPointValue,0!==(d=rp(ik(i.latitude),ik(s.latitude)))?d:rp(ik(i.longitude),ik(s.longitude));case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=ij(n[e],r[e]);if(t)return t}return rp(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===iV.mapValue&&t===iV.mapValue)return 0;if(e===iV.mapValue)return 1;if(t===iV.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rp(r[e],s[e]);if(0!==t)return t;let a=ij(n[r[e]],i[s[e]]);if(0!==a)return a}return rp(r.length,s.length)}(e.mapValue,t.mapValue);default:throw rt()}}function iG(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rp(e,t);let n=iN(e),r=iN(t),i=rp(n.seconds,r.seconds);return 0!==i?i:rp(n.nanos,r.nanos)}function iK(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=iN(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?iR(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,rx.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=iK(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${iK(e.fields[i])}`;return n+"}"}(e.mapValue):rt()}function i$(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iQ(e){return!!e&&"integerValue"in e}function iH(e){return!!e&&"arrayValue"in e}function iW(e){return!!e&&"nullValue"in e}function iY(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function iX(e){return!!e&&"mapValue"in e}function iJ(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return iy(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=iJ(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=iJ(e.arrayValue.values[n]);return t}return Object.assign({},e)}function iZ(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function i0(e,t){let n=ij(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function i1(e,t){let n=ij(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class i2{constructor(e){this.value=e}static empty(){return new i2({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!iX(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=iJ(t)}setAll(e){let t=rE.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=iJ(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());iX(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iU(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];iX(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(iy(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new i2(iJ(this.value))}}class i5{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new i5(e,0,rv.min(),rv.min(),rv.min(),i2.empty(),0)}static newFoundDocument(e,t,n,r){return new i5(e,1,t,rv.min(),n,r,0)}static newNoDocument(e,t){return new i5(e,2,t,rv.min(),rv.min(),i2.empty(),0)}static newUnknownDocument(e,t){return new i5(e,3,t,rv.min(),rv.min(),i2.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rv.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=i2.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=i2.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rv.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof i5&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i5(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class i6{constructor(e,t){this.position=e,this.inclusive=t}}function i3(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?rx.comparator(rx.fromName(a.referenceValue),n.key):ij(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function i4(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iU(e.position[n],t.position[n]))return!1;return!0}class i8{constructor(e,t="asc"){this.field=e,this.dir=t}}class i9{}class i7 extends i9{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new sa(e,t,n):"array-contains"===t?new sh(e,n):"in"===t?new sc(e,n):"not-in"===t?new sd(e,n):"array-contains-any"===t?new sf(e,n):new i7(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new so(e,n):new sl(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ij(t,this.value)):null!==t&&iq(this.value)===iq(t)&&this.matchesComparison(ij(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class se extends i9{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new se(e,t)}matches(e){return st(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function st(e){return"and"===e.op}function sn(e){return"or"===e.op}function sr(e){return si(e)&&st(e)}function si(e){for(let t of e.filters)if(t instanceof se)return!1;return!0}function ss(e,t){let n=e.filters.concat(t);return se.create(n,e.op)}class sa extends i7{constructor(e,t,n){super(e,t,n),this.key=rx.fromName(n.referenceValue)}matches(e){let t=rx.comparator(e.key,this.key);return this.matchesComparison(t)}}class so extends i7{constructor(e,t){super(e,"in",t),this.keys=su("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sl extends i7{constructor(e,t){super(e,"not-in",t),this.keys=su("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function su(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>rx.fromName(e.referenceValue))}class sh extends i7{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return iH(t)&&iz(t.arrayValue,this.value)}}class sc extends i7{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&iz(this.value.arrayValue,t)}}class sd extends i7{constructor(e,t){super(e,"not-in",t)}matches(e){if(iz(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!iz(this.value.arrayValue,t)}}class sf extends i7{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!iH(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iz(this.value.arrayValue,e))}}class sg{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ce=null}}function sm(e,t=null,n=[],r=[],i=null,s=null,a=null){return new sg(e,t,n,r,i,s,a)}function sp(e){if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof i7)return t.field.canonicalString()+t.op.toString()+iK(t.value);if(sr(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rX(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>iK(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>iK(e)).join(",")),e.ce=t}return e.ce}function sy(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof i7?n instanceof i7&&t.op===n.op&&t.field.isEqual(n.field)&&iU(t.value,n.value):t instanceof se?n instanceof se&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void rt()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!i4(e.startAt,t.startAt)&&i4(e.endAt,t.endAt)}function sw(e){return rx.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function sv(e,t){return e.filters.filter(e=>e instanceof i7&&e.field.isEqual(t))}function sb(e,t,n){let r=iB,i=!0;for(let n of sv(e,t)){let e=iB,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?iB:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?i$(iF.empty(),rx.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:rt();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=iB}0>i0({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>i0({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function s_(e,t,n){let r=iV,i=!0;for(let n of sv(e,t)){let e=iV,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?i$(iF.empty(),rx.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?iV:rt(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=iV}i1({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];i1({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class sI{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function sE(e){return new sI(e)}function sx(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sT(e){return null!==e.collectionGroup}function sS(e){if(null===e.le){let t;e.le=[];let n=new Set;for(let t of e.explicitOrderBy)e.le.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new iI(rE.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.le.push(new i8(t,r))}),n.has(rE.keyField().canonicalString())||e.le.push(new i8(rE.keyField(),r))}return e.le}function sC(e){return e.he||(e.he=sD(e,sS(e))),e.he}function sD(e,t){if("F"===e.limitType)return sm(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new i8(e.field,t)});let n=e.endAt?new i6(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new i6(e.startAt.position,e.startAt.inclusive):null;return sm(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function sA(e,t){let n=e.filters.concat([t]);return new sI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sN(e,t,n){return new sI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sk(e,t){return sy(sC(e),sC(t))&&e.limitType===t.limitType}function sR(e){return`${sp(sC(e))}|lt:${e.limitType}`}function sM(e){var t;let n;return`Query(target=${n=(t=sC(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof i7?`${t.field.canonicalString()} ${t.op} ${iK(t.value)}`:t instanceof se?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rX(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>iK(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>iK(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function sL(e,t){var n,r;let i,s,a;return t.isFoundDocument()&&(i=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(i):rx.isDocumentKey(e.path)?e.path.isEqual(i):e.path.isImmediateParentOf(i))&&function(e,t){for(let n of sS(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&!(e.startAt&&(n=e.startAt,s=i3(n,sS(e),t),n.inclusive?!(s<=0):!(s<0)))&&!(e.endAt&&(r=e.endAt,a=i3(r,sS(e),t),r.inclusive?!(a>=0):!(a>0)))}function sO(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sP(e){return(t,n)=>{let r=!1;for(let i of sS(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?rx.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?ij(i,s):rt());switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return rt()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sF{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){iy(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return iw(this.inner)}size(){return this.innerSize}}let sV=new iv(rx.comparator),sB=new iv(rx.comparator);function sq(...e){let t=sB;for(let n of e)t=t.insert(n.key,n);return t}function sU(e){let t=sB;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sz(){return new sF(e=>e.toString(),(e,t)=>e.isEqual(t))}let sj=new iv(rx.comparator),sG=new iI(rx.comparator);function sK(...e){let t=sG;for(let n of e)t=t.add(n);return t}let s$=new iI(rp);function sQ(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rJ(t)?"-0":t}}function sH(e){return{integerValue:""+e}}function sW(e,t){return rZ(t)?sH(t):sQ(e,t)}class sY{constructor(){this._=void 0}}function sX(e,t){return e instanceof s5?iQ(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sJ extends sY{}class sZ extends sY{constructor(e){super(),this.elements=e}}function s0(e,t){let n=s3(t);for(let t of e.elements)n.some(e=>iU(e,t))||n.push(t);return{arrayValue:{values:n}}}class s1 extends sY{constructor(e){super(),this.elements=e}}function s2(e,t){let n=s3(t);for(let t of e.elements)n=n.filter(e=>!iU(e,t));return{arrayValue:{values:n}}}class s5 extends sY{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function s6(e){return ik(e.integerValue||e.doubleValue)}function s3(e){return iH(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class s4{constructor(e,t){this.field=e,this.transform=t}}class s8{constructor(e,t){this.version=e,this.transformResults=t}}class s9{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new s9}static exists(e){return new s9(void 0,e)}static updateTime(e){return new s9(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s7(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ae{}function at(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new au(e.key,s9.none()):new ai(e.key,e.data,s9.none());{let n=e.data,r=i2.empty(),i=new iI(rE.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new as(e.key,r,new iT(i.toArray()),s9.none())}}function an(e,t,n,r){return e instanceof ai?function(e,t,n,r){if(!s7(e.precondition,t))return n;let i=e.value.clone(),s=al(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof as?function(e,t,n,r){if(!s7(e.precondition,t))return n;let i=al(e.fieldTransforms,r,t),s=t.data;return s.setAll(aa(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):s7(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ar(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&ry(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof sZ&&r instanceof sZ||n instanceof s1&&r instanceof s1?ry(n.elements,r.elements,iU):n instanceof s5&&r instanceof s5?iU(n.Ie,r.Ie):n instanceof sJ&&r instanceof sJ)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ai extends ae{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class as extends ae{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function aa(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ao(e,t,n){var r;let i=new Map;e.length===n.length||rt();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof sZ?s0(o,l):o instanceof s1?s2(o,l):r))}return i}function al(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof sJ?(r=t,i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&iM(r)&&(r=iL(r)),r&&(i.fields.__previous_value__=r),{mapValue:i}):e instanceof sZ?s0(e,t):e instanceof s1?s2(e,t):(a=s6(s=sX(e,t))+s6(e.Ie),iQ(s)&&iQ(e.Ie)?sH(a):sQ(e.serializer,a))}(e,s,t))}return r}class au extends ae{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ah extends ae{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ac{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof ai?(r=e.value.clone(),i=ao(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof as?function(e,t,n){if(!s7(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=ao(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(aa(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=an(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=an(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sz();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=at(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(rv.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sK())}isEqual(e){return this.batchId===e.batchId&&ry(this.mutations,e.mutations,(e,t)=>ar(e,t))&&ry(this.baseMutations,e.baseMutations,(e,t)=>ar(e,t))}}class ad{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||rt();let r=sj,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ad(e,t,n,r)}}class af{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ag{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class am{constructor(e,t){this.count=e,this.unchangedNames=t}}function ap(e){switch(e){default:return rt();case rr.CANCELLED:case rr.UNKNOWN:case rr.DEADLINE_EXCEEDED:case rr.RESOURCE_EXHAUSTED:case rr.INTERNAL:case rr.UNAVAILABLE:case rr.UNAUTHENTICATED:return!1;case rr.INVALID_ARGUMENT:case rr.NOT_FOUND:case rr.ALREADY_EXISTS:case rr.PERMISSION_DENIED:case rr.FAILED_PRECONDITION:case rr.ABORTED:case rr.OUT_OF_RANGE:case rr.UNIMPLEMENTED:case rr.DATA_LOSS:return!0}}function ay(e){if(void 0===e)return n9("GRPC error has no .code"),rr.UNKNOWN;switch(e){case a.OK:return rr.OK;case a.CANCELLED:return rr.CANCELLED;case a.UNKNOWN:return rr.UNKNOWN;case a.DEADLINE_EXCEEDED:return rr.DEADLINE_EXCEEDED;case a.RESOURCE_EXHAUSTED:return rr.RESOURCE_EXHAUSTED;case a.INTERNAL:return rr.INTERNAL;case a.UNAVAILABLE:return rr.UNAVAILABLE;case a.UNAUTHENTICATED:return rr.UNAUTHENTICATED;case a.INVALID_ARGUMENT:return rr.INVALID_ARGUMENT;case a.NOT_FOUND:return rr.NOT_FOUND;case a.ALREADY_EXISTS:return rr.ALREADY_EXISTS;case a.PERMISSION_DENIED:return rr.PERMISSION_DENIED;case a.FAILED_PRECONDITION:return rr.FAILED_PRECONDITION;case a.ABORTED:return rr.ABORTED;case a.OUT_OF_RANGE:return rr.OUT_OF_RANGE;case a.UNIMPLEMENTED:return rr.UNIMPLEMENTED;case a.DATA_LOSS:return rr.DATA_LOSS;default:return rt()}}(o=a||(a={}))[o.OK=0]="OK",o[o.CANCELLED=1]="CANCELLED",o[o.UNKNOWN=2]="UNKNOWN",o[o.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",o[o.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",o[o.NOT_FOUND=5]="NOT_FOUND",o[o.ALREADY_EXISTS=6]="ALREADY_EXISTS",o[o.PERMISSION_DENIED=7]="PERMISSION_DENIED",o[o.UNAUTHENTICATED=16]="UNAUTHENTICATED",o[o.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",o[o.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",o[o.ABORTED=10]="ABORTED",o[o.OUT_OF_RANGE=11]="OUT_OF_RANGE",o[o.UNIMPLEMENTED=12]="UNIMPLEMENTED",o[o.INTERNAL=13]="INTERNAL",o[o.UNAVAILABLE=14]="UNAVAILABLE",o[o.DATA_LOSS=15]="DATA_LOSS";let aw=null;function av(){return new TextEncoder}let ab=new nV([0xffffffff,0xffffffff],0);function a_(e){let t=av().encode(e),n=new nP;return n.update(t),new Uint8Array(n.digest())}function aI(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new nV([n,r],0),new nV([i,s],0)]}class aE{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ax(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ax(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ax(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=nV.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(nV.fromNumber(n)));return 1===r.compare(ab)&&(r=new nV([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;let[t,n]=aI(a_(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);if(!this.Ae(r))return!1}return!0}static create(e,t,n){let r=new aE(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Te)return;let[t,n]=aI(a_(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);this.Re(r)}}Re(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ax extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class aT{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,aS.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new aT(rv.min(),r,new iv(rp),sV,sK())}}class aS{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new aS(n,t,sK(),sK(),sK())}}class aC{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class aD{constructor(e,t){this.targetId=e,this.fe=t}}class aA{constructor(e,t,n=iD.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class aN{constructor(){this.ge=0,this.pe=aM(),this.ye=iD.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=sK(),t=sK(),n=sK();return this.pe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:rt()}}),new aS(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=aM()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,this.ge>=0||rt()}Be(){this.Se=!0,this.we=!0}}class ak{constructor(e){this.Le=e,this.ke=new Map,this.qe=sV,this.Qe=aR(),this.Ke=new iv(rp)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:rt()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((e,n)=>{this.je(n)&&t(n)})}Je(e){let t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){var i,s,a,o,l,u,h,c;let d=r.target;if(sw(d))if(0===n){let e=new rx(d.path);this.We(t,e,i5.newNoDocument(e,rv.min()))}else 1===n||rt();else{let r=this.Ze(t);if(r!==n){let n,d,f=this.Xe(e),g=f?this.et(f,e,r):1;0!==g&&(this.He(t),this.Ke=this.Ke.insert(t,2===g?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==aw||aw.tt((i=e.fe,s=this.Le.nt(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(d=i.unchangedNames)&&(n.bloomFilter={applied:0===g,hashCount:null!=(a=null==d?void 0:d.hashCount)?a:0,bitmapLength:null!=(u=null==(l=null==(o=null==d?void 0:d.bits)?void 0:o.bitmap)?void 0:l.length)?u:0,padding:null!=(c=null==(h=null==d?void 0:d.bits)?void 0:h.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==f?void 0:f.mightContain(e))&&t}}),n))}}}}Xe(e){let t,n,r=e.fe.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=iR(i).toUint8Array()}catch(e){if(e instanceof iS)return n7("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new aE(t,s,a)}catch(e){return n7(e instanceof ax?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Te?null:n}et(e,t,n){return 2*(t.fe.count!==n-this.rt(e,t.targetId))}rt(e,t){let n=this.Le.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)}),r}it(e){let t=new Map;this.ke.forEach((n,r)=>{let i=this.Ye(r);if(i){if(n.current&&sw(i.target)){let t=new rx(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,i5.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}});let n=sK();this.Qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.qe.forEach((t,n)=>n.setReadTime(e));let r=new aT(e,t,this.Ke,this.qe,n);return this.qe=sV,this.Qe=aR(),this.Ke=new iv(rp),r}Ue(e,t){if(!this.je(e))return;let n=2*!!this.st(e,t.key);this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;let r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new aN,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new iI(rp),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=null!==this.Ye(e);return t||n8("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new aN),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function aR(){return new iv(rx.comparator)}function aM(){return new iv(rx.comparator)}let aL={asc:"ASCENDING",desc:"DESCENDING"},aO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aP={and:"AND",or:"OR"};class aF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aV(e,t){return e.useProto3Json||rX(t)?t:{value:t}}function aB(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function aq(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aU(e){let t;return e||rt(),rv.fromTimestamp(new rw((t=iN(e)).seconds,t.nanos))}function az(e,t){return aj(e,t).canonicalString()}function aj(e,t){let n=new r_(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function aG(e){let t=r_.fromString(e);return a4(t)||rt(),t}function aK(e,t){return az(e.databaseId,t.path)}function a$(e,t){let n=aG(t);if(n.get(1)!==e.databaseId.projectId)throw new ri(rr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ri(rr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rx(aY(n))}function aQ(e,t){return az(e.databaseId,t)}function aH(e){let t=aG(e);return 4===t.length?r_.emptyPath():aY(t)}function aW(e){return new r_(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aY(e){return e.length>4&&"documents"===e.get(4)||rt(),e.popFirst(5)}function aX(e,t,n){return{name:aK(e,t),fields:n.value.mapValue.fields}}function aJ(e,t,n){let r=a$(e,t.name),i=aU(t.updateTime),s=t.createTime?aU(t.createTime):rv.min(),a=new i2({mapValue:{fields:t.fields}}),o=i5.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function aZ(e,t){var n,r;let i;if(t instanceof ai)i={update:aX(e,t.key,t.value)};else if(t instanceof au)i={delete:aK(e,t.key)};else if(t instanceof as){let n;i={update:aX(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof ah))return rt();i={verify:aK(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof sJ)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sZ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof s1)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof s5)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw rt()})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aB(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:rt()),i}function a0(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?s9.updateTime(aU(n.updateTime)):void 0!==n.exists?s9.exists(n.exists):s9.none():s9.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{var n,r;let i;return n=e,i=null,"setToServerValue"in(r=t)?("REQUEST_TIME"===r.setToServerValue||rt(),i=new sJ):"appendMissingElements"in r?i=new sZ(r.appendMissingElements.values||[]):"removeAllFromArray"in r?i=new s1(r.removeAllFromArray.values||[]):"increment"in r?i=new s5(n,r.increment):rt(),new s4(rE.fromServerFormat(r.fieldPath),i)}):[];if(t.update){t.update.name;let n=a$(e,t.update.name),s=new i2({mapValue:{fields:t.update.fields}});return t.updateMask?new as(n,s,new iT((t.updateMask.fieldPaths||[]).map(e=>rE.fromServerFormat(e))),r,i):new ai(n,s,r,i)}return t.delete?new au(a$(e,t.delete),r):t.verify?new ah(a$(e,t.verify),r):rt()}function a1(e,t){return{documents:[aQ(e,t.path)]}}function a2(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=aQ(e,i);let o=function(e){if(0!==e.length)return function e(t){let n;return t instanceof i7?function(e){if("=="===e.op){if(iY(e.value))return{unaryFilter:{field:a6(e.field),op:"IS_NAN"}};if(iW(e.value))return{unaryFilter:{field:a6(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(iY(e.value))return{unaryFilter:{field:a6(e.field),op:"IS_NOT_NAN"}};if(iW(e.value))return{unaryFilter:{field:a6(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:a6(e.field),op:aO[e.op],value:e.value}}}(t):t instanceof se?1===(n=t.getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:aP[t.op],filters:n}}:rt()}(se.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:a6(e.field),direction:aL[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=aV(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ut:s,parent:i}}function a5(e){var t,n,r;let i,s,a,o,l=aH(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){1===h||rt();let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=a3(e.unaryFilter.field);return i7.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=a3(e.unaryFilter.field);return i7.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=a3(e.unaryFilter.field);return i7.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=a3(e.unaryFilter.field);return i7.create(i,"!=",{nullValue:"NULL_VALUE"});default:return rt()}}(t):void 0!==t.fieldFilter?i7.create(a3(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return rt()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?se.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rt()}}(t.compositeFilter.op)):rt()}(u.where))instanceof se&&sr(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new i8(a3(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=rX(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(n=u.startAt).before,m=new i6(n.values||[],a));let p=null;return u.endAt&&(o=!(r=u.endAt).before,p=new i6(r.values||[],o)),new sI(l,c,f,d,g,"F",m,p)}function a6(e){return{fieldPath:e.canonicalString()}}function a3(e){return rE.fromServerFormat(e.fieldPath)}function a4(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class a8{constructor(e,t,n,r,i=rv.min(),s=rv.min(),a=iD.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new a8(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new a8(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new a8(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new a8(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class a9{constructor(e){this.ct=e}}function a7(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:oe(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:aK(i=e.ct,t.key),fields:t.data.value.mapValue.fields,updateTime:aB(i,t.version.toTimestamp()),createTime:aB(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ot(t.version)};else{if(!t.isUnknownDocument())return rt();r.unknownDocument={path:n.path.toArray(),version:ot(t.version)}}return r}function oe(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ot(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function on(e){let t=new rw(e.seconds,e.nanoseconds);return rv.fromTimestamp(t)}function or(e,t){let n=(t.baseMutations||[]).map(t=>a0(e.ct,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>a0(e.ct,t)),i=rw.fromMillis(t.localWriteTimeMs);return new ac(t.batchId,i,n,r)}function oi(e){var t;let n=on(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?on(e.lastLimboFreeSnapshotVersion):rv.min();return new a8(void 0!==e.query.documents?(1===(t=e.query).documents.length||rt(),sC(sE(aH(t.documents[0])))):sC(a5(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,iD.fromBase64String(e.resumeToken))}function os(e,t){let n,r=ot(t.snapshotVersion),i=ot(t.lastLimboFreeSnapshotVersion);n=sw(t.target)?a1(e.ct,t.target):a2(e.ct,t.target).ut;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:sp(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function oa(e){let t=a5({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sN(t,t.limit,"L"):t}function oo(e,t){return new af(t.largestBatchId,a0(e.ct,t.overlayMutation))}function ol(e,t){let n=t.path.lastSegment();return[e,r0(t.path.popLast()),n]}function ou(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:ot(r.readTime),documentKey:r0(r.documentKey.path),largestBatchId:r.largestBatchId}}class oh{getBundleMetadata(e,t){return oc(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:on(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return oc(e).put({bundleId:t.id,createTime:ot(aU(t.createTime)),version:t.version})}getNamedQuery(e,t){return od(e).get(t).next(e=>{if(e)return{name:e.name,query:oa(e.bundledQuery),readTime:on(e.readTime)}})}saveNamedQuery(e,t){return od(e).put({name:t.name,readTime:ot(aU(t.readTime)),bundledQuery:t.bundledQuery})}}function oc(e){return im(e,"bundles")}function od(e){return im(e,"namedQueries")}class of{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new of(e,t.uid||"")}getOverlay(e,t){return og(e).get(ol(this.userId,t)).next(e=>e?oo(this.serializer,e):null)}getOverlays(e,t){let n=sz();return rV.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new af(t,i);r.push(this.ht(e,s))}),rV.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(r0(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(og(e).H("collectionPathOverlayIndex",r))}),rV.waitFor(i)}getOverlaysForCollection(e,t,n){let r=sz(),i=r0(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return og(e).W("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=oo(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=sz(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return og(e).Y({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=oo(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}ht(e,t){return og(e).put(function(e,t,n){let[r,i,s]=ol(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:aZ(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function og(e){return im(e,"documentOverlays")}class om{Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(+!!e.booleanValue);else if("integerValue"in e)this.Et(t,15),t.dt(ik(e.integerValue));else if("doubleValue"in e){let n=ik(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),rJ(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(iR(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?iZ(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):rt()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};for(let e of(this.Et(t,55),Object.keys(n)))this.Rt(e,t),this.It(n[e],t)}wt(e,t){let n=e.values||[];for(let e of(this.Et(t,50),n))this.It(e,t)}gt(e,t){this.Et(t,37),rx.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function op(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}om.bt=new om;class oy{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{let e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{let e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Bt(e){let t=this.Lt(e),n=op(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){let t=this.Lt(e),n=op(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=0!=(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Ct(e){let t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ow{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class ov{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class ob{constructor(){this.Gt=new oy,this.zt=new ow(this.Gt),this.jt=new ov(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class o_{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new o_(this.indexId,this.documentKey,this.arrayValue,n)}}function oI(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=oE(e.arrayValue,t.arrayValue))||0!==(n=oE(e.directionalValue,t.directionalValue))?n:rx.comparator(e.documentKey,t.documentKey)}function oE(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class ox{constructor(e){for(let t of(this.Yt=new iI((e,t)=>rE.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[],e.filters))t.isInequality()?this.Yt=this.Yt.add(t):this.Xt.push(t)}get en(){return this.Yt.size>1}tn(e){if(e.collectionGroup===this.collectionId||rt(),this.en)return!1;let t=rS(e);if(void 0!==t&&!this.nn(t))return!1;let n=rC(e),r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){let e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new iI(rE.comparator),t=[];for(let n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new rA(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new rA(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new rA(n.field,+("asc"!==n.dir))));return new rT(rT.UNKNOWN_ID,this.collectionId,t,rN.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function oT(e){return e instanceof i7}function oS(e){return e instanceof se&&sr(e)}function oC(e){return oT(e)||oS(e)||function(e){if(e instanceof se&&sn(e)){for(let t of e.getFilters())if(!oT(t)&&!oS(t))return!1;return!0}return!1}(e)}function oD(e,t){return e instanceof i7||e instanceof se||rt(),t instanceof i7||t instanceof se||rt(),oN(e instanceof i7?t instanceof i7?se.create([e,t],"and"):oA(e,t):t instanceof i7?oA(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||rt(),st(e)&&st(t))return ss(e,t.getFilters());let n=sn(e)?e:t,r=sn(e)?t:e,i=n.filters.map(e=>oD(e,r));return se.create(i,"or")}(e,t))}function oA(e,t){if(st(t))return ss(t,e.getFilters());{let n=t.filters.map(t=>oD(e,t));return se.create(n,"or")}}function oN(e){if(e instanceof i7||e instanceof se||rt(),e instanceof i7)return e;let t=e.getFilters();if(1===t.length)return oN(t[0]);if(si(e))return e;let n=t.map(e=>oN(e)),r=[];return n.forEach(t=>{t instanceof i7?r.push(t):t instanceof se&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:se.create(r,e.op)}class ok{constructor(){this._n=new oR}addToCollectionParentIndex(e,t){return this._n.add(t),rV.resolve()}getCollectionParents(e,t){return rV.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return rV.resolve()}deleteFieldIndex(e,t){return rV.resolve()}deleteAllFieldIndexes(e){return rV.resolve()}createTargetIndexes(e,t){return rV.resolve()}getDocumentsMatchingTarget(e,t){return rV.resolve(null)}getIndexType(e,t){return rV.resolve(0)}getFieldIndexes(e,t){return rV.resolve([])}getNextCollectionGroupToUpdate(e){return rV.resolve(null)}getMinOffset(e,t){return rV.resolve(rM.min())}getMinOffsetFromCollectionGroup(e,t){return rV.resolve(rM.min())}updateCollectionGroup(e,t,n){return rV.resolve()}updateIndexEntries(e,t){return rV.resolve()}}class oR{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new iI(r_.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new iI(r_.comparator)).toArray()}}let oM=new Uint8Array(0);class oL{constructor(e,t){this.databaseId=t,this.an=new oR,this.un=new sF(e=>sp(e),(e,t)=>sy(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let i={collectionId:n,parent:r0(r)};return oO(e).put(i)}return rV.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return oO(e).W(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(r1(r.parent))}return n})}addFieldIndex(e,t){let n=oF(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=oV(e);return i.next(e=>{n.put(ou(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=oF(e),r=oV(e),i=oP(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=oF(e),n=oP(e),r=oV(e);return t.H().next(()=>n.H()).next(()=>r.H())}createTargetIndexes(e,t){return rV.forEach(this.cn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new ox(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=oP(e),r=!0,i=new Map;return rV.forEach(this.cn(t),t=>this.ln(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sK(),r=[];return rV.forEach(i,(i,s)=>{n8("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${sp(t)}`);let a=function(e,t){let n=rS(t);if(void 0===n)return null;for(let t of sv(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of rC(t))for(let t of sv(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of rC(t)){let t=0===i.kind?sb(e,i.fieldPath,e.startAt):s_(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new i6(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of rC(t)){let t=0===i.kind?s_(e,i.fieldPath,e.endAt):sb(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new i6(n,r)}(s,i),h=this.hn(i,s,l),c=this.hn(i,s,u),d=this.Pn(i,s,o),f=this.In(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return rV.forEach(f,i=>n.j(i,t.limit).next(t=>{t.forEach(t=>{let n=rx.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return rV.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof i7||t instanceof se||rt(),t instanceof i7)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=se.create(n,t.op);return oC(r=oN(r))?r:(r instanceof se||rt(),st(r)||rt(),r.filters.length>1||rt(),r.filters.reduce((e,t)=>oD(e,t)))}(function e(t){var n,r;if(t instanceof i7||t instanceof se||rt(),t instanceof i7){if(t instanceof sc){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>i7.create(t.field,"==",e)))||[];return se.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return se.create(i,t.op)}(e));return oC(t)||rt(),oT(t)||oS(t)?[t]:t.getFilters()})(se.create(e.filters,"and")).map(t=>sm(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Tn(t[h/l]):oM,c=this.En(e,o,n[h%l],r),d=this.dn(e,o,i[h%l],s),f=a.map(t=>this.En(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}En(e,t,n,r){let i=new o_(e,rx.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){let i=new o_(e,rx.empty(),t,n);return r?i.Jt():i}ln(e,t){let n=new ox(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.cn(t);return rV.forEach(r,t=>this.ln(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new iI(rE.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}An(e,t){let n=new ob;for(let r of rC(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Ht(r.kind);om.bt.Pt(e,i)}return n.Wt()}Tn(e){let t=new ob;return om.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let n,r=new ob;return om.bt.Pt(i$(this.databaseId,t),r.Ht(0===(n=rC(e)).length?0:n[n.length-1].kind)),r.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new ob);let i=0;for(let s of rC(e)){let e=n[i++];for(let n of r)if(this.Vn(t,s.fieldPath)&&iH(e))r=this.mn(r,s,e);else{let t=n.Ht(s.kind);om.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new ob;r.seed(n.Wt()),om.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find(e=>e instanceof i7&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=oF(e),r=oV(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{let t=[];return rV.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new rN(n.sequenceNumber,new rM(on(n.readTime),new rx(r1(n.documentKey)),n.largestBatchId)):rN.empty(),i=e.fields.map(([e,t])=>new rA(rE.fromServerFormat(e),t)),new rT(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rp(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=oF(e),i=oV(e);return this.gn(e).next(e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>rV.forEach(t,t=>i.put(ou(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return rV.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?rV.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),rV.forEach(i,n=>this.pn(e,t,n).next(t=>{let i=this.yn(r,n);return t.isEqual(i)?rV.resolve():this.wn(e,r,n,t,i)}))))})}Sn(e,t,n,r){return oP(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return oP(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){let r=oP(e),i=new iI(oI);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(e,r)=>{i=i.add(new o_(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}yn(e,t){let n=new iI(oI),r=this.An(t,e);if(null==r)return n;let i=rS(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iH(s))for(let i of s.arrayValue.values||[])n=n.add(new o_(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new o_(t.indexId,e.key,oM,r));return n}wn(e,t,n,r,i){n8("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=ix(s),l=ix(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=ix(a)):t?(i(o),o=ix(s)):(o=ix(s),l=ix(a))}}(r,i,oI,r=>{s.push(this.Sn(e,t,n,r))},r=>{s.push(this.bn(e,t,n,r))}),rV.waitFor(s)}gn(e){let t=1;return oV(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>oI(e,t)).filter((e,t,n)=>!t||0!==oI(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=oI(i,e),s=oI(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,oM,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,oM,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return oI(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oB)}getMinOffset(e,t){return rV.mapArray(this.cn(t),t=>this.ln(e,t).next(e=>e||rt())).next(oB)}}function oO(e){return im(e,"collectionParents")}function oP(e){return im(e,"indexEntries")}function oF(e){return im(e,"indexConfiguration")}function oV(e){return im(e,"indexState")}function oB(e){0!==e.length||rt();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>rL(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new rM(t.readTime,t.documentKey,n)}let oq={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oU{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new oU(e,oU.DEFAULT_COLLECTION_PERCENTILE,oU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function oz(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.Y({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||rt()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,r0(h),c]);s.push(i.delete(r)),u.push(e.key)}return rV.waitFor(s).next(()=>u)}function oj(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw rt();t=e.noDocument}return JSON.stringify(t).length}oU.DEFAULT_COLLECTION_PERCENTILE=10,oU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oU.DEFAULT=new oU(0x2800000,oU.DEFAULT_COLLECTION_PERCENTILE,oU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oU.DISABLED=new oU(-1,0,0);class oG{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){return""!==e.uid||rt(),new oG(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return o$(e).Y({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=oQ(e),s=o$(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;"number"==typeof a||rt();let f=new ac(a,t,n,r),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>aZ(o.ct,e)),d=f.mutations.map(e=>aZ(o.ct,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],p=new iI((e,t)=>rp(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,r0(h),a]);p=p.add(e.key.path.popLast()),m.push(s.put(g)),m.push(i.put(t,r5))}return p.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Cn[a]=f.keys()}),rV.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return o$(e).get(t).next(e=>e?(e.userId===this.userId||rt(),or(this.serializer,e)):null)}vn(e,t){return this.Cn[t]?rV.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Cn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return o$(e).Y({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||rt(),i=or(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return o$(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return o$(e).W("userMutationsIndex",t).next(e=>e.map(e=>or(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,r0(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return oQ(e).Y({range:r},(n,r,s)=>{let[a,o,l]=n,u=r1(o);if(a===this.userId&&t.path.isEqual(u))return o$(e).get(l).next(e=>{if(!e)throw rt();e.userId===this.userId||rt(),i.push(or(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iI(rp),r=[];return t.forEach(t=>{let i=[this.userId,r0(t.path)],s=IDBKeyRange.lowerBound(i),a=oQ(e).Y({range:s},(e,r,i)=>{let[s,a,o]=e,l=r1(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),rV.waitFor(r).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,r0(n)],s=IDBKeyRange.lowerBound(i),a=new iI(rp);return oQ(e).Y({range:s},(e,t,i)=>{let[s,o,l]=e,u=r1(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(o$(e).get(t).next(e=>{if(null===e)throw rt();e.userId===this.userId||rt(),n.push(or(this.serializer,e))}))}),rV.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return oz(e.ae,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),rV.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rV.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return oQ(e).Y({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=r1(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||rt()})})}containsKey(e,t){return oK(e,this.userId,t)}xn(e){return oH(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oK(e,t,n){let r=[t,r0(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return oQ(e).Y({range:s,J:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function o$(e){return im(e,"mutations")}function oQ(e){return im(e,"documentMutations")}function oH(e){return im(e,"mutationQueues")}class oW{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new oW(0)}static Bn(){return new oW(-1)}}class oY{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let n=new oW(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(e=>rv.fromTimestamp(new rw(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Ln(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Ln(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oX(e).delete(t.targetId)).next(()=>this.Ln(e)).next(t=>(t.targetCount>0||rt(),t.targetCount-=1,this.kn(e,t)))}removeTargets(e,t,n){let r=0,i=[];return oX(e).Y((s,a)=>{let o=oi(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>rV.waitFor(i)).next(()=>r)}forEachTarget(e,t){return oX(e).Y((e,n)=>{t(oi(n))})}Ln(e){return oJ(e).get("targetGlobalKey").next(e=>(null!==e||rt(),e))}kn(e,t){return oJ(e).put("targetGlobalKey",t)}qn(e,t){return oX(e).put(os(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next(e=>e.targetCount)}getTargetData(e,t){let n=sp(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return oX(e).Y({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=oi(n);sy(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=oZ(e);return t.forEach(t=>{let s=r0(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),rV.waitFor(r)}removeMatchingKeys(e,t,n){let r=oZ(e);return rV.forEach(t,t=>{let i=r0(t.path);return rV.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=oZ(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=oZ(e),i=sK();return r.Y({range:n,J:!0},(e,t,n)=>{let r=new rx(r1(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=r0(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return oZ(e).Y({index:"documentTargetsIndex",J:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}_t(e,t){return oX(e).get(t).next(e=>e?oi(e):null)}}function oX(e){return im(e,"targets")}function oJ(e){return im(e,"targetGlobal")}function oZ(e){return im(e,"targetDocuments")}function o0([e,t],[n,r]){let i=rp(e,n);return 0===i?rp(t,r):i}class o1{constructor(e){this.Kn=e,this.buffer=new iI(o0),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>o0(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class o2{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){n8("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rj(e)?n8("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rF(e)}await this.zn(3e5)})}}class o5{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rV.resolve(rY._e);let n=new o1(t);return this.jn.forEachTarget(e,e=>n.Wn(e.sequenceNumber)).next(()=>this.jn.Jn(e,e=>n.Wn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(n8("LruGarbageCollector","Garbage collection skipped; disabled"),rV.resolve(oq)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(n8("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oq):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(n8("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),n3()<=D.DEBUG&&n8("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),rV.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class o6{constructor(e,t){this.db=e,this.garbageCollector=new o5(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Zn(e){let t=0;return this.Jn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(e,n)=>t(n))}addReference(e,t,n){return o3(e,n)}removeReference(e,t,n){return o3(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return o3(e,t)}er(e,t){let n;return n=!1,oH(e).Z(r=>oK(e,r,t).next(e=>(e&&(n=!0),rV.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Xn(e,(s,a)=>{if(a<=t){let t=this.er(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,rv.min()),oZ(e).delete([0,r0(s.path)])))});r.push(t)}}).next(()=>rV.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return o3(e,t)}Xn(e,t){let n=oZ(e),r,i=rY._e;return n.Y({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==rY._e&&t(new rx(r1(r)),i),i=a,r=s):i=rY._e}).next(()=>{i!==rY._e&&t(new rx(r1(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function o3(e,t){var n;return oZ(e).put((n=e.currentSequenceNumber,{targetId:0,path:r0(t.path),sequenceNumber:n}))}class o4{constructor(){this.changes=new sF(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,i5.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rV.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class o8{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return le(e).put(n)}removeEntry(e,t,n){let r;return le(e).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],oe(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=i5.newInvalidDocument(t);return le(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(lt(t))},(e,r)=>{n=this.nr(t,r)}).next(()=>n)}rr(e,t){let n={size:0,document:i5.newInvalidDocument(t)};return le(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(lt(t))},(e,r)=>{n={document:this.nr(t,r),size:oj(r)}}).next(()=>n)}getEntries(e,t){let n=sV;return this.ir(e,t,(e,t)=>{let r=this.nr(e,t);n=n.insert(e,r)}).next(()=>n)}sr(e,t){let n=sV,r=new iv(rx.comparator);return this.ir(e,t,(e,t)=>{let i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,oj(t))}).next(()=>({documents:n,_r:r}))}ir(e,t,n){if(t.isEmpty())return rV.resolve();let r=new iI(lr);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(lt(r.first()),lt(r.last())),s=r.getIterator(),a=s.getNext();return le(e).Y({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=rx.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>lr(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.U(lt(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oe(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return le(e).W(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=sV;for(let i of e){let e=this.nr(rx.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(sL(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sV,s=ln(t,n),a=ln(t,rM.max());return le(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.nr(rx.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new o9(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return o7(e).get("remoteDocumentGlobalKey").next(e=>(e||rt(),e))}tr(e,t){return o7(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=aJ(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rx.fromSegments(t.noDocument.path),n=on(t.noDocument.readTime);r=i5.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return rt();{let e=rx.fromSegments(t.unknownDocument.path),n=on(t.unknownDocument.version);r=i5.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new rw((n=t.readTime)[0],n[1]),rv.fromTimestamp(i))),r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(rv.min()))return e}return i5.newInvalidDocument(e)}}class o9 extends o4{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new sF(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new iI((e,t)=>rp(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=a7(this.ar.serializer,s);r=r.add(i.path.popLast());let l=oj(o);n+=l-a.size,t.push(this.ar.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=a7(this.ar.serializer,s.convertToNoDocument(rv.min()));t.push(this.ar.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.ar.updateMetadata(e,n)),rV.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:e,_r:t})=>(t.forEach((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function o7(e){return im(e,"remoteDocumentGlobal")}function le(e){return im(e,"remoteDocumentsV14")}function lt(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ln(e,t){let n=t.documentKey.path.toArray();return[e,oe(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function lr(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rp(n[e],r[e]))return i;return(i=rp(n.length,r.length))||(i=rp(n[n.length-2],r[r.length-2]))||rp(n[n.length-1],r[r.length-1])}class li{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ls{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&an(n.mutation,e,iT.empty(),rw.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sK()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sK()){let r=sz();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sq();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sz();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sK()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sV,s=sz(),a=sz();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof as)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),an(a.mutation,t,a.mutation.getFieldMask(),rw.now())):s.set(t.key,iT.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new li(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=sz(),r=new iv((e,t)=>e-t),i=sK();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||iT.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sK()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=sz();l.forEach(e=>{if(!i.has(e)){let r=at(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rV.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return rx.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rV.resolve(sz()),a=-1,o=i;return s.next(t=>rV.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?rV.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sK())).next(e=>({batchId:a,changes:sU(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rx(t)).next(e=>{let t=sq();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=sq();return this.indexManager.getCollectionParents(e,i).next(a=>rV.forEach(a,a=>{let o=new sI(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,i5.newInvalidDocument(r)))});let n=sq();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&an(s.mutation,r,iT.empty(),rw.now()),sL(t,r)&&(n=n.insert(e,r))}),n})}}class la{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return rV.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:t.id,version:t.version,createTime:aU(t.createTime)}),rV.resolve()}getNamedQuery(e,t){return rV.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:t.name,query:oa(t.bundledQuery),readTime:aU(t.readTime)}),rV.resolve()}}class lo{constructor(){this.overlays=new iv(rx.comparator),this.hr=new Map}getOverlay(e,t){return rV.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sz();return rV.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),rV.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.hr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(n)),rV.resolve()}getOverlaysForCollection(e,t,n){let r=sz(),i=t.length+1,s=new rx(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rV.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new iv((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sz(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sz(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return rV.resolve(a)}ht(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new af(t,n));let i=this.hr.get(t);void 0===i&&(i=sK(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class ll{constructor(){this.Pr=new iI(lu.Ir),this.Tr=new iI(lu.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let n=new lu(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new lu(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){let t=new rx(new r_([])),n=new lu(t,e),r=new lu(t,e+1),i=[];return this.Tr.forEachInRange([n,r],e=>{this.Ar(e),i.push(e.key)}),i}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new rx(new r_([])),n=new lu(t,e),r=new lu(t,e+1),i=sK();return this.Tr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new lu(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class lu{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return rx.comparator(e.key,t.key)||rp(e.pr,t.pr)}static Er(e,t){return rp(e.pr,t.pr)||rx.comparator(e.key,t.key)}}class lh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new iI(lu.Ir)}checkEmpty(e){return rV.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ac(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.wr=this.wr.add(new lu(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rV.resolve(s)}lookupMutationBatch(e,t){return rV.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.br(t+1),r=n<0?0:n;return rV.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rV.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return rV.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new lu(t,0),r=new lu(t,1/0),i=[];return this.wr.forEachInRange([n,r],e=>{let t=this.Sr(e.pr);i.push(t)}),rV.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iI(rp);return t.forEach(e=>{let t=new lu(e,0),r=new lu(e,1/0);this.wr.forEachInRange([t,r],e=>{n=n.add(e.pr)})}),rV.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rx.isDocumentKey(i)||(i=i.child(""));let s=new lu(new rx(i),0),a=new iI(rp);return this.wr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.pr)),!0)},s),rV.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(e=>{let n=this.Sr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Cr(t.batchId,"removed")||rt(),this.mutationQueue.shift();let n=this.wr;return rV.forEach(t.mutations,r=>{let i=new lu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){let n=new lu(t,0),r=this.wr.firstAfterOrEqual(n);return rV.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rV.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lc{constructor(e){this.vr=e,this.docs=new iv(rx.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rV.resolve(n?n.document.mutableCopy():i5.newInvalidDocument(t))}getEntries(e,t){let n=sV;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():i5.newInvalidDocument(e))}),rV.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sV,s=t.path,a=new rx(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rL(rR(a),n)||(r.has(a.key)||sL(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rV.resolve(i)}getAllFromCollectionGroup(e,t,n,r){rt()}Fr(e,t){return rV.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ld(this)}getSize(e){return rV.resolve(this.size)}}class ld extends o4{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)}),rV.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class lf{constructor(e){this.persistence=e,this.Mr=new sF(e=>sp(e),sy),this.lastRemoteSnapshotVersion=rv.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ll,this.targetCount=0,this.Br=oW.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,n)=>t(n)),rV.resolve()}getLastRemoteSnapshotVersion(e){return rV.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rV.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),rV.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),rV.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Br=new oW(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,rV.resolve()}updateTargetData(e,t){return this.qn(t),rV.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,rV.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Mr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),rV.waitFor(i).next(()=>r)}getTargetCount(e){return rV.resolve(this.targetCount)}getTargetData(e,t){let n=this.Mr.get(t)||null;return rV.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),rV.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rV.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),rV.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Nr.gr(t);return rV.resolve(n)}containsKey(e,t){return rV.resolve(this.Nr.containsKey(t))}}class lg{constructor(e,t){this.Lr={},this.overlays={},this.kr=new rY(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new lf(this),this.indexManager=new ok,this.remoteDocumentCache=new lc(e=>this.referenceDelegate.Kr(e)),this.serializer=new a9(t),this.$r=new la(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lo,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new lh(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){n8("MemoryPersistence","Starting transaction:",e);let r=new lm(this.kr.next());return this.referenceDelegate.Ur(),n(r).next(e=>this.referenceDelegate.Wr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Gr(e,t){return rV.or(Object.values(this.Lr).map(n=>()=>n.containsKey(e,t)))}}class lm extends rP{constructor(e){super(),this.currentSequenceNumber=e}}class lp{constructor(e){this.persistence=e,this.zr=new ll,this.jr=null}static Hr(e){return new lp(e)}get Jr(){if(this.jr)return this.jr;throw rt()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),rV.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),rV.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),rV.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rV.forEach(this.Jr,n=>{let r=rx.fromPath(n);return this.Yr(e,r).next(e=>{e||t.removeEntry(r,rv.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return rV.or([()=>rV.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class ly{constructor(e,t){this.persistence=e,this.Zr=new sF(e=>r0(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new o5(this,t)}static Hr(e,t){return new ly(e,t)}Ur(){}Wr(e){return rV.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Hn(e){let t=this.Zn(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Zn(e){let t=0;return this.Jn(e,e=>{t++}).next(()=>t)}Jn(e,t){return rV.forEach(this.Zr,(n,r)=>this.er(e,n,r).next(e=>e?rV.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Fr(e,r=>this.er(e,r,t).next(e=>{e||(n++,i.removeEntry(r,rv.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Zr.set(t,e.currentSequenceNumber),rV.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),rV.resolve()}removeReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),rV.resolve()}updateLimboDocument(e,t){return this.Zr.set(t,e.currentSequenceNumber),rV.resolve()}Kr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(iq(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=iL(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return iR(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:var r;let i;return r=t.mapValue,i=0,iy(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw rt()}}(e.data.value)),t}er(e,t,n){return rV.or([()=>this.persistence.Gr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Zr.get(t);return rV.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class lw{constructor(e){this.serializer=e}N(e,t,n,r){let i=new rB("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore("owner"),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r2,{unique:!0}),e.createObjectStore("documentMutations"),lv(e),e.createObjectStore("remoteDocuments"));let s=rV.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),lv(e)),s=s.next(()=>{let e,t;return e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rv.min().toTimestamp(),targetCount:0},e.put("targetGlobalKey",t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").W().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r2,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return rV.waitFor(r)}))),s=s.next(()=>{e.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.Xr(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore("remoteDocumentGlobal"),this.ei(i)))),n<7&&r>=7&&(s=s.next(()=>this.ti(i))),n<8&&r>=8&&(s=s.next(()=>this.ni(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.ri(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore("bundles",{keyPath:"bundleId"}),e.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore("documentOverlays",{keyPath:ia})).createIndex("collectionPathOverlayIndex",io,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",il,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore("remoteDocumentsV14",{keyPath:r6})).createIndex("documentKeyIndex",r3),t.createIndex("collectionGroupIndex",r4)}).next(()=>this.ii(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.si(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:it}).createIndex("sequenceNumberIndex",ir,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ii}).createIndex("documentKeyIndex",is,{unique:!1})})),s}ei(e){let t=0;return e.store("remoteDocuments").Y((e,n)=>{t+=oj(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(t=>rV.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next(n=>rV.forEach(n,n=>{n.userId===t.userId||rt();let r=or(this.serializer,n);return oz(e,t.userId,r).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.Y((n,i)=>{let s=new r_(n),a=[0,r0(s)];r.push(t.get(a).next(n=>n?rV.resolve():t.put({targetId:0,path:r0(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rV.waitFor(r))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:ie});let n=t.store("collectionParents"),r=new oR,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:r0(r)})}};return t.store("remoteDocuments").Y({J:!0},(e,t)=>i(new r_(e).popLast())).next(()=>t.store("documentMutations").Y({J:!0},([e,t,n],r)=>i(r1(t).popLast())))}ri(e){let t=e.store("targets");return t.Y((e,n)=>{let r=oi(n),i=os(this.serializer,r);return t.put(i)})}ii(e,t){let n=t.store("remoteDocuments"),r=[];return n.Y((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new rx(r_.fromString(n.document.name).popFirst(5)):n.noDocument?rx.fromSegments(n.noDocument.path):n.unknownDocument?rx.fromSegments(n.unknownDocument.path):rt()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>rV.waitFor(r))}si(e,t){let n=t.store("mutations"),r=new o8(this.serializer),i=new lg(lp.Hr,this.serializer.ct);return n.W().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:sK();or(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),rV.forEach(n,(e,n)=>{let s=new n2(n),a=of.lt(this.serializer,s),o=i.getIndexManager(s);return new ls(r,oG.lt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new ig(t,rY._e),e).next()})})}}function lv(e){e.createObjectStore("targetDocuments",{keyPath:r9}).createIndex("documentTargetsIndex",r7,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",r8,{unique:!0}),e.createObjectStore("targetGlobal")}let lb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class l_{constructor(e,t,n,r,i,s,a,o,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=a,this._i=l,this.ai=u,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=-1/0,this.Ii=e=>Promise.resolve(),!l_.D())throw new ri(rr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new o6(this,r),this.Ti=t+"main",this.serializer=new a9(o),this.Ei=new rq(this.Ti,this.ui,new lw(this.serializer)),this.Qr=new oY(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new o8(this.serializer),this.$r=new oh,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&n9("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ri(rr.FAILED_PRECONDITION,lb);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new rY(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(async()=>{this.started&&await this.Ai()}))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lE(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(rj(e))return n8("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n8("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return lI(e).get("owner").next(e=>rV.resolve(this.Si(e)))}bi(e){return lE(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=im(e,"clientMetadata");return t.W().next(e=>{let n=this.vi(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return rV.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?rV.resolve(!0):lI(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new ri(rr.FAILED_PRECONDITION,lb);return!1}}return!(!this.networkEnabled||!this.inForeground)||lE(e).W().next(e=>void 0===this.vi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n8("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new ig(e,rY._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Bi()}vi(e,t){return e.filter(e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>lE(e).W().next(e=>this.vi(e,18e5).map(e=>e.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return oG.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oL(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return of.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){var r;let i;n8("IndexedDbPersistence","Starting transaction:",e);let s=15===(r=this.ui)?id:14===r||13===r?ic:12===r?ih:11===r?iu:void rt();return this.Ei.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new ig(r,this.kr?this.kr.next():rY._e),"readwrite-primary"===t?this.gi(i).next(e=>!!e||this.pi(i)).next(t=>{if(!t)throw n9(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new ri(rr.FAILED_PRECONDITION,rO);return n(i)}).next(e=>this.wi(i).next(()=>e)):this.ki(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}ki(e){return lI(e).get("owner").next(e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new ri(rr.FAILED_PRECONDITION,lb)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return lI(e).put("owner",t)}static D(){return rq.D()}yi(e){let t=lI(e);return t.get("owner").next(e=>this.Si(e)?(n8("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):rV.resolve())}Ci(e,t){let n=Date.now();return!(e<n-t||e>n&&(n9(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;m()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let n=null!==(null==(t=this.di)?void 0:t.getItem(this.Fi(e)));return n8("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return n9("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){n9("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lI(e){return im(e,"owner")}function lE(e){return im(e,"clientMetadata")}function lx(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class lT{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=sK(),r=sK();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lT(e,t.fromCache,n,r)}}class lS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lC{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=m()?8:rq.v(g())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ji(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Hi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new lS;return this.Ji(e,t,n).next(r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)})}).next(()=>i.result)}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(n3()<=D.DEBUG&&n8("QueryEngine","SDK will not create cache indexes for query:",sM(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),rV.resolve()):(n3()<=D.DEBUG&&n8("QueryEngine","Query:",sM(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(n3()<=D.DEBUG&&n8("QueryEngine","The SDK decides to create cache indexes for query:",sM(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sC(t))):rV.resolve())}ji(e,t){if(sx(t))return rV.resolve(null);let n=sC(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=sC(t=sN(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sK(...r);return this.zi.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,sN(t,null,"F")):this.es(e,s,t,n)}))})))}Hi(e,t,n,r){return sx(t)||r.isEqual(rv.min())?rV.resolve(null):this.zi.getDocuments(e,n).next(i=>{let s=this.Zi(t,i);return this.Xi(t,s,n,r)?rV.resolve(null):(n3()<=D.DEBUG&&n8("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sM(t)),this.es(e,s,t,rk(r,-1)).next(e=>e))})}Zi(e,t){let n=new iI(sP(e));return t.forEach((t,r)=>{sL(e,r)&&(n=n.add(r))}),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return n3()<=D.DEBUG&&n8("QueryEngine","Using full collection scan to execute query:",sM(t)),this.zi.getDocumentsMatchingQuery(e,t,rM.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class lD{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new iv(rp),this.rs=new sF(e=>sp(e),sy),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ls(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}async function lA(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e._s(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sK();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({us:e,removedBatchIds:i,addedBatchIds:s}))})})}function lN(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function lk(e,t,n){let r=sK(),i=sK();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sV;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rv.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):n8("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{cs:r,ls:i}})}function lR(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Qr.getTargetData(n,t).next(i=>i?(r=i,rV.resolve(r)):e.Qr.allocateTargetId(n).next(i=>(r=new a8(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.ns.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}async function lM(e,t,n){let r=e.ns.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!rj(e))throw e;n8("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.ns=e.ns.remove(t),e.rs.delete(r.target)}function lL(e,t,n){let r=rv.min(),i=sK();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=sC(t),void 0!==(o=e.rs.get(a))?rV.resolve(e.ns.get(o)):e.Qr.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Qr.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.ts.getDocumentsMatchingQuery(s,t,n?r:rv.min(),n?i:sK())).next(n=>(lF(e,sO(t),n),{documents:n,hs:i}))})}function lO(e,t){let n=e.Qr,r=e.ns.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n._t(e,t).next(e=>e?e.target:null))}function lP(e,t){let n=e.ss.get(t)||rv.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.os.getAllFromCollectionGroup(r,t,rk(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(lF(e,t,n),n))}function lF(e,t,n){let r=e.ss.get(t)||rv.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.ss.set(t,r)}async function lV(e,t,n=sK()){let r=await lR(e,sC(oa(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=aU(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.$r.saveNamedQuery(i,t);let a=r.withResumeToken(iD.EMPTY_BYTE_STRING,s);return e.ns=e.ns.insert(a.targetId,a),e.Qr.updateTargetData(i,a).next(()=>e.Qr.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Qr.addMatchingKeys(i,n,r.targetId)).next(()=>e.$r.saveNamedQuery(i,t))})}function lB(e,t){return`firestore_clients_${e}_${t}`}function lq(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function lU(e,t){return`firestore_targets_${e}_${t}`}class lz{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new ri(r.error.code,r.error.message)),s?new lz(e,t,r.state,i):(n9("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lj{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new ri(n.error.code,n.error.message)),i?new lj(e,n.state,r):(n9("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lG{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=s$;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=rZ(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lG(e,i):(n9("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lK{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lK(t.clientId,t.onlineState):(n9("SharedClientState",`Failed to parse online state: ${e}`),null)}}class l${constructor(){this.activeTargetIds=s$}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lQ{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new iv(rp),this.started=!1,this.ys=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=lB(this.persistenceKey,this.Vs),this.Ss=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.ps=this.ps.insert(this.Vs,new l$),this.bs=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Ds=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Cs=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.vs=(a=this.persistenceKey,`firestore_online_state_${a}`),this.Fs=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Li())){if(e===this.Vs)continue;let t=this.getItem(lB(this.persistenceKey,e));if(t){let n=lG.Es(e,t);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let t=this.xs(e);t&&this.Os(t)}for(let e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(lU(this.persistenceKey,e));if(n){let r=lj.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lU(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Ls(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return n8("SharedClientState","READ",e,t),t}setItem(e,t){n8("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){n8("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){if(e.storageArea===this.storage){if(n8("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void n9("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.bs.test(e.key)){if(null==e.newValue){let t=this.$s(e.key);return this.Us(t,null)}{let t=this.Ws(e.key,e.newValue);if(t)return this.Us(t.clientId,t)}}else if(this.Ds.test(e.key)){if(null!==e.newValue){let t=this.Gs(e.key,e.newValue);if(t)return this.zs(t)}}else if(this.Cs.test(e.key)){if(null!==e.newValue){let t=this.js(e.key,e.newValue);if(t)return this.Hs(t)}}else if(e.key===this.vs){if(null!==e.newValue){let t=this.xs(e.newValue);if(t)return this.Os(t)}}else if(e.key===this.Ss){let t=function(e){let t=rY._e;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||rt(),t=n}catch(e){n9("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rY._e&&this.sequenceNumberHandler(t)}else if(e.key===this.Fs){let t=this.Js(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Ys(e)))}}}else this.ys.push(e)})}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,n){let r=new lz(this.currentUser,e,t,n),i=lq(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Ls(e){let t=lq(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){let r=lU(this.persistenceKey,e),i=new lj(e,t,n);this.setItem(r,i.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let n=this.$s(e);return lG.Es(n,t)}Gs(e,t){let n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lz.Es(new n2(i),r,t)}js(e,t){let n=Number(this.Cs.exec(e)[1]);return lj.Es(n,t)}xs(e){return lK.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);n8("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.eo(s,a).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=s$;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class lH{constructor(){this.no=new l$,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new l$,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lW{io(e){}shutdown(){}}class lY{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){for(let e of(n8("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.uo))e(0)}ao(){for(let e of(n8("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.uo))e(1)}static D(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lX=null;function lJ(){return null===lX?lX=0x10000000+Math.round(0x80000000*Math.random()):lX++,"0x"+lX.toString(16)}let lZ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class l0{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}let l1="WebChannelConnection";class l2 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){let s=lJ(),a=this.bo(e,t.toUriEncodedString());n8("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(o,r,i),this.Co(e,a,o,n).then(t=>(n8("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw n7("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+n5,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}bo(e,t){let n=lZ[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){let i=lJ();return new Promise((s,a)=>{let o=new t8;o.setWithCredentials(!0),o.listenOnce(e8.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case e4.NO_ERROR:let t=o.getResponseJson();n8(l1,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case e4.TIMEOUT:n8(l1,`RPC '${e}' ${i} timed out`),a(new ri(rr.DEADLINE_EXCEEDED,"Request time out"));break;case e4.HTTP_ERROR:let n=o.getStatus();if(n8(l1,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(rr).indexOf(e)>=0?e:rr.UNKNOWN);a(new ri(n,t.message))}else a(new ri(rr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new ri(rr.UNAVAILABLE,"Connection failed."));break;default:rt()}}finally{n8(l1,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);n8(l1,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)})}Fo(e,t,n){let r=lJ(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new nk,o=eZ(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let h=i.join("");n8(l1,`Creating RPC '${e}' stream ${r}: ${h}`,l);let c=s.createWebChannel(h,l),d=!1,f=!1,g=new l0({lo:t=>{f?n8(l1,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(n8(l1,`Opening RPC '${e}' stream ${r} transport.`),c.open(),d=!0),n8(l1,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},ho:()=>c.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(c,te.EventType.OPEN,()=>{f||n8(l1,`RPC '${e}' stream ${r} transport opened.`)}),m(c,te.EventType.CLOSE,()=>{f||(f=!0,n8(l1,`RPC '${e}' stream ${r} transport closed`),g.Vo())}),m(c,te.EventType.ERROR,t=>{f||(f=!0,n7(l1,`RPC '${e}' stream ${r} transport errored:`,t),g.Vo(new ri(rr.UNAVAILABLE,"The operation could not be completed")))}),m(c,te.EventType.MESSAGE,t=>{var n;if(!f){let i=t.data[0];i||rt();let s=i.error||(null==(n=i[0])?void 0:n.error);if(s){n8(l1,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=a[e];if(void 0!==t)return ay(t)}(t),i=s.message;void 0===n&&(n=rr.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),f=!0,g.Vo(new ri(n,i)),c.close()}else n8(l1,`RPC '${e}' stream ${r} received:`,i),g.mo(i)}}),m(o,eX.STAT_EVENT,t=>{10===t.stat?n8(l1,`RPC '${e}' stream ${r} detected buffering proxy`):11===t.stat&&n8(l1,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.Ro()},0),g}}function l5(){return"u">typeof window?window:null}function l6(){return"u">typeof document?document:null}function l3(e){return new aF(e,!0)}class l4{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&n8("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class l8{constructor(e,t,n,r,i,s,a,o){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new l4(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===rr.RESOURCE_EXHAUSTED?(n9(t.toString()),n9("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===rr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Wo===t&&this.o_(e,n)},t=>{e(()=>{let e=new ri(rr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)})})}o_(e,t){let n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{n(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(e=>{n(()=>this.__(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Yo(){this.state=5,this.jo.qo(async()=>{this.state=0,this.start()})}__(e){return n8("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(n8("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class l9 extends l8{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:rt(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||rt(),iD.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||rt(),iD.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new aA(s,a,o,l&&new ri(void 0===l.code?rr.UNKNOWN:ay(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=a$(e,r.document.name),s=aU(r.document.updateTime),a=r.document.createTime?aU(r.document.createTime):rv.min(),o=new i2({mapValue:{fields:r.document.fields}}),l=i5.newFoundDocument(i,s,a,o);n=new aC(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=a$(e,r.document),s=r.readTime?aU(r.readTime):rv.min(),a=i5.newNoDocument(i,s);n=new aC([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=a$(e,r.document);n=new aC([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rt();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new am(r,i);n=new aD(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return rv.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?rv.min():t.readTime?aU(t.readTime):rv.min()}(e);return this.listener.u_(t,n)}c_(e){let t,n={};n.database=aW(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=sw(r)?{documents:a1(e,r)}:{query:a2(e,r).ut}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=aq(e,t.resumeToken);let r=aV(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(rv.min())>0){n.readTime=aB(e,t.snapshotVersion.toTimestamp());let r=aV(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rt()}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.t_(n)}l_(e){let t={};t.database=aW(this.serializer),t.removeTarget=e,this.t_(t)}}class l7 extends l8{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||rt(),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||rt(),t.map(e=>{let t;return(t=e.updateTime?aU(e.updateTime):aU(n)).isEqual(rv.min())&&(t=aU(n)),new s8(t,e.transformResults||[])})):[]),i=aU(e.commitTime);return this.listener.T_(i,r)}return e.writeResults&&0!==e.writeResults.length&&rt(),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=aW(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>aZ(this.serializer,e))};this.t_(t)}}class ue extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new ri(rr.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.So(e,aj(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ri(rr.UNKNOWN,e.toString())})}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.vo(e,aj(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ri(rr.UNKNOWN,e.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class ut{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(n9(t),this.g_=!1):n8("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class un{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(e=>{n.enqueueAndForget(async()=>{uc(this)&&(n8("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.v_.add(4),await ui(e),e.x_.set("Unknown"),e.v_.delete(4),await ur(e)}(this))})}),this.x_=new ut(n,r)}}async function ur(e){if(uc(e))for(let t of e.F_)await t(!0)}async function ui(e){for(let t of e.F_)await t(!1)}function us(e,t){e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),uh(e)?uu(e):uS(e).Jo()&&uo(e,t))}function ua(e,t){let n=uS(e);e.C_.delete(t),n.Jo()&&ul(e,t),0===e.C_.size&&(n.Jo()?n.Xo():uc(e)&&e.x_.set("Unknown"))}function uo(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rv.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}uS(e).c_(t)}function ul(e,t){e.O_.Oe(t),uS(e).l_(t)}function uu(e){e.O_=new ak({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),uS(e).start(),e.x_.p_()}function uh(e){return uc(e)&&!uS(e).Ho()&&e.C_.size>0}function uc(e){return 0===e.v_.size}async function ud(e){e.C_.forEach((t,n)=>{uo(e,t)})}async function uf(e,t){e.O_=void 0,uh(e)?(e.x_.S_(t),uu(e)):e.x_.set("Unknown")}async function ug(e,t,n){if(e.x_.set("Online"),t instanceof aA&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){n8("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await um(e,n)}else if(t instanceof aC?e.O_.$e(t):t instanceof aD?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(rv.min()))try{let t,r=await lN(e.localStore);n.compareTo(r)>=0&&await ((t=e.O_.it(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(iD.EMPTY_BYTE_STRING,r.snapshotVersion)),ul(e,t);let i=new a8(r.target,t,n,r.sequenceNumber);uo(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){n8("RemoteStore","Failed to raise snapshot:",t),await um(e,t)}}async function um(e,t,n){if(!rj(t))throw t;e.v_.add(1),await ui(e),e.x_.set("Offline"),n||(n=()=>lN(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n8("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await ur(e)})}function up(e,t){return t().catch(n=>um(e,n,t))}async function uy(e){var t;let n=uC(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;uc(t=e)&&t.D_.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,function(e,t){e.D_.push(t);let n=uC(e);n.Jo()&&n.P_&&n.I_(t.mutations)}(e,t)}catch(t){await um(e,t)}uw(e)&&uv(e)}function uw(e){return uc(e)&&!uC(e).Ho()&&e.D_.length>0}function uv(e){uC(e).start()}async function ub(e){uC(e).d_()}async function u_(e){let t=uC(e);for(let n of e.D_)t.I_(n.mutations)}async function uI(e,t,n){let r=e.D_.shift(),i=ad.from(r,t,n);await up(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await uy(e)}async function uE(e,t){t&&uC(e).P_&&await async function(e,t){var n;if(ap(n=t.code)&&n!==rr.ABORTED){let n=e.D_.shift();uC(e).Zo(),await up(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await uy(e)}}(e,t),uw(e)&&uv(e)}async function ux(e,t){e.asyncQueue.verifyOperationInProgress(),n8("RemoteStore","RemoteStore received new credentials");let n=uc(e);e.v_.add(3),await ui(e),n&&e.x_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),await ur(e)}async function uT(e,t){t?(e.v_.delete(2),await ur(e)):t||(e.v_.add(2),await ui(e),e.x_.set("Unknown"))}function uS(e){var t,n,r;return e.N_||(t=e.datastore,n=e.asyncQueue,r={Po:ud.bind(null,e),To:uf.bind(null,e),u_:ug.bind(null,e)},t.R_(),e.N_=new l9(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.F_.push(async t=>{t?(e.N_.Zo(),uh(e)?uu(e):e.x_.set("Unknown")):(await e.N_.stop(),e.O_=void 0)})),e.N_}function uC(e){var t,n,r;return e.B_||(t=e.datastore,n=e.asyncQueue,r={Po:ub.bind(null,e),To:uE.bind(null,e),E_:u_.bind(null,e),T_:uI.bind(null,e)},t.R_(),e.B_=new l7(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.F_.push(async t=>{t?(e.B_.Zo(),await uy(e)):(await e.B_.stop(),e.D_.length>0&&(n8("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))})),e.B_}class uD{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new uD(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ri(rr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uA(e,t){if(n9("AsyncQueue",`${t}: ${e}`),rj(e))return new ri(rr.UNAVAILABLE,`${t}: ${e}`);throw e}class uN{constructor(e){this.comparator=e?(t,n)=>e(t,n)||rx.comparator(t.key,n.key):(e,t)=>rx.comparator(e.key,t.key),this.keyedMap=sq(),this.sortedSet=new iv(this.comparator)}static emptySet(e){return new uN(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uN)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new uN;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class uk{constructor(){this.L_=new iv(rx.comparator)}track(e){let t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):rt():this.L_=this.L_.insert(t,e)}k_(){let e=[];return this.L_.inorderTraversal((t,n)=>{e.push(n)}),e}}class uR{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new uR(e,t,uN.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sk(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class uM{constructor(){this.q_=void 0,this.Q_=[]}}class uL{constructor(){this.queries=new sF(e=>sR(e),sk),this.onlineState="Unknown",this.K_=new Set}}async function uO(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i||(r=!0,i=new uM),r)try{i.q_=await e.onListen(n)}catch(n){let e=uA(n,`Initialization of query '${sM(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Q_.push(t),t.U_(e.onlineState),i.q_&&t.W_(i.q_)&&uB(e)}async function uP(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i){let e=i.Q_.indexOf(t);e>=0&&(i.Q_.splice(e,1),r=0===i.Q_.length)}if(r)return e.queries.delete(n),e.onUnlisten(n)}function uF(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Q_)e.W_(r)&&(n=!0);i.q_=r}}n&&uB(e)}function uV(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Q_)e.onError(n);e.queries.delete(t)}function uB(e){e.K_.forEach(e=>{e.next()})}class uq{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new uR(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){return!e.fromCache||(!this.options.Z_||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;let t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=uR.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class uU{constructor(e,t){this.X_=e,this.byteLength=t}ea(){return"metadata"in this.X_}}class uz{constructor(e){this.serializer=e}Ps(e){return a$(this.serializer,e)}Is(e){return e.metadata.exists?aJ(this.serializer,e.document,!1):i5.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return aU(e)}}class uj{constructor(e,t,n){this.ta=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=uG(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;let n=r_.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ra(e){let t=new Map,n=new uz(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ps(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||sK()).add(e);t.set(n,r)}}return t}async complete(){let e=await async function(e,t,n,r){let i=sK(),s=sV;for(let e of n){let n=t.Ps(e.metadata.name);e.document&&(i=i.add(n));let r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),s=s.insert(n,r)}let a=e.os.newChangeBuffer({trackRemovals:!0}),o=await lR(e,sC(sE(r_.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>lk(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Qr.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Qr.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.cs,n.ls)).next(()=>n.cs)))}(this.localStore,new uz(this.serializer),this.documents,this.ta.id),t=this.ra(this.documents);for(let e of this.queries)await lV(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}}}function uG(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uK{constructor(e){this.key=e}}class u${constructor(e){this.key=e}}class uQ{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=sK(),this.mutatedKeys=sK(),this.ua=sP(e),this.ca=new uN(this.ua)}get la(){return this.oa}ha(e,t){let n=t?t.Pa:new uk,r=t?t.ca:this.ca,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=sL(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.Ia(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.ua(h,o)>0||l&&0>this.ua(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:a,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;let s=e.Pa.k_();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rt()}})(n)-i(r)||this.ua(e.doc,t.doc)}),this.Ta(n),r=null!=r&&r;let a=t&&!r?this.Ea():[],o=0===this.aa.size&&this.current&&!r?1:0,l=o!==this._a;return this._a=o,0!==s.length||l?{snapshot:new uR(this.query,e.ca,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new uk,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(e=>this.oa=this.oa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.oa=this.oa.delete(e)),this.current=e.current)}Ea(){if(!this.current)return[];let e=this.aa;this.aa=sK(),this.ca.forEach(e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))});let t=[];return e.forEach(e=>{this.aa.has(e)||t.push(new u$(e))}),this.aa.forEach(n=>{e.has(n)||t.push(new uK(n))}),t}Ra(e){this.oa=e.hs,this.aa=sK();let t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return uR.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class uH{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uW{constructor(e){this.key=e,this.ma=!1}}class uY{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new sF(e=>sR(e),sk),this.pa=new Map,this.ya=new Set,this.wa=new iv(rx.comparator),this.Sa=new Map,this.ba=new ll,this.Da={},this.Ca=new Map,this.va=oW.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function uX(e,t){let n,r,i=hd(e),s=i.ga.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.Va();else{let e=await lR(i.localStore,sC(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await uJ(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&us(i.remoteStore,e)}return r}async function uJ(e,t,n,r,i){e.Ma=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await lL(e.localStore,t.query,!1).then(({documents:e})=>t.view.ha(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return u7(e,t.targetId,o.da),o.snapshot})(e,t,n,r);let s=await lL(e.localStore,t,!0),a=new uQ(t,s.hs),o=a.ha(s.documents),l=aS.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);u7(e,n,u.da);let h=new uH(t,n,a);return e.ga.set(t,h),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}async function uZ(e,t){let n=e.ga.get(t),r=e.pa.get(n.targetId);r.length>1?(e.pa.set(n.targetId,r.filter(e=>!sk(e,t))),e.ga.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lM(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),ua(e.remoteStore,n.targetId),u8(e,n.targetId)}).catch(rF)):(u8(e,n.targetId),await lM(e.localStore,n.targetId,!0))}async function u0(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.ns,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Qr.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(iD.EMPTY_BYTE_STRING,rv.min()).withLastLimboFreeSnapshotVersion(rv.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.Qr.updateTargetData(e,h))});let o=sV,l=sK();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(lk(e,s,t.documentUpdates).next(e=>{o=e.cs,l=e.ls})),!r.isEqual(rv.min())){let t=n.Qr.getLastRemoteSnapshotVersion(e).next(t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return rV.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.ns=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Sa.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||rt(),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?r.ma||rt():t.removedDocuments.size>0&&(r.ma||rt(),r.ma=!1))}),await ht(e,s,t)}catch(e){await rF(e)}}function u1(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.ga.forEach((e,n)=>{let r=n.view.U_(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Q_)e.U_(t)&&(n=!0)}),n&&uB(r),i.length&&e.fa.u_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function u2(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Sa.get(t),i=r&&r.key;if(i){let n=new iv(rx.comparator);n=n.insert(i,i5.newNoDocument(i,rv.min()));let r=sK().add(i),s=new aT(rv.min(),new Map,new iv(rp),n,r);await u0(e,s),e.wa=e.wa.remove(i),e.Sa.delete(t),he(e)}else await lM(e.localStore,t,!1).then(()=>u8(e,t,n)).catch(rF)}async function u5(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.os.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=rV.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);null!==i||rt(),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sK();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));u4(e,r,null),u3(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await ht(e,i)}catch(e){await rF(e)}}async function u6(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||rt(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));u4(e,t,n),u3(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await ht(e,i)}catch(e){await rF(e)}}function u3(e,t){(e.Ca.get(t)||[]).forEach(e=>{e.resolve()}),e.Ca.delete(t)}function u4(e,t,n){let r=e.Da[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Da[e.currentUser.toKey()]=r}}function u8(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.pa.get(t)))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach(t=>{e.ba.containsKey(t)||u9(e,t)})}function u9(e,t){e.ya.delete(t.path.canonicalString());let n=e.wa.get(t);null!==n&&(ua(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),he(e))}function u7(e,t,n){for(let r of n)r instanceof uK?(e.ba.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(n8("SyncEngine","New document in limbo: "+n),e.ya.add(r),he(e))}(e,r)):r instanceof u$?(n8("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||u9(e,r.key)):rt()}function he(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){let t=e.ya.values().next().value;e.ya.delete(t);let n=new rx(r_.fromString(t)),r=e.va.next();e.Sa.set(r,new uW(n)),e.wa=e.wa.insert(n,r),us(e.remoteStore,new a8(sC(sE(n.path)),r,"TargetPurposeLimboResolution",rY._e))}}async function ht(e,t,n){let r=[],i=[],s=[];e.ga.isEmpty()||(e.ga.forEach((a,o)=>{s.push(e.Ma(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);let e=lT.Ki(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.fa.u_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rV.forEach(t,t=>rV.forEach(t.qi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rV.forEach(t.Qi,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rj(e))throw e;n8("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.ns.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.ns=e.ns.insert(t,i)}}}(e.localStore,i))}async function hn(e,t){if(!e.currentUser.isEqual(t)){n8("SyncEngine","User change. New user:",t.toKey());let n=await lA(e.localStore,t);e.currentUser=t,e.Ca.forEach(e=>{e.forEach(e=>{e.reject(new ri(rr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ca.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await ht(e,n.us)}}function hr(e,t){let n=e.Sa.get(t);if(n&&n.ma)return sK().add(n.key);{let n=sK(),r=e.pa.get(t);if(!r)return n;for(let t of r){let r=e.ga.get(t);n=n.unionWith(r.view.la)}return n}}async function hi(e,t){let n=await lL(e.localStore,t.query,!0),r=t.view.Ra(n);return e.isPrimaryClient&&u7(e,t.targetId,r.da),r}async function hs(e,t){return lP(e.localStore,t).then(t=>ht(e,t))}async function ha(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.vn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):rV.resolve(null))));null!==o?("pending"===n?await uy(e.remoteStore):"acknowledged"===n||"rejected"===n?(u4(e,t,r||null),u3(e,t),s=e.localStore,s.mutationQueue.Mn(t)):rt(),await ht(e,o)):n8("SyncEngine","Cannot apply mutation batch with id: "+t)}async function ho(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.pa.get(n);if(s&&0!==s.length)for(let n of(t=await lR(e.localStore,sC(s[0])),s)){let t=e.ga.get(n),r=await hi(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await lO(e.localStore,n);t=await lR(e.localStore,r),await uJ(e,hl(r),n,!1,t.resumeToken)}r.push(t)}return e.fa.u_(i),r}function hl(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new sI(t,n,r,i,s,"F",e.startAt,e.endAt)}function hu(e){return e.localStore.persistence.Li()}async function hh(e,t,n,r){if(e.Fa)return void n8("SyncEngine","Ignoring unexpected query state notification.");let i=e.pa.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await lP(e.localStore,sO(i[0])),s=aT.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,iD.EMPTY_BYTE_STRING);await ht(e,r,s);break}case"rejected":await lM(e.localStore,t,!0),u8(e,t,r);break;default:rt()}}async function hc(e,t,n){let r=hd(e);if(r.Fa){for(let e of t){if(r.pa.has(e)){n8("SyncEngine","Adding an already active target "+e);continue}let t=await lO(r.localStore,e),n=await lR(r.localStore,t);await uJ(r,hl(t),n.targetId,!1,n.resumeToken),us(r.remoteStore,n)}for(let e of n)r.pa.has(e)&&await lM(r.localStore,e,!1).then(()=>{ua(r.remoteStore,e),u8(r,e)}).catch(rF)}}function hd(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=u0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hr.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=u2.bind(null,e),e.fa.u_=uF.bind(null,e.eventManager),e.fa.xa=uV.bind(null,e.eventManager),e}function hf(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=u5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=u6.bind(null,e),e}class hg{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=l3(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t,n;return t=this.persistence,n=new lC,new lD(t,n,e.initialUser,this.serializer)}createPersistence(e){return new lg(lp.Hr,this.serializer)}createSharedClientState(e){return new lH}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hm extends hg{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return this.persistence.referenceDelegate instanceof ly||rt(),new o2(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?oU.withCacheSize(this.cacheSizeBytes):oU.DEFAULT;return new lg(e=>ly.Hr(e,t),this.serializer)}}class hp extends hg{constructor(e,t,n){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Na.initialize(this,e),await hf(this.Na.syncEngine),await uy(this.Na.remoteStore),await this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t,n;return t=this.persistence,n=new lC,new lD(t,n,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new o2(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new rW(t,this.persistence);return new rH(e.asyncQueue,n)}createPersistence(e){let t=lx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?oU.withCacheSize(this.cacheSizeBytes):oU.DEFAULT;return new l_(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,l5(),l6(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lH}}class hy extends hp{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Na.syncEngine;this.sharedClientState instanceof lQ&&(this.sharedClientState.syncEngine={Zs:ha.bind(null,t),Xs:hh.bind(null,t),eo:hc.bind(null,t),Li:hu.bind(null,t),Ys:hs.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi(async e=>{await async function(e,t){if(hd(e),hf(e),!0===t&&!0!==e.Fa){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await ho(e,t.toArray());for(let t of(e.Fa=!0,await uT(e.remoteStore,!0),n))us(e.remoteStore,t)}else if(!1===t&&!1!==e.Fa){let t=[],n=Promise.resolve();e.pa.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(u8(e,i),lM(e.localStore,i,!0))),ua(e.remoteStore,i)}),await n,await ho(e,t),e.Sa.forEach((t,n)=>{ua(e.remoteStore,n)}),e.ba.mr(),e.Sa=new Map,e.wa=new iv(rx.comparator),e.Fa=!1,await uT(e.remoteStore,!1)}}(this.Na.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=l5();if(!lQ.D(t))throw new ri(rr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=lx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new lQ(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class hw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>u1(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=hn.bind(null,this.syncEngine),await uT(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uL}createDatastore(e){var t;let n=l3(e.databaseInfo.databaseId),r=new l2(e.databaseInfo);return t=e.authCredentials,new ue(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new un(t,n,e.asyncQueue,e=>u1(this.syncEngine,e,0),lY.D()?new lY:new lW)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new uY(n,r,i,s,a,o),t&&(l.Fa=!0),l}async terminate(){var e;await async function(e){n8("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await ui(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate()}}function hv(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class hb{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):n9("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class h_{constructor(e,t){this.ka=e,this.serializer=t,this.metadata=new rs,this.buffer=new Uint8Array,this.qa=new TextDecoder("utf-8"),this.Qa().then(e=>{e&&e.ea()?this.metadata.resolve(e.X_.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.X_)}`))},e=>this.metadata.reject(e))}close(){return this.ka.cancel()}async getMetadata(){return this.metadata.promise}async Oa(){return await this.getMetadata(),this.Qa()}async Qa(){let e=await this.Ka();if(null===e)return null;let t=this.qa.decode(e),n=Number(t);return isNaN(n)&&this.$a(`length string (${t}) is not valid number`),new uU(JSON.parse(await this.Ua(n)),e.length+n)}Wa(){return this.buffer.findIndex(e=>123===e)}async Ka(){for(;0>this.Wa()&&!await this.Ga(););if(0===this.buffer.length)return null;let e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ua(e){for(;this.buffer.length<e;)await this.Ga()&&this.$a("Reached the end of bundle when more is expected.");let t=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}$a(e){throw this.ka.cancel(),Error(`Invalid bundle format: ${e}`)}async Ga(){let e=await this.ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class hI{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ri(rr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>aK(e.serializer,t))},r=await e.vo("BatchGetDocuments",e.serializer.databaseId,r_.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(t.found||rt(),t.found.name,t.found.updateTime,r=a$(n,t.found.name),s=aU(t.found.updateTime),a=t.found.createTime?aU(t.found.createTime):rv.min(),o=new i2({mapValue:{fields:t.found.fields}}),i5.newFoundDocument(r,s,a,o)):"missing"in t?(t.missing||rt(),t.readTime||rt(),l=a$(n,t.missing),u=aU(t.readTime),i5.newNoDocument(l,u)):rt());i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());t||rt(),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new au(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rx.fromPath(t);this.mutations.push(new ah(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>aZ(e.serializer,t))};await e.So("Commit",e.serializer.databaseId,r_.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw rt();t=rv.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new ri(rr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rv.min())?s9.exists(!1):s9.updateTime(t):s9.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(rv.min()))throw new ri(rr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return s9.updateTime(t)}return s9.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class hE{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.za=n.maxAttempts,this.jo=new l4(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo(async()=>{let e=new hI(this.datastore),t=this.Ja(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Ya(e)}))}).catch(e=>{this.Ya(e)})})}Ja(e){try{let t=this.updateFunction(e);return!rX(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ha(),Promise.resolve()))):this.deferred.reject(e)}Za(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ap(t)}return!1}}class hx{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=n2.UNAUTHENTICATED,this.clientId=rm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{n8("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(n8("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ri(rr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=uA(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hT(e,t){e.asyncQueue.verifyOperationInProgress(),n8("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await lA(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hS(e,t){e.asyncQueue.verifyOperationInProgress();let n=await hD(e);n8("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ux(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ux(t.remoteStore,n)),e._onlineComponents=t}function hC(e){return"FirebaseError"===e.name?e.code===rr.FAILED_PRECONDITION||e.code===rr.UNIMPLEMENTED:!("u">typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function hD(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){n8("FirestoreClient","Using user provided OfflineComponentProvider");try{await hT(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!hC(t))throw t;n7("Error using user provided cache. Falling back to memory cache: "+t),await hT(e,new hg)}}else n8("FirestoreClient","Using default OfflineComponentProvider"),await hT(e,new hg);return e._offlineComponents}async function hA(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(n8("FirestoreClient","Using user provided OnlineComponentProvider"),await hS(e,e._uninitializedComponentsProvider._online)):(n8("FirestoreClient","Using default OnlineComponentProvider"),await hS(e,new hw))),e._onlineComponents}function hN(e){return hD(e).then(e=>e.persistence)}function hk(e){return hD(e).then(e=>e.localStore)}function hR(e){return hA(e).then(e=>e.remoteStore)}function hM(e){return hA(e).then(e=>e.syncEngine)}function hL(e){return hA(e).then(e=>e.datastore)}async function hO(e){let t=await hA(e),n=t.eventManager;return n.onListen=uX.bind(null,t.syncEngine),n.onUnlisten=uZ.bind(null,t.syncEngine),n}function hP(e,t,n={}){let r=new rs;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await hO(e),s=e.asyncQueue,a=new hb({next:e=>{s.enqueueAndForget(()=>uP(i,o));let a=e.docs.has(t);!a&&e.fromCache?r.reject(new ri(rr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&e.fromCache&&n&&"server"===n.source?r.reject(new ri(rr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),uO(i,o=new uq(sE(t.path),a,{includeMetadataChanges:!0,Z_:!0}))}),r.promise}function hF(e,t,n={}){let r=new rs;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a;return i=await hO(e),s=e.asyncQueue,a=new uq(t,new hb({next:e=>{s.enqueueAndForget(()=>uP(i,a)),e.fromCache&&"server"===n.source?r.reject(new ri(rr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,Z_:!0}),uO(i,a)}),r.promise}function hV(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hB=new Map;function hq(e,t,n){if(!n)throw new ri(rr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hU(e,t,n,r){if(!0===t&&!0===r)throw new ri(rr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function hz(e){if(!rx.isDocumentKey(e))throw new ri(rr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hj(e){if(rx.isDocumentKey(e))throw new ri(rr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hG(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":rt()}function hK(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ri(rr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=hG(e);throw new ri(rr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function h$(e,t){if(t<=0)throw new ri(rr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class hQ{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ri(rr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ri(rr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hU("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hV(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hH{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hQ({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ri(rr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ri(rr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hQ(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ro;switch(e.type){case"firstParty":return new rc(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ri(rr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=hB.get(this))&&(n8("ComponentProvider","Removing Datastore"),hB.delete(this),e.terminate()),Promise.resolve()}}function hW(e,t,n,r={}){var i;let s=(e=hK(e,hH))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&n7("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=n2.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new ri(rr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new n2(s)}e._authCredentials=new rl(new ra(t,n))}}class hY{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hY(this.firestore,e,this._query)}}class hX{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hJ(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hX(this.firestore,e,this._key)}}class hJ extends hY{constructor(e,t,n){super(e,t,sE(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new hX(this.firestore,null,new rx(e))}withConverter(e){return new hJ(this.firestore,e,this._path)}}function hZ(e,t,...n){if(e=_(e),hq("collection","path",t),e instanceof hH){let r=r_.fromString(t,...n);return hj(r),new hJ(e,null,r)}{if(!(e instanceof hX||e instanceof hJ))throw new ri(rr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(r_.fromString(t,...n));return hj(r),new hJ(e.firestore,null,r)}}function h0(e,t){if(e=hK(e,hH),hq("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new ri(rr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hY(e,null,new sI(r_.emptyPath(),t))}function h1(e,t,...n){if(e=_(e),1==arguments.length&&(t=rm.newId()),hq("doc","path",t),e instanceof hH){let r=r_.fromString(t,...n);return hz(r),new hX(e,null,new rx(r))}{if(!(e instanceof hX||e instanceof hJ))throw new ri(rr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(r_.fromString(t,...n));return hz(r),new hX(e.firestore,e instanceof hJ?e.converter:null,new rx(r))}}function h2(e,t){return e=_(e),t=_(t),(e instanceof hX||e instanceof hJ)&&(t instanceof hX||t instanceof hJ)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function h5(e,t){return e=_(e),t=_(t),e instanceof hY&&t instanceof hY&&e.firestore===t.firestore&&sk(e._query,t._query)&&e.converter===t.converter}class h6{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new l4(this,"async_queue_retry"),this._u=()=>{let e=l6();e&&n8("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let e=l6();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;let t=l6();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});let t=new rs;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!rj(e))throw e;n8("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo(()=>this.cu())}}uu(e){let t=this.Xa.then(()=>(this.iu=!0,e().catch(e=>{let t;throw this.ru=e,this.iu=!1,n9("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.iu=!1,e))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);let r=uD.createAndSchedule(this,e,t,n,e=>this.lu(e));return this.nu.push(r),r}au(){this.ru&&rt()}verifyOperationInProgress(){}async hu(){let e;do e=this.Xa,await e;while(e!==this.Xa)}Pu(e){for(let t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{for(let t of(this.nu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.nu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){let t=this.nu.indexOf(e);this.nu.splice(t,1)}}function h3(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class h4{constructor(){this._progressObserver={},this._taskCompletionResolver=new rs,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let h8=-1;class h9 extends hH{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new h6,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||cn(this),this._firestoreClient.terminate()}}function h7(e,t,n){n||(n="(default)");let r=(0,l._getProvider)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n});if(v(r.getOptions(n),t))return e;throw new ri(rr.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new ri(rr.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ri(rr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})}function ce(e,t){let n="object"==typeof e?e:(0,l.getApp)(),r=(0,l._getProvider)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){let e=(e=>{var t,n;let r=null==(n=null==(t=f())?void 0:t.emulatorHosts)?void 0:n[e];if(!r)return;let i=r.lastIndexOf(":");if(i<=0||i+1===r.length)throw Error(`Invalid host ${r} with no separate hostname and port!`);let s=parseInt(r.substring(i+1),10);return"["===r[0]?[r.substring(1,i-1),s]:[r.substring(0,i),s]})("firestore");e&&hW(r,...e)}return r}function ct(e){return e._firestoreClient||cn(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function cn(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new iP(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,hV(a.experimentalLongPollingOptions),a.useFetchStreams));e._firestoreClient=new hx(e._authCredentials,e._appCheckCredentials,e._queue,o),(null==(n=a.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=a.localCache)?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.localCache.kind,_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider})}function cr(e,t){cf(e=hK(e,h9));let n=ct(e);if(n._uninitializedComponentsProvider)throw new ri(rr.FAILED_PRECONDITION,"SDK cache is already specified.");n7("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings(),i=new hw;return cs(n,i,new hp(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function ci(e){cf(e=hK(e,h9));let t=ct(e);if(t._uninitializedComponentsProvider)throw new ri(rr.FAILED_PRECONDITION,"SDK cache is already specified.");n7("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings(),r=new hw;return cs(t,r,new hy(r,n.cacheSizeBytes))}function cs(e,t,n){let r=new rs;return e.asyncQueue.enqueue(async()=>{try{await hT(e,n),await hS(e,t),r.resolve()}catch(e){if(!hC(e))throw e;n7("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}}).then(()=>r.promise)}function ca(e){if(e._initialized&&!e._terminated)throw new ri(rr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new rs;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rq.D())return Promise.resolve();await rq.delete(e+"main")}(lx(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function co(e){var t;let n;return t=ct(e=hK(e,h9)),n=new rs,t.asyncQueue.enqueueAndForget(async()=>(async function(e,t){var n;uc(e.remoteStore)||n8("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Ca.get(r)||[];i.push(t),e.Ca.set(r,i)}catch(n){let e=uA(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}})(await hM(t),n)),n.promise}function cl(e){var t;return(t=ct(e=hK(e,h9))).asyncQueue.enqueue(async()=>{let e=await hN(t),n=await hR(t);return e.setNetworkEnabled(!0),n.v_.delete(0),ur(n)})}function cu(e){var t;return(t=ct(e=hK(e,h9))).asyncQueue.enqueue(async()=>{let e=await hN(t),n=await hR(t);return e.setNetworkEnabled(!1),async function(e){e.v_.add(0),await ui(e),e.x_.set("Offline")}(n)})}function ch(e){return(0,l._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function cc(e,t){var n,r;let i,s=ct(e=hK(e,h9)),a=new h4;return n=e._databaseId,r=l3(n),i=new h_(function(e,t){if(e instanceof Uint8Array)return hv(e,void 0);if(e instanceof ArrayBuffer)return hv(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?av().encode(t):t),r),s.asyncQueue.enqueueAndForget(async()=>{var e;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=aU(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.$r.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(uG(a));let o=new uj(a,e.localStore,t.serializer),l=await t.Oa();for(;l;){let e=await o.na(l);e&&n._updateProgress(e),l=await t.Oa()}let u=await o.complete();return await ht(e,u.sa,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.$r.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.ia)}catch(e){return n7("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(e=await hM(s),i,a).then(t=>{e.sharedClientState.notifyBundleLoaded(t)})}),a}function cd(e,t){var n;return(n=ct(e=hK(e,h9)),n.asyncQueue.enqueue(async()=>{var e;return e=await hk(n),e.persistence.runTransaction("Get named query","readonly",n=>e.$r.getNamedQuery(n,t))})).then(t=>t?new hY(e,null,t.query):null)}function cf(e){if(e._initialized||e._terminated)throw new ri(rr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class cg{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class cm{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class cp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cp(iD.fromBase64String(e))}catch(e){throw new ri(rr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cp(iD.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class cy{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ri(rr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rE(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function cw(){return new cy("__name__")}class cv{constructor(e){this._methodName=e}}class cb{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ri(rr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ri(rr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rp(this._lat,e._lat)||rp(this._long,e._long)}}let c_=/^__.*__$/;class cI{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new as(e,this.data,this.fieldMask,t,this.fieldTransforms):new ai(e,this.data,t,this.fieldTransforms)}}class cE{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new as(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cx(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rt()}}class cT{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new cT(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return cK(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(cx(this.du)&&c_.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class cS{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||l3(e)}Su(e,t,n,r=!1){return new cT({du:e,methodName:t,wu:n,path:rE.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cC(e){let t=e._freezeSettings(),n=l3(e._databaseId);return new cS(e._databaseId,!!t.ignoreUndefinedProperties,n)}function cD(e,t,n,r,i,s={}){let a,o,l=e.Su(s.merge||s.mergeFields?2:0,t,n,i);cU("Data must be an object, but it was:",l,r);let u=cB(r,l);if(s.merge)a=new iT(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=cz(t,r,n);if(!l.contains(i))throw new ri(rr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);c$(e,i)||e.push(i)}a=new iT(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cI(new i2(u),a,o)}class cA extends cv{_toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cA}}function cN(e,t,n){return new cT({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class ck extends cv{_toFieldTransform(e){return new s4(e.path,new sJ)}isEqual(e){return e instanceof ck}}class cR extends cv{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=cN(this,e,!0),n=new sZ(this.bu.map(e=>cV(e,t)));return new s4(e.path,n)}isEqual(e){return e instanceof cR&&v(this.bu,e.bu)}}class cM extends cv{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=cN(this,e,!0),n=new s1(this.bu.map(e=>cV(e,t)));return new s4(e.path,n)}isEqual(e){return e instanceof cM&&v(this.bu,e.bu)}}class cL extends cv{constructor(e,t){super(e),this.Du=t}_toFieldTransform(e){let t=new s5(e.serializer,sW(e.serializer,this.Du));return new s4(e.path,t)}isEqual(e){return e instanceof cL&&this.Du===e.Du}}function cO(e,t,n,r){let i=e.Su(1,t,n);cU("Data must be an object, but it was:",i,r);let s=[],a=i2.empty();return iy(r,(e,r)=>{let o=cG(t,e,n);r=_(r);let l=i.fu(o);if(r instanceof cA)s.push(o);else{let e=cV(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new cE(a,new iT(s),i.fieldTransforms)}function cP(e,t,n,r,i,s){let a=e.Su(1,t,n),o=[cz(t,r,n)],l=[i];if(s.length%2!=0)throw new ri(rr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(cz(t,s[e])),l.push(s[e+1]);let u=[],h=i2.empty();for(let e=o.length-1;e>=0;--e)if(!c$(u,o[e])){let t=o[e],n=l[e];n=_(n);let r=a.fu(t);if(n instanceof cA)u.push(t);else{let e=cV(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new cE(h,new iT(u),a.fieldTransforms)}function cF(e,t,n,r=!1){return cV(n,e.Su(r?4:3,t))}function cV(e,t){if(cq(e=_(e)))return cU("Unsupported field value:",t,e),cB(e,t);if(e instanceof cv)return function(e,t){if(!cx(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=cV(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}var n=e;if(null===(n=_(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return sW(t.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){let e=rw.fromDate(n);return{timestampValue:aB(t.serializer,e)}}if(n instanceof rw){let e=new rw(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:aB(t.serializer,e)}}if(n instanceof cb)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof cp)return{bytesValue:aq(t.serializer,n._byteString)};if(n instanceof hX){let e=t.databaseId,r=n.firestore._databaseId;if(!r.isEqual(e))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${e.projectId}/${e.database}`);return{referenceValue:az(n.firestore._databaseId||t.databaseId,n._key.path)}}throw t.pu(`Unsupported field value: ${hG(n)}`)}function cB(e,t){let n={};return iw(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):iy(e,(e,r)=>{let i=cV(r,t.Ru(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function cq(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rw||e instanceof cb||e instanceof cp||e instanceof hX||e instanceof cv)}function cU(e,t,n){if(!cq(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=hG(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function cz(e,t,n){if((t=_(t))instanceof cy)return t._internalPath;if("string"==typeof t)return cG(e,t);throw cK("Field path arguments must be of type string or ",e,!1,void 0,n)}let cj=RegExp("[~\\*/\\[\\]]");function cG(e,t,n){if(t.search(cj)>=0)throw cK(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new cy(...t.split("."))._internalPath}catch(r){throw cK(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function cK(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new ri(rr.INVALID_ARGUMENT,o+e+l)}function c$(e,t){return e.some(e=>e.isEqual(t))}class cQ{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hX(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new cH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cW("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cH extends cQ{data(){return super.data()}}function cW(e,t){return"string"==typeof t?cG(e,t):t instanceof cy?t._internalPath:t._delegate._internalPath}function cY(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ri(rr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cX{}class cJ extends cX{}function cZ(e,t,...n){let r=[];for(let i of(t instanceof cX&&r.push(t),function(e){let t=e.filter(e=>e instanceof c2).length,n=e.filter(e=>e instanceof c0).length;if(t>1||t>0&&n>0)throw new ri(rr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class c0 extends cJ{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new c0(e,t,n)}_apply(e){let t=this._parse(e);return dh(e._query,t),new hY(e.firestore,e.converter,sA(e._query,t))}_parse(e){let t=cC(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ri(rr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){du(a,s);let t=[];for(let n of a)t.push(dl(r,e,n));o={arrayValue:{values:t}}}else o=dl(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||du(a,s),o=cF(n,t,a,"in"===s||"not-in"===s);return i7.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function c1(e,t,n){let r=cW("where",e);return c0._create(r,t,n)}class c2 extends cX{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c2(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:se.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())dh(n,e),n=sA(n,e)}(e._query,t),new hY(e.firestore,e.converter,sA(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function c5(...e){return e.forEach(e=>dc("or",e)),c2._create("or",e)}function c6(...e){return e.forEach(e=>dc("and",e)),c2._create("and",e)}class c3 extends cJ{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new c3(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new ri(rr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ri(rr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new i8(t,n)}(e._query,this._field,this._direction);return new hY(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new sI(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function c4(e,t="asc"){let n=cW("orderBy",e);return c3._create(n,t)}class c8 extends cJ{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new c8(e,t,n)}_apply(e){return new hY(e.firestore,e.converter,sN(e._query,this._limit,this._limitType))}}function c9(e){return h$("limit",e),c8._create("limit",e,"F")}function c7(e){return h$("limitToLast",e),c8._create("limitToLast",e,"L")}class de extends cJ{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new de(e,t,n)}_apply(e){var t;let n=da(e,this.type,this._docOrFields,this._inclusive);return new hY(e.firestore,e.converter,(t=e._query,new sI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function dt(...e){return de._create("startAt",e,!0)}function dn(...e){return de._create("startAfter",e,!1)}class dr extends cJ{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new dr(e,t,n)}_apply(e){var t;let n=da(e,this.type,this._docOrFields,this._inclusive);return new hY(e.firestore,e.converter,(t=e._query,new sI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function di(...e){return dr._create("endBefore",e,!1)}function ds(...e){return dr._create("endAt",e,!0)}function da(e,t,n,r){if(n[0]=_(n[0]),n[0]instanceof cQ)return function(e,t,n,r,i){if(!r)throw new ri(rr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of sS(e))if(n.field.isKeyField())s.push(i$(t,r.key));else{let e=r.data.field(n.field);if(iM(e))throw new ri(rr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new ri(rr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new i6(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=cC(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new ri(rr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new ri(rr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!sT(e)&&-1!==l.indexOf("/"))throw new ri(rr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(r_.fromString(l));if(!rx.isDocumentKey(n))throw new ri(rr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rx(n);o.push(i$(t,i))}else{let e=cF(n,r,l);o.push(e)}}return new i6(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function dl(e,t,n){if("string"==typeof(n=_(n))){if(""===n)throw new ri(rr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sT(t)&&-1!==n.indexOf("/"))throw new ri(rr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(r_.fromString(n));if(!rx.isDocumentKey(r))throw new ri(rr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return i$(e,new rx(r))}if(n instanceof hX)return i$(e,n._key);throw new ri(rr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hG(n)}.`)}function du(e,t){if(!Array.isArray(e)||0===e.length)throw new ri(rr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function dh(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ri(rr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ri(rr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function dc(e,t){if(!(t instanceof c0||t instanceof c2))throw new ri(rr.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class dd{convertValue(e,t="none"){switch(iq(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ik(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iR(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw rt()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return iy(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new cb(ik(e.latitude),ik(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=iL(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iO(e));default:return null}}convertTimestamp(e){let t=iN(e);return new rw(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=r_.fromString(e);a4(n)||rt();let r=new iF(n.get(1),n.get(3)),i=new rx(n.popFirst(5));return r.isEqual(t)||n9(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function df(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class dg extends dd{constructor(e){super(),this.firestore=e}convertBytes(e){return new cp(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hX(this.firestore,null,t)}}function dm(e){return new cg("sum",cz("sum",e))}function dp(e){return new cg("avg",cz("average",e))}function dy(){return new cg("count")}function dw(e,t){var n,r;return e instanceof cg&&t instanceof cg&&e.aggregateType===t.aggregateType&&(null==(n=e._internalFieldPath)?void 0:n.canonicalString())===(null==(r=t._internalFieldPath)?void 0:r.canonicalString())}function dv(e,t){return h5(e.query,t.query)&&v(e.data(),t.data())}class db{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class d_ extends cQ{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new dI(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(cW("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dI extends d_{data(e={}){return super.data(e)}}class dE{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new db(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new dI(this._firestore,this._userDataWriter,n.key,n,new db(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ri(rr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new dI(e._firestore,e._userDataWriter,n.doc.key,n.doc,new db(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new dI(e._firestore,e._userDataWriter,t.doc.key,t.doc,new db(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rt()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dx(e,t){return e instanceof d_&&t instanceof d_?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof dE&&t instanceof dE&&e._firestore===t._firestore&&h5(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function dT(e){e=hK(e,hX);let t=hK(e.firestore,h9);return hP(ct(t),e._key).then(n=>dB(t,e,n))}class dS extends dd{constructor(e){super(),this.firestore=e}convertBytes(e){return new cp(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hX(this.firestore,null,t)}}function dC(e){var t;let n;e=hK(e,hX);let r=hK(e.firestore,h9),i=ct(r),s=new dS(r);return(t=e._key,n=new rs,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new ri(rr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=uA(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await hk(i),t,n)),n.promise).then(t=>new d_(r,s,e._key,t,new db(null!==t&&t.hasLocalMutations,!0),e.converter))}function dD(e){e=hK(e,hX);let t=hK(e.firestore,h9);return hP(ct(t),e._key,{source:"server"}).then(n=>dB(t,e,n))}function dA(e){e=hK(e,hY);let t=hK(e.firestore,h9),n=ct(t),r=new dS(t);return cY(e._query),hF(n,e._query).then(n=>new dE(t,r,e,n))}function dN(e){var t;let n;e=hK(e,hY);let r=hK(e.firestore,h9),i=ct(r),s=new dS(r);return(t=e._query,n=new rs,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await lL(e,t,!0),i=new uQ(t,r.hs),s=i.ha(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=uA(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await hk(i),t,n)),n.promise).then(t=>new dE(r,s,e,t))}function dk(e){e=hK(e,hY);let t=hK(e.firestore,h9),n=ct(t),r=new dS(t);return hF(n,e._query,{source:"server"}).then(n=>new dE(t,r,e,n))}function dR(e,t,n){e=hK(e,hX);let r=hK(e.firestore,h9),i=df(e.converter,t,n);return dV(r,[cD(cC(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,s9.none())])}function dM(e,t,n,...r){e=hK(e,hX);let i=hK(e.firestore,h9),s=cC(i);return dV(i,[("string"==typeof(t=_(t))||t instanceof cy?cP(s,"updateDoc",e._key,t,n,r):cO(s,"updateDoc",e._key,t)).toMutation(e._key,s9.exists(!0))])}function dL(e){return dV(hK(e.firestore,h9),[new au(e._key,s9.none())])}function dO(e,t){let n=hK(e.firestore,h9),r=h1(e),i=df(e.converter,t);return dV(n,[cD(cC(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,s9.exists(!1))]).then(()=>r)}function dP(e,...t){var n,r,i,s;let a,o,l,u,h;e=_(e);let c={includeMetadataChanges:!1},d=0;"object"!=typeof t[0]||h3(t[d])||(c=t[d],d++);let f={includeMetadataChanges:c.includeMetadataChanges};if(h3(t[d])){let e=t[d];t[d]=null==(n=e.next)?void 0:n.bind(e),t[d+1]=null==(r=e.error)?void 0:r.bind(e),t[d+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof hX)o=hK(e.firestore,h9),l=sE(e._key.path),a={next:n=>{t[d]&&t[d](dB(o,e,n))},error:t[d+1],complete:t[d+2]};else{let n=hK(e,hY);o=hK(n.firestore,h9),l=n._query;let r=new dS(o);a={next:e=>{t[d]&&t[d](new dE(o,r,n,e))},error:t[d+1],complete:t[d+2]},cY(e._query)}return s=ct(o),h=new uq(l,u=new hb(a),f),s.asyncQueue.enqueueAndForget(async()=>uO(await hO(s),h)),()=>{u.La(),s.asyncQueue.enqueueAndForget(async()=>uP(await hO(s),h))}}function dF(e,t){var n;let r;return n=ct(e=hK(e,h9)),r=new hb(h3(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hO(n),void(e.K_.add(r),r.next())}),()=>{r.La(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hO(n),void e.K_.delete(r)})}}function dV(e,t){var n;let r;return n=ct(e),r=new rs,n.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){let r=hf(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=rw.now(),l=t.reduce((e,t)=>e.add(t.key),sK()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=sV,s=sK();return i.os.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sX(r.transform,e||null);null!=i&&(null===n&&(n=i2.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new as(n.key,t,function e(t){let n=[];return iy(t.fields,(t,r)=>{let i=new rE([t]);if(iX(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new iT(n)}(t.value.mapValue),s9.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:sU(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.Da[r.currentUser.toKey()])||(u=new iv(rp)),u=u.insert(s,n),r.Da[r.currentUser.toKey()]=u,await ht(r,h.changes),await uy(r.remoteStore)}catch(t){let e=uA(t,"Failed to persist write");n.reject(e)}})(await hM(n),t,r)),r.promise}function dB(e,t,n){let r=n.docs.get(t._key),i=new dS(e);return new d_(e,i,t._key,r,new db(n.hasPendingWrites,n.fromCache),t.converter)}function dq(e){return dU(e,{count:dy()})}function dU(e,t){var n;let r,i=hK(e.firestore,h9),s=ct(i),a=function(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}(t,(e,t)=>new ag(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new rs,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await hL(s);r.resolve(async function(e,t,n){var r;let{request:i,V_:s,parent:a}=function(e,t,n){let{ut:r,parent:i}=a2(e,t),s={},a=[],o=0;return n.forEach(e=>{let t="aggregate_"+o++;s[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:a6(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:a6(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},V_:s,parent:i}}(e.serializer,(t.Pe||(t.Pe=sD(t,t.explicitOrderBy)),t.Pe),n);e.connection.wo||delete i.parent;let o=(await e.vo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);1===o.length||rt();let l=null==(r=o[0].result)?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new cm(e,new dS(i),t))}class dz{constructor(e){this.kind="memory",this._onlineComponentProvider=new hw,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=new hg}toJSON(){return{kind:this.kind}}}class dj{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=dJ(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class dG{constructor(){this.kind="memoryEager",this._offlineComponentProvider=new hg}toJSON(){return{kind:this.kind}}}class dK{constructor(e){this.kind="memoryLru",this._offlineComponentProvider=new hm(e)}toJSON(){return{kind:this.kind}}}function d$(){return new dG}function dQ(e){return new dK(null==e?void 0:e.cacheSizeBytes)}function dH(e){return new dz(e)}function dW(e){return new dj(e)}class dY{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new hw,this._offlineComponentProvider=new hp(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}class dX{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new hw,this._offlineComponentProvider=new hy(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes)}}function dJ(e){return new dY(null==e?void 0:e.forceOwnership)}function dZ(){return new dX}let d0={maxAttempts:5};class d1{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cC(e)}set(e,t,n){this._verifyNotCommitted();let r=d2(e,this._firestore),i=df(r.converter,t,n),s=cD(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,s9.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=d2(e,this._firestore);return i="string"==typeof(t=_(t))||t instanceof cy?cP(this._dataReader,"WriteBatch.update",s._key,t,n,r):cO(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,s9.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=d2(e,this._firestore);return this._mutations=this._mutations.concat(new au(t._key,s9.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ri(rr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function d2(e,t){if((e=_(e)).firestore!==t)throw new ri(rr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class d5 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cC(e)}get(e){let t=d2(e,this._firestore),n=new dg(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rt();let r=e[0];if(r.isFoundDocument())return new cQ(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new cQ(this._firestore,n,t._key,null,t.converter);throw rt()})}set(e,t,n){let r=d2(e,this._firestore),i=df(r.converter,t,n),s=cD(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=d2(e,this._firestore);return i="string"==typeof(t=_(t))||t instanceof cy?cP(this._dataReader,"Transaction.update",s._key,t,n,r):cO(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=d2(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=d2(e,this._firestore),n=new dS(this._firestore);return super.get(e).then(e=>new d_(this._firestore,n,t._key,e._document,new db(!1,!1),t.converter))}}function d6(e,t,n){var r,i;let s;e=hK(e,h9);let a=Object.assign(Object.assign({},d0),n);return function(e){if(e.maxAttempts<1)throw new ri(rr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(a),r=ct(e),i=n=>t(new d5(e,n)),s=new rs,r.asyncQueue.enqueueAndForget(async()=>{let e=await hL(r);new hE(r.asyncQueue,e,a,i,s).ja()}),s.promise}function d3(){return new cA("deleteField")}function d4(){return new ck("serverTimestamp")}function d8(...e){return new cR("arrayUnion",e)}function d9(...e){return new cM("arrayRemove",e)}function d7(e){return new cL("increment",e)}function fe(e){return ct(e=hK(e,h9)),new d1(e,t=>dV(e,t))}function ft(e,t){var n;let r=ct(e=hK(e,h9));if(!r._uninitializedComponentsProvider||"memory"===(null==(n=r._uninitializedComponentsProvider)?void 0:n._offlineKind))return n7("Cannot enable indexes when persistence is disabled"),Promise.resolve();let i=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new ri(rr.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=fn(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=cG("setIndexConfiguration",fn(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new rA(e,2)):"ASCENDING"===t.order?r.push(new rA(e,0)):"DESCENDING"===t.order&&r.push(new rA(e,1))}n.push(new rT(rT.UNKNOWN_ID,t,r,rN.empty()))}return n}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,rD,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>rV.waitFor(r)))})(await hk(r),i))}function fn(e,t){if("string"!=typeof e[t])throw new ri(rr.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class fr{constructor(e){this._client=e,this.type="PersistentCacheIndexManager"}}function fi(e){var t;e=hK(e,h9);let n=fu.get(e);if(n)return n;let r=ct(e);if("persistent"!==(null==(t=r._uninitializedComponentsProvider)?void 0:t._offlineKind))return null;let i=new fr(r);return fu.set(e,i),i}function fs(e){fl(e,!0)}function fa(e){fl(e,!1)}function fo(e){var t;e._client.verifyNotTerminated(),(t=e._client).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await hk(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>n8("deleting all persistent cache indexes succeeded")).catch(e=>n7("deleting all persistent cache indexes failed",e))}function fl(e,t){var n;e._client.verifyNotTerminated(),(n=e._client,n.asyncQueue.enqueue(async()=>{var e;return e=await hk(n),void(e.ts.Ui=t)})).then(e=>n8(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>n7(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let fu=new WeakMap;class fh{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return fc.instance.onExistenceFilterMismatch(e)}}class fc{constructor(){this.Cu=new Map}static get instance(){return fd||function(e){if(aw)throw Error("a TestingHooksSpi instance is already set");aw=e}(fd=new fc),fd}tt(e){this.Cu.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Cu;return n.set(t,e),()=>n.delete(t)}}let fd=null;!function(e,t=!0){n5=l.SDK_VERSION,(0,l._registerComponent)(new I("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new h9(new ru(e.getProvider("auth-internal")),new rf(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ri(rr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iF(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,l.registerVersion)(n1,"4.4.2",void 0),(0,l.registerVersion)(n1,"4.4.2","esm2017")}()});