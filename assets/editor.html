<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>âš¡ Pluto.jl âš¡</title>
    <meta charset="utf-8" />
    <script>
        console.log("Pluto.jl, by Fons van der Plas (https://github.com/fonsp) and MikoÅ‚aj Bochenski (https://github.com/malyvsen) ğŸŒˆ");
    </script>
    <meta name="author" content="Fons van der Plas; MikoÅ‚aj Bochenski" />
    <link rel="license" href="https://github.com/fonsp/Pluto.jl/blob/master/LICENSE" />
    <meta name="theme-color" content="#fff" />
    <meta name="description" content="Pluto.jl notebook" />

    <style>
        /* TODO: these are only for the header */
        @import url('https://fonts.googleapis.com/css?family=Roboto+Slab:700&display=swap');
        @import url('https://fonts.googleapis.com/css?family=Roboto+Mono:300,300i,400,400i,500,500i,700,700i&display=swap&subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese');

        /* GENERAL PAGE LAYOUT */

        body {
            margin: 0px;
        }

        /* more sensible defaults for html tags: */
        /* (can be overriden by custom style) */

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: sans-serif;
            margin-block-start: 1em;
            margin-block-end: 0em;
        }

        h1 {
            font-size: 2.2em;
            border-bottom: 3px solid rgba(0, 0, 0, .15);
        }

        h2 {
            font-size: 1.8em;
            border-bottom: 2px dotted rgba(0, 0, 0, .15);
        }

        h3 {
            font-size: 1.6em;
            /* border-bottom: 2px dotted rgba(0,0,0,.15); */
        }

        h4 {
            font-size: 1.4em;
        }

        h5 {
            font-size: 1.2em;
        }

        h6 {
            font-size: 1em;
        }

        p {
            margin-block-start: .5em;
        }

        celloutput img {
            max-width: 100%;
        }

        html,
        body {
            height: 100%;
        }

        main {
            min-height: calc(100% - 73px - 60px);
            margin: 0 auto;
            max-width: 960px;
            align-content: center;
            padding: 8px;
        }

        /* HEADER */

        header {
            background: hsla(0, 100%, 100%, 80%);
            width: 100%;
            min-height: 70px;
            overflow: hidden;
            /* white-space: nowrap; */
            /*font-weight: normal;*/
            border-bottom: solid 1px rgba(0, 0, 0, .1);
        }

        header h1,
        header h2,
        header {
            color: black;
            letter-spacing: 2px;
            font-family: 'Roboto Mono', monospace !important;
        }

        #logocontainer {
            margin: 0 auto;
            max-width: 960px;
            padding-top: 13px;
            padding-left: 20px;
            padding-bottom: 0px;
        }

        #logocontainer img {
            height: 39px;
            margin-bottom: -11px;
        }

        #logocontainer h1 {
            font-weight: 700;
            font-size: 30px;
            display: inline;
            border-bottom: none;
            margin-right: 50px;
        }

        #logocontainer h2 {
            display: inline;
            border-bottom: none;
        }

        #logocontainer h1>span {
            font-weight: 400;
        }

        #printernametitle {
            opacity: .6;
            font-style: normal;
            font-size: 20px;
            font-weight: 400;
        }

        header.disconnected {
            background-color: rgba(255, 100, 0, .3);
        }

        .disconnected>#logocontainer:after {
            content: "NOT CONNECTED";
            text-align: right;
            float: right;
            padding: 12px;
        }

        /* MAIN */

        cell {
            display: block;
        }

        celloutput {
            display: block;
            min-height: 25px;
            padding-left: 10px;
            padding-right: 10px;
            overflow: auto;
        }

        code {
            font-family: monospace;
        }

        cell.error>code {
            color: darkred;
        }

        .CodeMirror {
            height: auto !important;
            width: 100%;
            z-index: 2;
        }

        .CodeMirror-scroll {
            min-height: 0px;
        }

        .CodeMirror-empty {
            color: rgba(0, 0, 0, .15);
        }

        cell.code-folded>cellinput {
            display: none;
        }

        trafficlight {
            pointer-events: none;
            width: 4px;
            position: absolute;
            left: -4px;
            top: 0px;
            bottom: 0px;
        }

        /* In ascending order of severity: */

        cell.running>trafficlight {
            background: yellow;
        }

        cell.dependent>trafficlight {
            background: lightblue;
        }

        cell.warning>trafficlight {
            background: orange;
        }

        cell.error>trafficlight {
            background: red;
        }

        clickshoulder {
            position: absolute;
            top: 0px;
            bottom: 0px;
            width: 2000px;
            left: -2000px;
            cursor: move;
        }

        clickshoulder:hover {
            background: rgba(0, 0, 0, .05);
        }

        cell>button>span,
        cellinput>button>span {
            pointer-events: none;
        }

        button.addcell>span::after {
            content: "+";
        }

        button.deletecell>span::after {
            content: "ğŸš®";
        }

        button.runcell>span::after {
            content: "â–¶";
        }

        dropruler {
            position: absolute;
            left: 0px;
            right: 0px;
            height: 4px;
            background: rgba(0, 0, 0, .50);
            display: none;
        }

        confirmationdialog {
            position: absolute;
            display: none;
            background: white;
        }

        confirmationdialog>span#question::after {
            content: "Delete cell? ";
        }

        confirmationdialog>span#optionsep::after {
            content: " / ";
        }

        confirmationdialog>button#yes>span::after {
            content: "yes";
        }

        confirmationdialog>button#no>span::after {
            content: "no";
        }

        footer {
            width: 100%;
            height: 30px;
            font-family: monospace;
            margin-top: 30px;
        }

        footer a {
            color: black;
            opacity: .6;
            font-weight: 700;
            ;
        }

        #info {
            max-width: 9400px;
            margin: 0 auto;
            text-align: right;
            padding: 5px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0/codemirror.min.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0/theme/paraiso-light.min.css" /> -->
    <link rel="stylesheet" href="./light.css" />
    <link rel="stylesheet" href="/assets/light.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0/mode/julia/julia.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0/addon/display/placeholder.min.js"></script>
</head>

<body>
    <header>
        <div id="logocontainer">
            <h1>
                <img src="/assets/logo.svg" alt="Pluto.jl" /></h1>
            <h2>
                <span id="printernametitle">/editor</span></h2>
        </div>
    </header>

    <main>
        <notebook>
        </notebook>
        <dropruler></dropruler>
        <confirmationdialog>
            <span id="question"></span>
            <button id="yes"><span></span></button>
            <span id="optionsep"></span>
            <button id="no"><span></span></button>
        </confirmationdialog>
        <template id="celltemplate">
            <cell>
                <clickshoulder draggable="true"></clickshoulder>
                <trafficlight></trafficlight>
                <button class="addcell before"><span></span></button>
                <celloutput tabindex="1"></celloutput>
                <cellinput>
                    <button class="deletecell"><span></span></button>
                    <button class="runcell"><span></span></button>
                </cellinput>
                <button class="addcell after"><span></span></button>
            </cell>
        </template>
    </main>

    <footer>
        <div id="info">
            <a href="https://github.com/fonsp/Pluto.jl">Pluto.jl</a>, by <a href="https://github.com/fonsp" rel="author">fonsp</a> and <a href="https://github.com/malyvsen" rel="author">malyvsen</a>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            notebookName = "test_notebook.jl"
            document.querySelector("#printernametitle").innerText = notebookName;

            function startDisconnectedBanner() {
                document.querySelector("header").classList.add("disconnected")
                setTimeout(() => {
                    ping(() => {
                        document.querySelector("header").classList.remove("disconnected")
                    }, startDisconnectedBanner)
                }, 1000)
            }


            // CONFIRMATION DIALOG

            // window.confirmationdialog = document.querySelector("confirmationdialog")

            // function showConfirmationDialog(targetElement, succesCallback){    
            //     confirmationdialog.style.top = mouseEvent.pageY + "px"
            //     confirmationdialog.style.left = mouseEvent.pageX + "px"
            //     confirmationdialog.style.display = "block"

            // }

            // document.onclick = (e) => {
            //     showConfirmationDialog(e, 1)
            // }

            window.localCells = {}
            window.codeMirrors = {}

            function createCodeMirrorInsideCell(cellNode, code) {
                var editor = CodeMirror((elt) => {
                    cellNode.querySelector("cellinput").appendChild(elt)
                }, {
                    value: code,
                    lineNumbers: true,
                    mode: "julia",
                    lineWrapping: true,
                    lineNumberFormatter: function (i) {
                        return "â‹…"
                    },
                    // theme: "paraiso-light",
                    viewportMargin: Infinity,
                    placeholder: "Enter cell code...",
                });

                window.codeMirrors[cellNode.id] = editor
                //editor.setOption("readOnly", true);

                editor.setOption("extraKeys", {
                    "Ctrl-Enter": () => requestChangeRemoteCell(cellNode.id)
                });

                return editor
            }

            function updateLocalCellOutput(cellNode, mime, output, errormessage) {
                console.log(mime)
                cellNode.classList.remove("running")

                if (errormessage) {
                    cellNode.querySelector("celloutput").innerHTML = "<pre><code></code></pre>"
                    cellNode.querySelector("celloutput").querySelector("code").innerText = errormessage
                    cellNode.classList.add("error")
                } else {
                    cellNode.classList.remove("error")
                    if (mime == "text/html") {
                        // from https://stackoverflow.com/a/26716182

                        cellNode.querySelector("celloutput").innerHTML = output

                        // to execute all scripts in the output html:
                        try {
                            var scripts = Array.prototype.slice.call(cellNode.querySelector("celloutput").getElementsByTagName("script"))
                            for (var i = 0; i < scripts.length; i++) {
                                if (scripts[i].src != "") {
                                    if (!Array.prototype.map.call(document.head.querySelectorAll("script"), s => s.src).includes(scripts[i])) {
                                        var tag = document.createElement("script")
                                        tag.src = scripts[i].src
                                        document.head.appendChild(tag)
                                    }
                                } else {
                                    eval(scripts[i].innerHTML)
                                }
                            }
                        } catch (err) {
                            console.log("Couldn't execute all scripts:")
                            console.log(err)
                            // TODO: relay to user
                            // might be wise to wait after adding scripts to head
                            //
                        }
                    } else {
                        cellNode.querySelector("celloutput").innerHTML = "<pre><code></code></pre>"
                        cellNode.querySelector("celloutput").querySelector("code").innerText = output
                    }
                }
            }

            cellTemplate = document.querySelector("#celltemplate").content.firstElementChild
            notebookNode = document.querySelector("notebook")
            window.notebookNode = notebookNode

            function indexOfLocalCell(cellNode) {
                // .indexOf doesn't work on HTMLCollection
                for (var i = 0; i < notebookNode.children.length; i++) {
                    if (notebookNode.children[i].id == cellNode.id) {
                        return i
                    }
                }
            }

            function createLocalCell(newIndex, uuid, code) {
                var newCellNode = cellTemplate.cloneNode(true)
                newCellNode.id = uuid

                window.localCells[uuid] = newCellNode

                moveLocalCell(newCellNode, newIndex)

                // EVENT LISTENERS FOR CLICKY THINGS

                // newCellNode.querySelector("clickshoulder").onclick = (e) => {
                //     newCellNode.classList.toggle("code-folded")
                //     // You may not fold code if the output is empty (it would be confusing)
                //     if (!newCellNode.querySelector("celloutput").innerHTML || newCellNode.querySelector("celloutput").innerText == "") {
                //         newCellNode.classList.remove("code-folded")
                //     }
                // }

                newCellNode.querySelector("celloutput").onclick = (e) => {
                    // Do not fold if the click event was fired because the user selects text in the output.
                    if (window.getSelection().isCollapsed) {
                        // Do not fold if a link was clicked.
                        if (e.target.tagName != "A") {
                            newCellNode.classList.toggle("code-folded")
                        }
                    }
                    // You may not fold code if the output is empty (it would be confusing)
                    if (!newCellNode.querySelector("celloutput").innerHTML || newCellNode.querySelector("celloutput").innerText == "") {
                        newCellNode.classList.remove("code-folded")
                    }
                }


                newCellNode.querySelector(".addcell.before").onclick = (e) => {
                    requestNewRemoteCell(indexOfLocalCell(newCellNode))
                }
                newCellNode.querySelector(".addcell.after").onclick = (e) => {
                    requestNewRemoteCell(indexOfLocalCell(newCellNode) + 1)
                }
                newCellNode.querySelector(".deletecell").onclick = (e) => {
                    requestDeleteRemoteCell(newCellNode.id)
                }
                newCellNode.querySelector(".runcell").onclick = (e) => {
                    requestChangeRemoteCell(newCellNode.id)
                }

                editor = createCodeMirrorInsideCell(newCellNode, code)
                editor.focus()
                //updateLocalCellOutput(newCellNode, mime, output, errormessage)
                return newCellNode
            }

            function deleteLocalCell(cellNode) {
                // TODO: event listeners? gc?
                uuid = cellNode.id
                try {
                    delete window.codeMirrors[uuid]
                } catch (err) { }
                try {
                    delete window.localCells[uuid]
                } catch (err) { }

                cellNode.remove()
            }

            function moveLocalCell(cellNode, newIndex) {
                // If you append or insert a DOM element that is already a child, then it will move that child.
                // So we have the lucky effect that this method works for both use cases: `cellNode` is not yet attached to DOM, and `cellNode` is already in the `notebookNode`.

                if (newIndex == notebookNode.children.length) {
                    notebookNode.appendChild(cellNode)
                } else if (newIndex < notebookNode.children.length) {
                    notebookNode.insertBefore(cellNode, notebookNode.children[newIndex])
                } else {
                    console.error("Tried to insert cell at illegal position! Notebook order might be messed up!")
                    notebookNode.appendChild(cellNode)
                }
            }

            function deleteAllLocalCells() {
                for (var uuid in window.localCells) {
                    deleteLocalCell(window.localCells[uuid])
                }
            }

            // This is kind of overkill
            function ping(onSucces, onFailure) {
                fetch("/ping", {
                    method: 'GET',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                    //body: "hiiiii"
                }).then((response) => {
                    return response.json()
                }).then((response) => {
                    if (response == "OK!") {
                        onSucces(response)
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }

            function reloadAllCells(onFailure, onSucces) {
                ping(() => {
                    // We have a connection!

                    fetch("/getallcells", {
                        method: 'GET',
                        cache: 'no-cache',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        redirect: 'follow',
                        referrerPolicy: 'no-referrer',
                        //body: "hiiiii"
                    }).then((response) => {
                        return response.json()
                    }).then((remoteCells) => {
                        console.log("Remote cells loaded")
                        console.log(remoteCells)

                        for (var cellIndex in remoteCells) {
                            remoteCell = remoteCells[cellIndex]
                            cellElement = createLocalCell(cellIndex, remoteCell.uuid, remoteCell.code)
                            // if ((remoteCell.mime && remoteCell.output) || remoteCell.errormessage) {
                            // 	updateLocalCellOutput(cellElement, remoteCell.mime, remoteCell.output, remoteCell.errormessage)
                            // }
                        }

                        onSucces()
                    }).catch(onFailure)
                }, console.warn)
            }

            function requestChangeRemoteCell(uuid) {
                window.localCells[uuid].classList.add("running")
                var onFailure = (response) => {
                    console.warn("Failed to update cell!")
                    console.log(response)

                    startDisconnectedBanner()
                }
                newCode = window.codeMirrors[uuid].getValue()
                fetch("/changecell", {
                    method: 'PUT',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                    body: JSON.stringify({
                        "uuid": uuid,
                        "code": newCode
                    }),
                }).then((response) => {
                    if (response.status == 200) {
                        console.log("Cell updated.")
                        // TODO: 
                        //cellsthatwillbeupdate.foreach.classList.add("running")
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }

            // Indexing works as if a new cell is added.
            // e.g. if the third cell (at js-index 2) of [0, 1, 2, 3, 4]
            // is moved to the end, that would be new js-index = 5
            function requestMoveRemoteCell(uuid, newIndex) {
                var onFailure = (response) => {
                    console.warn("Failed to move cell!")
                    console.log(response)

                    startDisconnectedBanner()
                }
                fetch("/movecell", {
                    method: 'PUT',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                    body: JSON.stringify({
                        "uuid": uuid,
                        "index": newIndex
                    }),
                }).then((response) => {
                    if (response.status == 200) {
                        console.log("Cell moved.")
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }

            function runUpdateLoop() {
                console.log("run update loop")
                var onFailure = (response) => {
                    console.warn("Failed to get updates!")
                    console.log(response)

                    document.querySelector("header").classList.add("disconnected")


                    setTimeout(() => {
                        ping(() => {
                            document.querySelector("header").classList.remove("disconnected")
                            runUpdateLoop()
                        }, onFailure)
                    }, 1000)
                }

                fetch("/nextcellupdate", {
                    method: 'GET',
                    cache: 'no-cache',
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                }).then((response) => {
                    console.log("update response received")
                    console.log(response)
                    if (response.status == 200) {
                        response.json().then((update) => {
                            // UPDATE RECEIVED
                            console.log("output deserialized")
                            console.log(update)

                            var message = update.message

                            switch (update.type) {
                                case "update_output":
                                    updateLocalCellOutput(window.localCells[message.uuid], message.mime, message.output, message.errormessage)
                                    break
                                case "cell_added":
                                    createLocalCell(message.index, message.uuid, "")
                                    break
                                case "cell_deleted":
                                    // TODO: catch exception
                                    var toDelete = window.localCells[message.uuid]
                                    deleteLocalCell(toDelete)
                                    break
                                case "cell_moved":
                                    // TODO: catch exception
                                    moveLocalCell(window.localCells[message.uuid], message.index)
                                    break
                                default:
                                    console.error("Received unknown update type!")
                                    alert("Something went wrong ğŸ™ˆ\n Try refreshing the page")
                                    break
                            }
                            //TODO: animation âœ¨

                            runUpdateLoop()
                        })
                    } else if (response.status == 204) {
                        runUpdateLoop()
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }

            function requestNewRemoteCell(newIndex) {
                var onFailure = (response) => {
                    console.warn("Failed to request remote cell!")
                    console.log(response)

                    startDisconnectedBanner()
                }
                fetch("/addcell", {
                    method: 'POST',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                    body: JSON.stringify({
                        "index": newIndex
                    }),
                }).then((response) => {
                    if (response.status == 200) {
                        console.log("Cell added.")
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }

            function requestDeleteRemoteCell(uuid) {
                var onFailure = (response) => {
                    console.warn("Failed to delete remote cell!")
                    console.log(response)

                    startDisconnectedBanner()
                }
                fetch("/deletecell", {
                    method: 'DELETE',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    redirect: 'follow',
                    referrerPolicy: 'no-referrer',
                    body: JSON.stringify({
                        "uuid": uuid
                    }),
                }).then((response) => {
                    if (response.status == 200) {
                        console.log("Cell deleted.")
                    } else {
                        onFailure(response)
                    }
                }).catch(onFailure)
            }
            ping(console.log, console.warn)
            reloadAllCells(console.warn, runUpdateLoop)

            if ("fonts" in document) {
                document.fonts.ready.then(function () {
                    console.log("fonts loaded");
                    for (var uuid in window.codeMirrors) {
                        window.codeMirrors[uuid].refresh()
                    }
                });
            }

            // TODO: reconnect with a delay if the last request went poorly
            // this would avoid hanging UI when the connection is lost maybe?
            // implemented, but untested

            // TODO: check cell order every now and then?
            // or do ___maths___ to make sure that it never gets messed up

            function argmin(x) {
                var best_val = Infinity
                var best_index = -1
                var val
                for (var i = 0; i < x.length; i++) {
                    val = x[i]
                    if (val < best_val) {
                        best_index = i
                        best_val = val
                    }
                }
                return best_index
            }

            dropruler = document.querySelector("dropruler")

            document.ondragover = (e) => {
                e.preventDefault();
            }

            var dropPositions = []
            var dropee = null
            document.ondragstart = (e) => {
                dropee = e.target.parentElement

                dropPositions = []
                for (var i = 0; i < notebookNode.children.length; i++) {
                    dropPositions.push(notebookNode.children[i].offsetTop)
                }
                dropPositions.push(notebookNode.lastChild.offsetTop + notebookNode.lastChild.scrollHeight)
            }
            // Called continuously during drag
            document.ondrag = (e) => {
                dist = dropPositions.map(p => Math.abs(p - e.pageY))
                dropIndex = argmin(dist)

                dropruler.style.top = dropPositions[dropIndex] + "px";
                dropruler.style.display = "block";
                console.log(dropIndex)
            }
            document.ondrop = (e) => {
                dist = dropPositions.map(p => Math.abs(p - e.pageY))
                dropIndex = argmin(dist)

                dropruler.style.display = "none";

                requestMoveRemoteCell(dropee.id, dropIndex)
            }


            window.reloadAllCells = reloadAllCells
            window.ping = ping


            //editor.on("change", window.preview);
            window.fakeCells = () => {
                var last;
                last = createLocalCell(0, "0", "100*x + y")
                updateLocalCellOutput(last, "text/plain", "100*x + y", "")
                last = createLocalCell(1, "0", "x = 1 + 1")
                updateLocalCellOutput(last, "text/plain", "x = 1 + 1", "")
                last = createLocalCell(2, "0", `function meshgrid(x, dims)
	# This is a more general version of the 3D function:

	# xx = repeat(x,1,N,N)
	# yy = repeat(x,N,1,N)
	# zz = repeat(x,N,N,1)
	# return xx,yy,zz

	N = length(x)

	grid_for_dim_k = function(k)
		# We will reshape x to be a multi-dimensional array of dimensions:
		x_reshaper = [i==k ? N : 1 for i in 1:dims]

		# And then repeat this matrix in all other dimensions:
		repeat_counts = [i==k ? 1 : N for i in 1:dims]
		return repeat(reshape(x, x_reshaper...), repeat_counts...)
	end
	return Tuple(grid_for_dim_k(k) for k in 1:dims)
end`)
                updateLocalCellOutput(last, "text/plain", "y = x * 2", "")
                last = createLocalCell(3, "0", "html\"<h1>Hoi!</h1>\n<p>My name is <em>kiki</em></p>\"")
                updateLocalCellOutput(last, "text/html", `<div class="markdown"><h1>CzeÅ›Ä‡!</h1>
<p>My name is <strong>baba</strong> and I like $maths$</p>
<p><em>(Markdown -&gt; HTML is for free, for LaTeX we need to pre-/post-process the HTML, and import a latex-js lib)</em></p>
<h1>Very intersesting indeed</h1>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus in massa justo. Curabitur non dictum magna, sed cursus ante. Suspendisse Î”s ante vitae urna euismod Î±-porta. Lorem ipsum dolor sit Î”-amet, consectetur adipiscing elit. Vestibulum scelerisque interdum felis sit Î”Î£Î‘Î£Î” amet ornare. Nulla massa mauris, hendrerit a ante sit amet, posuere Î£-ultricies urna. Nunc molestie vel ipsum eget interdum. Sed porta fringilla odio vitae iaculis. Mauris purus sem, dictum iaculis lectus id, elementum rutrum mauris. Nulla in sollicitudin urna. Duis sit amet ligula Î±+(Î²-Ïˆ) sagittis, gravida leo non, blandit ex. Vestibulum feugiat facilisis lacus ut maximus. Praesent quis justo arcu. Fusce sagittis vitae sem a aliquet.</p>
<h2>Hmmm very difficult</h2>
<p>Apparently we had reached a great height in the atmosphere, for the sky was a dead black, and the stars had ceased to twinkle. By the same illusion which lifts the horizon of the sea to the level of the spectator on a hillside, the sable cloud beneath was dished out, and the car seemed to float in the middle of an immense dark sphere, whose upper half was strewn with silver. Looking down into the dark gulf below, I could see a ruddy light streaming through a rift in the clouds.</p>
<h3>ornare sit amet</h3>
<p>Suspendisse vulputate eu nisl ut aliquet. Integer blandit in nulla vitae egestas.</p>
<h2>ornare sit amet</h2>
<p>Curabitur imperdiet purus sit amet dolor tincidunt feugiat. Fusce dapibus enim ac facilisis laoreet. Vestibulum ut semper ex. Maecenas egestas libero efficitur mi pellentesque facilisis. In congue vel mi sed viverra. In sollicitudin urna sodales nibh tempor luctus. Proin sit amet nunc accumsan sem suscipit sodales.</p>
<h4>imperdiet</h4>
<p>Fusce sit amet justo eu ex finibus cursus. Maecenas ut accumsan eros. Nam iaculis sem vitae ultrices mollis. Ut convallis eu nibh at varius. Suspendisse auctor, mauris a tincidunt facilisis, ex massa pulvinar ligula, in vulputate odio ipsum a elit. Praesent vel magna feugiat, tincidunt lacus at, eleifend nulla. Nullam bibendum ultricies metus quis euismod. Nam rutrum euismod iaculis. Aenean consequat nibh non semper pellentesque. Integer finibus, magna at congue convallis, ipsum purus malesuada erat, in aliquam diam ex viverra sem. Maecenas volutpat a massa eget maximus. Proin gravida erat quam, nec iaculis lacus eleifend vel. Etiam fringilla justo et neque sollicitudin, ac blandit nulla sagittis. Quisque ullamcorper volutpat metus vel egestas. Praesent sagittis laoreet congue. Donec sed diam eget metus malesuada efficitur eu ac dolor.</p>
</div>`, "")
                last = createLocalCell(4, "0", "using Markdown; md\"# CzeÅ›Ä‡!\nMy name is **baba** and I like \$maths\$\n\n_(Markdown -> HTML is for free, for LaTeX we need to pre-/post-process the HTML, and import a latex-js lib)_\"")
                updateLocalCellOutput(last, "text/html", `<div class="markdown"><h1>CzeÅ›Ä‡!</h1>
<p>My name is <strong>baba</strong> and I like $maths$ <em>(no LaTeX support yet!)</em></p>
<p>It is the ninth-largest and tenth-most-massive known object directly orbiting the Sun. It is the largest known trans-Neptunian object by volume but is less massive than Eris. Like other Kuiper belt objects, Pluto is primarily made of ice and rock and is relatively smallâ€”about one-sixth the mass of the Moon and one-third its volume. It has a moderately eccentric and inclined orbit during which it ranges from 30 to 49 astronomical units or AU (4.4â€“7.4 billion km) from the Sun. This means that Pluto periodically comes closer to the Sun than Neptune, but a stable orbital resonance with Neptune prevents them from colliding. Light from the Sun takes about 5.5 hours to reach Pluto at its average distance (39.5 AU).</p>
<h3>The spectacle before us was indeed sublime.</h3>
<p>Apparently we had reached a great height in the atmosphere, for the sky was a dead black, and the stars had ceased to twinkle. By the same illusion which lifts the horizon of the sea to the level of the spectator on a hillside, the sable cloud beneath was dished out, and the car seemed to float in the middle of an immense dark sphere, whose upper half was strewn with silver. Looking down into the dark gulf below, I could see a ruddy light streaming through a rift in the clouds. </p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/a/a7/Pluto-01_Stern_03_Pluto_Color_TXT.jpg" alt="Pluto"> <em>Die NASA Sonde New Horizons machte dieses hochaufgelÃ¶ste Foto von Pluto mit erweitertem Farbspektrum am 14. Juli 2015. Das Bild entstand aus einer Kombination von Blau-, Rot- und Infrarotaufnahmen, die mit der Ralph/Multispectral Visual Imaging Camera (MVIC) aufgenommen wurden.</em></p>
<h3>Historia pojÄ™cia</h3>
<p>ÎŸÎ¹ Ï€Î»Î±Î½Î®Ï„ÎµÏ‚ Î¸ÎµÏ‰ÏÎ¿ÏÎ½Ï„Î±Î½ Î±Ï€ÏŒ Ï„Î¿Î½ Î Ï„Î¿Î»ÎµÎ¼Î±Î¯Î¿ ÏŒÏ„Î¹ Ï€ÎµÏÎ¹Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ Î³ÏÏÏ‰ Î±Ï€ÏŒ Ï„Î· Î“Î· Î¼Îµ Ï†ÎµÏÏŒÎ¼ÎµÎ½ÎµÏ‚ ÎºÎ±Î¹ ÎµÏ€Î¹ÎºÏ…ÎºÎ»Î¹ÎºÎ­Ï‚ ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚. Î Î±ÏÏŒÎ»Î¿ Ï€Î¿Ï… Î· Î¹Î´Î­Î± Ï„Î·Ï‚ Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬Ï‚ Î³ÏÏÏ‰ Î±Ï€ÏŒ Ï„Î¿Î½ Î‰Î»Î¹Î¿ ÎµÎ¯Ï‡Îµ Ï€ÏÎ¿Ï„Î±Î¸ÎµÎ¯ Ï€Î¿Î»Î»Î­Ï‚ Ï†Î¿ÏÎ­Ï‚ (Î¼Îµ Ï€Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎ· Î³Î½Ï‰ÏƒÏ„Î® Î´Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ Î‘ÏÎ¯ÏƒÏ„Î±ÏÏ‡Î¿ Ï„Î¿ Î£Î¬Î¼Î¹Î¿), Ï‡ÏÎµÎ¹Î¬ÏƒÏ„Î·ÎºÎµ Î½Î± Ï†Î¸Î¬ÏƒÎµÎ¹ Î¿ 17Î¿Ï‚ Î±Î¹ÏÎ½Î±Ï‚, Î¼Îµ Ï„Î·Î½ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Ï„Ï‰Î½ Ï€ÏÏÏ„Ï‰Î½ Ï„Î·Î»ÎµÏƒÎºÎ¿Ï€Î¹ÎºÏÎ½ Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¹ÎºÏÎ½ Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÏ‰Î½, Ï€Î¿Ï… Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎ±Î½ Î±Ï€ÏŒ Ï„Î¿ Î“Î±Î»Î¹Î»Î±Î¯Î¿ Î“Î±Î»Î¹Î»Î­Î¹, Î³Î¹Î± Î½Î± Ï„ÎµÎºÎ¼Î·ÏÎ¹Ï‰Î¸ÎµÎ¯ Î· Î·Î»Î¹Î¿ÎºÎµÎ½Ï„ÏÎ¹ÎºÎ® Î¸ÎµÏ‰ÏÎ¯Î±. </p>
<p>De stjer dy't it deunst by de Ierde stiet, is de sinne (of Sol, yn wittenskiplike nomenklatuer), dy't Ãºs sinnestelsel beljochtet en fan enerzjy foarsjocht. Alle libbene wÃªzens op 'e Ierde besteane Ãºteinlik fan sinneljocht, dat troch planten yn it proses fotosynteze ta iten makke wurdt en as sadanich de hiele itenskeatling fan it Ierdske ekosysteem Ã»nderstipet. In grut tal oare stjerren is nachts by Ã»nbewolkt waar mei it bleate each sichtber oan 'e himel, mar wurdt oerdeis wei yn it ljocht fan 'e sinne. De neiste fan dy oare stjerren is Proxima Centauri, dy't op 39,9 triljoen km (of 4,2 ljochtjier) Ã´fstÃ¢n fan 'e Ierde stiet. As men reizgje soe mei de faasje dy't in romtefear yn in baan om 'e Ierde berikt (8 km de sekonde of krapoan 30.000 km de oere), soe men der 150.000 jier oer dwaan om Proxima Centauri te berikken.</p>
<p>å„ä¸ªæ–‡æ˜å¯¹æ˜Ÿåº§çš„åˆ’åˆ†æ–¹æ³•ä¸è¡Œæ˜Ÿè½¨è¿¹å¯†åˆ‡ç›¸å…³ï¼šå¤ªé˜³åœ¨é»„é“ä¸Šä¸€å¹´è¿è¡Œä¸€åœˆï¼Œå¤ªé˜´åœ¨é»„é“ä¸Šä¸€ä¸ªæœˆè¿è¡Œä¸€åœˆã€‚è¥¿æ–¹æ–‡æ˜ä¸­ï¼Œå¤ªé˜³çš„è½¨è¿¹æŠŠé»„é“åˆ†ä½œåäºŒæ®µï¼Œæ¯æœˆä¸€æ®µï¼Œæ¯æ®µä¸€ä¸ªæ˜Ÿåº§ç»„æˆé»„é“åäºŒå®«ã€‚ä¸­å›½æ–‡æ˜ä¸­ï¼Œå¤ªé˜³çš„è½¨è¿¹æŠŠé»„é“åˆ†ä½œå››æ®µï¼Œæ¯ä¸ªå­£åº¦ä¸€æ®µï¼Œå³å¤©ç©ºçš„å››è±¡é’é¾™ç™½è™æœ±é›€ç„æ­¦ï¼›è€Œå¤ªé˜´çš„è½¨è¿¹æŠŠé»„é“åˆ†ä½œ28æ®µï¼Œæ¯å¤©ä¸€æ®µï¼Œå³å¤©ç©ºçš„28ä¸ªæ˜Ÿå®¿ï¼›ç„¶åç»“åˆå¤ªé˜³å’Œå¤ªé˜´çš„åˆ’åˆ†ï¼Œå››è±¡=28å®¿ï¼Œæ¯ä¸€è±¡è¢«åˆ†ä½œä¸ƒå®¿ï¼Œè¿™ä¸ƒå®¿åˆ†åˆ«å¯¹åº”é˜´é˜³é‡‘æœ¨æ°´ç«åœŸä¸ƒå¤§è¡Œæ˜Ÿï¼Œç»„æˆä¸€ä¸ªæ˜ŸæœŸä¸ƒå¤©ï¼Œå› æ­¤æ¯ä¸ªæœˆè¢«å››è±¡åˆ†æˆå››ä¸ªæ˜ŸæœŸã€‚</p>
</div>`, "")

            }

            if (document.location.protocol == "file:") {
                window.fakeCells()
            }
        });
    </script>
</body>

</html>