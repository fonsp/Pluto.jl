<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ExportBanner Test</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                margin: 20px;
                background: #f5f5f5;
            }
            .test-container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .controls {
                margin-bottom: 20px;
                display: flex;
                gap: 10px;
            }
            button {
                padding: 10px 20px;
                border: 1px solid #ccc;
                border-radius: 4px;
                background: white;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            button:hover {
                background: #f0f0f0;
            }
            .status {
                margin-top: 20px;
                padding: 10px;
                background: #e8f4fd;
                border-left: 4px solid #007acc;
                border-radius: 4px;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>ExportBanner Component Test</h1>
            <p>This page tests the migrated ExportBanner Svelte component.</p>

            <div class="controls">
                <button id="openBtn">Open Export Banner</button>
                <button id="closeBtn">Close Export Banner</button>
                <button id="togglePrideBtn">Toggle Pride Mode</button>
            </div>

            <div id="export-banner-container"></div>

            <div class="status" id="status">Status: Ready</div>
        </div>

        <script type="module">
            // Import the wrapper component
            import { ExportBanner } from "./svelte-migration/ExportBanner-wrapper.js"
            import { render } from "./imports/Preact.js"

            let isOpen = false
            let isPrideMode = false

            function updateStatus(message) {
                document.getElementById("status").textContent = `Status: ${message}`
            }

            function startRecording() {
                updateStatus("Recording started!")
                setTimeout(() => updateStatus("Ready"), 2000)
            }

            function onClose() {
                isOpen = false
                renderExportBanner()
                updateStatus("Export banner closed")
            }

            function renderExportBanner() {
                try {
                    const props = {
                        notebook_id: "test-notebook-123",
                        print_title: "Test Notebook.jl",
                        open: isOpen,
                        onClose: onClose,
                        notebookfile_url: "/notebook/test-notebook-123.jl",
                        notebookexport_url: "/export/test-notebook-123.html",
                        start_recording: startRecording,
                    }

                    render(ExportBanner(props), document.getElementById("export-banner-container"))
                    updateStatus(`Export banner rendered (Open: ${isOpen}, Pride: ${isPrideMode})`)
                } catch (error) {
                    updateStatus(`Error: ${error.message}`)
                    console.error("Error rendering ExportBanner:", error)
                }
            }

            // Event listeners
            document.getElementById("openBtn").addEventListener("click", () => {
                isOpen = true
                renderExportBanner()
            })

            document.getElementById("closeBtn").addEventListener("click", () => {
                isOpen = false
                renderExportBanner()
            })

            document.getElementById("togglePrideBtn").addEventListener("click", () => {
                isPrideMode = !isPrideMode
                if (isPrideMode) {
                    // Simulate June (pride month)
                    const originalGetMonth = Date.prototype.getMonth
                    Date.prototype.getMonth = function () {
                        return 5
                    }
                    renderExportBanner()
                    Date.prototype.getMonth = originalGetMonth
                } else {
                    renderExportBanner()
                }
                updateStatus(`Pride mode: ${isPrideMode ? "ON" : "OFF"}`)
            })

            // Initial render
            renderExportBanner()
            updateStatus("ExportBanner component loaded and ready")
        </script>
    </body>
</html>
