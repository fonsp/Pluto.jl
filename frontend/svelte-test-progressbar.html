<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ProgressBar Svelte Test</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background: #f5f5f5;
            }
            .test-container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .controls {
                margin-bottom: 20px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 4px;
            }
            button {
                margin: 5px;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                background: #007bff;
                color: white;
                cursor: pointer;
            }
            button:hover {
                background: #0056b3;
            }
            .cell-element {
                height: 200px;
                margin: 20px 0;
                padding: 20px;
                background: #e9ecef;
                border: 2px dashed #ccc;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                color: #666;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>ProgressBar Svelte Component Test</h1>

            <div class="controls">
                <h3>Test Controls</h3>
                <button onclick="startCellProgress()">Start Cell Progress</button>
                <button onclick="stopCellProgress()">Stop Cell Progress</button>
                <button onclick="startBinderLoading()">Start Binder Loading</button>
                <button onclick="stopBinderLoading()">Stop Binder Loading</button>
                <button onclick="resetAll()">Reset All</button>
            </div>

            <div id="app"></div>

            <div id="test-cell-1" class="cell-element">Test Cell 1 (Click progress bar to scroll here)</div>

            <div style="height: 1000px"></div>

            <div id="test-cell-2" class="cell-element">Test Cell 2 (Click progress bar to scroll here)</div>
        </div>

        <script type="module">
            import ProgressBar from "./svelte-migration/ProgressBar.svelte"

            // Mock data
            let mockNotebook = {
                cell_results: {},
            }

            let mockStatus = {
                loading: false,
                binder: false,
            }

            let mockBackendLaunchPhase = 0

            // 创建应用 - Svelte 5 方式
            let componentProps = {
                notebook: mockNotebook,
                backend_launch_phase: mockBackendLaunchPhase,
                status: mockStatus,
            }

            const app = ProgressBar({
                target: document.getElementById("app"),
                props: componentProps,
            })

            // Test functions
            window.startCellProgress = function () {
                mockNotebook.cell_results["test-cell-1"] = {
                    cell_id: "test-cell-1",
                    running: true,
                    queued: false,
                }
                app.$set({ notebook: mockNotebook })
            }

            window.stopCellProgress = function () {
                delete mockNotebook.cell_results["test-cell-1"]
                app.$set({ notebook: mockNotebook })
            }

            window.startBinderLoading = function () {
                mockStatus.loading = true
                mockStatus.binder = true
                mockBackendLaunchPhase = 2
                app.$set({ status: mockStatus, backend_launch_phase: mockBackendLaunchPhase })
            }

            window.stopBinderLoading = function () {
                mockStatus.loading = false
                mockStatus.binder = false
                mockBackendLaunchPhase = 4
                app.$set({ status: mockStatus, backend_launch_phase: mockBackendLaunchPhase })
            }

            window.resetAll = function () {
                mockNotebook.cell_results = {}
                mockStatus.loading = false
                mockStatus.binder = false
                mockBackendLaunchPhase = 0
                app.$set({ notebook: mockNotebook, status: mockStatus, backend_launch_phase: mockBackendLaunchPhase })
            }

            console.log("ProgressBar test page loaded. Use the buttons to test different states.")
        </script>
    </body>
</html>
